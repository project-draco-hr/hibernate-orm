{
  LOG.debugf("Lookup: name=%s",name);
  Set<EntityManagerFactory> entityManagerFactorySet=entityManagerFactoryMap.get(name);
  if (entityManagerFactorySet == null) {
    throw new HibernateException("registry does not contain entity manager factory: " + name);
  }
  if (entityManagerFactorySet.size() > 1) {
    throw new HibernateException("registry contains more than one (" + entityManagerFactorySet.size() + ") entity manager factories: "+ name);
  }
  return entityManagerFactorySet.iterator().next();
}
