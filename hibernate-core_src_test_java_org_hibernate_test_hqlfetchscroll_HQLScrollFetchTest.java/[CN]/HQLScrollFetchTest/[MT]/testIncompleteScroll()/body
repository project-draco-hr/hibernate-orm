{
  try {
    insertTestData();
    Session s=openSession();
    ScrollableResults results=s.createQuery(QUERY + " order by p.name asc").scroll();
    results.next();
    Parent p=(Parent)results.get(0);
    assertResultFromOneUser(p);
    Parent pOther=null;
    Child cOther=null;
    for (    Object entity : ((SessionImplementor)s).getPersistenceContext().getEntitiesByKey().values()) {
      if (Parent.class.isInstance(entity)) {
        if (entity != p) {
          if (pOther != null) {
            fail("unexpected parent found.");
          }
          pOther=(Parent)entity;
        }
      }
 else       if (Child.class.isInstance(entity)) {
        if (!p.getChildren().contains(entity)) {
          if (cOther != null) {
            fail("unexpected child entity found");
          }
          cOther=(Child)entity;
        }
      }
 else {
        fail("unexpected type of entity.");
      }
    }
    assertSame(pOther,s.get(Parent.class,"parent2"));
    assertNotNull(pOther);
    assertNotNull(cOther);
    assertTrue(Hibernate.isInitialized(pOther.getChildren()));
    assertTrue(pOther.getChildren().contains(cOther));
    assertResultFromOneUser(pOther);
    s.close();
  }
  finally {
    deleteAll();
  }
}
