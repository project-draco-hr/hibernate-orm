{
  Session s=openSession();
  ScrollableResults results=s.createQuery(QUERY + " order by p.name asc").scroll();
  results.next();
  Parent p=(Parent)results.get(0);
  assertResultFromOneUser(p);
  results.last();
  Parent pOther=null;
  Set childrenOther=new HashSet();
  for (  Object entity : ((SessionImplementor)s).getPersistenceContext().getEntitiesByKey().values()) {
    if (Parent.class.isInstance(entity)) {
      if (entity != p) {
        if (pOther != null) {
          fail("unexpected parent found.");
        }
        pOther=(Parent)entity;
      }
    }
 else     if (Child.class.isInstance(entity)) {
      if (!p.getChildren().contains(entity)) {
        childrenOther.add(entity);
      }
    }
 else {
      fail("unexpected type of entity.");
    }
  }
  assertSame(pOther,s.get(Parent.class,"parent2"));
  assertNotNull(pOther);
  assertTrue(Hibernate.isInitialized(pOther.getChildren()));
  assertEquals(childrenOther,pOther.getChildren());
  assertResultFromOneUser(pOther);
  s.close();
}
