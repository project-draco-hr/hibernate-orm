{
  long start=System.currentTimeMillis();
  Configuration cfg=new Configuration();
  System.err.println("Created configuration: " + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
  System.err.println("saveAndLoad from " + prefix + " with cfg = "+ cfgName);
  if (!new File(cfgName).exists()) {
    start=System.currentTimeMillis();
    for (int i=0; i < files.length; i++) {
      String file=files[i];
      cfg.addCacheableFile(new File(prefix + file));
    }
    System.err.println("Added " + (files.length) + " resources: "+ (System.currentTimeMillis() - start) / 1000.0 + " sec.");
    ObjectOutputStream os=new ObjectOutputStream(new FileOutputStream(cfgName));
    os.writeObject(cfg);
    os.flush();
    os.close();
  }
 else {
    start=System.currentTimeMillis();
    ObjectInputStream is=new ObjectInputStream(new FileInputStream(cfgName));
    cfg=(Configuration)is.readObject();
    is.close();
    System.err.println("Loaded serializable configuration:" + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
  }
  start=System.currentTimeMillis();
  System.err.println("Start build of session factory");
  SessionFactory factory=cfg.buildSessionFactory();
  System.err.println("Build session factory:" + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
  return factory;
}
