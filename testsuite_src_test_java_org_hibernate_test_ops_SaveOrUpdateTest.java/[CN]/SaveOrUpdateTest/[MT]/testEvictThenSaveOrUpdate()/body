{
  Session s=openSession();
  s.getTransaction().begin();
  Node parent=new Node("1:parent");
  Node child=new Node("2:child");
  Node grandchild=new Node("3:grandchild");
  parent.addChild(child);
  child.addChild(grandchild);
  s.saveOrUpdate(parent);
  s.getTransaction().commit();
  s.close();
  Session s1=openSession();
  s1.getTransaction().begin();
  child=(Node)s1.load(Node.class,"2:child");
  assertTrue(s1.contains(child));
  assertFalse(Hibernate.isInitialized(child));
  assertTrue(s1.contains(child.getParent()));
  assertTrue(Hibernate.isInitialized(child));
  assertFalse(Hibernate.isInitialized(child.getChildren()));
  assertFalse(Hibernate.isInitialized(child.getParent()));
  assertTrue(s1.contains(child));
  s1.evict(child);
  assertFalse(s1.contains(child));
  assertTrue(s1.contains(child.getParent()));
  Session s2=openSession();
  s2.getTransaction().begin();
  s2.saveOrUpdate(child);
  assertTrue(s2.contains(child));
  assertFalse(s1.contains(child));
  assertTrue(s2.contains(child.getParent()));
  assertFalse(s1.contains(child.getParent()));
  assertFalse(Hibernate.isInitialized(child.getChildren()));
  assertFalse(Hibernate.isInitialized(child.getParent()));
  assertEquals(1,child.getChildren().size());
  assertEquals("1:parent",child.getParent().getName());
  assertTrue(Hibernate.isInitialized(child.getChildren()));
  assertFalse(Hibernate.isInitialized(child.getParent()));
  assertNull(child.getParent().getDescription());
  assertTrue(Hibernate.isInitialized(child.getParent()));
  s1.getTransaction().commit();
  s2.getTransaction().commit();
  s1.close();
  s2.close();
  s=openSession();
  s.beginTransaction();
  s.delete(s.get(Node.class,"3:grandchild"));
  s.delete(s.get(Node.class,"2:child"));
  s.delete(s.get(Node.class,"1:parent"));
  s.getTransaction().commit();
  s.close();
}
