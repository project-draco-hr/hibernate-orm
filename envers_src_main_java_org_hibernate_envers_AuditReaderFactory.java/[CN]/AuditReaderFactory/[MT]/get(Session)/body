{
  SessionImplementor sessionImpl=(SessionImplementor)session;
  EventListeners listeners=sessionImpl.getListeners();
  for (  PostInsertEventListener listener : listeners.getPostInsertEventListeners()) {
    if (listener instanceof VersionsEventListener) {
      if (arrayIncludesInstanceOf(listeners.getPostUpdateEventListeners(),VersionsEventListener.class) && arrayIncludesInstanceOf(listeners.getPostDeleteEventListeners(),VersionsEventListener.class)) {
        return new AuditReaderImpl(((VersionsEventListener)listener).getVerCfg(),session,sessionImpl);
      }
    }
  }
  throw new AuditException("You need install the org.hibernate.envers.event.VersionsEventListener " + "class as post insert, update and delete event listener.");
}
