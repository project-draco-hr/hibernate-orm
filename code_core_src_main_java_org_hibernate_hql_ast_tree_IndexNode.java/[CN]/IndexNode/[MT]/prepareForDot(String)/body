{
  FromElement fromElement=getFromElement();
  if (fromElement == null) {
    throw new IllegalStateException("No FROM element for index operator!");
  }
  QueryableCollection queryableCollection=fromElement.getQueryableCollection();
  if (queryableCollection != null && !queryableCollection.isOneToMany()) {
    FromReferenceNode collectionNode=(FromReferenceNode)getFirstChild();
    String path=collectionNode.getPath() + "[]." + propertyName;
    if (log.isDebugEnabled()) {
      log.debug("Creating join for many-to-many elements for " + path);
    }
    FromElementFactory factory=new FromElementFactory(fromElement.getFromClause(),fromElement,path);
    FromElement elementJoin=factory.createElementJoin(queryableCollection);
    setFromElement(elementJoin);
  }
}
