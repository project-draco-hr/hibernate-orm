{
  if (session.getTransaction().getStatus() != TransactionStatus.ACTIVE) {
    TestableThreadLocalContext.unbind(sessionFactory());
    return;
  }
  long initialCount=sessionFactory().getStatistics().getSessionCloseCount();
  session.getTransaction().commit();
  long subsequentCount=sessionFactory().getStatistics().getSessionCloseCount();
  assertEquals("Session still open afterQuery commit",initialCount + 1,subsequentCount);
  assertFalse("session still bound to internal ThreadLocal",TestableThreadLocalContext.hasBind());
}
