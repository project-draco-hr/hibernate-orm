{
  MetadataSources sources=new MetadataSources(serviceRegistry);
  addSourcesForSimpleEntityBinding(sources);
  addSourcesForManyToOne(sources);
  MetadataImpl metadata=(MetadataImpl)sources.buildMetadata();
  EntityBinding simpleEntityBinding=metadata.getEntityBinding(SimpleEntity.class.getName());
  assertIdAndSimpleProperty(simpleEntityBinding);
  Set<SingularAssociationAttributeBinding> referenceBindings=simpleEntityBinding.locateAttributeBinding("id").getEntityReferencingAttributeBindings();
  assertEquals("There should be only one reference binding",1,referenceBindings.size());
  SingularAssociationAttributeBinding referenceBinding=referenceBindings.iterator().next();
  EntityBinding referencedEntityBinding=referenceBinding.getReferencedEntityBinding();
  assertEquals("Should be the same entity binding",referencedEntityBinding,simpleEntityBinding);
  EntityBinding entityWithManyToOneBinding=metadata.getEntityBinding(ManyToOneEntity.class.getName());
  Iterator<SingularAssociationAttributeBinding> it=entityWithManyToOneBinding.getEntityReferencingAttributeBindings().iterator();
  assertTrue(it.hasNext());
  assertSame(entityWithManyToOneBinding.locateAttributeBinding("simpleEntity"),it.next());
  assertFalse(it.hasNext());
}
