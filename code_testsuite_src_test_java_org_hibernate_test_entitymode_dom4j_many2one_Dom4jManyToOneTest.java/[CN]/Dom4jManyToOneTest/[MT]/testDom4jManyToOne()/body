{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  CarType carType=new CarType();
  carType.setTypeName("Type 1");
  s.save(carType);
  Car car1=new Car();
  car1.setCarType(carType);
  car1.setModel("Model 1");
  s.save(car1);
  Car car2=new Car();
  car2.setCarType(carType);
  car2.setModel("Model 2");
  s.save(car2);
  t.commit();
  s.close();
  s=openSession();
  Session dom4jSession=s.getSession(EntityMode.DOM4J);
  t=s.beginTransaction();
  List list=dom4jSession.createQuery("from Car c join fetch c.carType order by c.model asc").list();
  String[] expectedResults=new String[]{"<car id=\"" + car1.getId() + "\"><model>Model 1</model><carType id=\""+ carType.getId()+ "\"><typeName>Type 1</typeName></carType></car>","<car id=\"" + car2.getId() + "\"><model>Model 2</model><carType id=\""+ carType.getId()+ "\"><typeName>Type 1</typeName></carType></car>"};
  for (int i=0; i < list.size(); i++) {
    Element element=(Element)list.get(i);
    print(element);
    assertTrue(element.asXML().equals(expectedResults[i]));
  }
  s.createQuery("delete from Car").executeUpdate();
  s.createQuery("delete from CarType").executeUpdate();
  t.commit();
  s.close();
}
