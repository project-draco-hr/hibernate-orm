{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  CarType carType=new CarType();
  carType.setTypeName("Type 1");
  s.save(carType);
  Car car=new Car();
  car.setCarType(carType);
  car.setModel("Model 1");
  s.save(car);
  CarPart carPart1=new CarPart();
  carPart1.setPartName("chassis");
  car.getCarParts().add(carPart1);
  t.commit();
  s.close();
  s=openSession();
  Session dom4jSession=s.getSession(EntityMode.DOM4J);
  t=s.beginTransaction();
  Element element=(Element)dom4jSession.createQuery("from Car c join fetch c.carParts").uniqueResult();
  String expectedResult="<car id=\"" + car.getId() + "\"><carPart>"+ carPart1.getId()+ "</carPart><model>Model 1</model><carType id=\""+ carType.getId()+ "\"><typeName>Type 1</typeName></carType></car>";
  print(element);
  assertTrue(element.asXML().equals(expectedResult));
  s.createQuery("delete from CarPart").executeUpdate();
  s.createQuery("delete from Car").executeUpdate();
  s.createQuery("delete from CarType").executeUpdate();
  t.commit();
  s.close();
}
