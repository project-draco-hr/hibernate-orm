{
  final Type elementType=persister.getElementType();
  final String indexNode=getIndexAttributeName(persister);
  final List elements=element.elements(persister.getElementNodeName());
  final HashMap snapshot=new HashMap(elements.size());
  for (int i=0; i < elements.size(); i++) {
    final Element elem=(Element)elements.get(i);
    final Object value=elementType.fromXMLNode(elem,persister.getFactory());
    final Object copy=elementType.deepCopy(value,persister.getFactory());
    snapshot.put(getIndex(elem,indexNode,i),copy);
  }
  return snapshot;
}
