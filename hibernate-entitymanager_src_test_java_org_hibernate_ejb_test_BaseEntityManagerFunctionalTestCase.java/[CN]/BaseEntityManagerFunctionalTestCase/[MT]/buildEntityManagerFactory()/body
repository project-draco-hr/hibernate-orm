{
  log.trace("Building session factory");
  ejb3Configuration=buildConfiguration();
  ejb3Configuration.configure(getConfig());
  afterConfigurationBuilt(ejb3Configuration);
  serviceRegistry=buildServiceRegistry(ejb3Configuration.getHibernateConfiguration());
  applyServices(serviceRegistry);
  entityManagerFactory=ejb3Configuration.buildEntityManagerFactory(serviceRegistry);
  afterEntityManagerFactoryBuilt();
}
