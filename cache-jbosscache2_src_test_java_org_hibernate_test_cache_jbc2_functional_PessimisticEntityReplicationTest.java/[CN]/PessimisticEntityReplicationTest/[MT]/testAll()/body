{
  System.out.println("*** testAll()");
  CacheManager localManager=TestCacheInstanceManager.getTestCacheManager(LOCAL);
  Cache localCache=localManager.getCache(getEntityCacheConfigName(),true);
  MyListener localListener=new MyListener();
  localCache.addCacheListener(localListener);
  TransactionManager localTM=localCache.getConfiguration().getRuntimeConfig().getTransactionManager();
  CacheManager remoteManager=TestCacheInstanceManager.getTestCacheManager(REMOTE);
  Cache remoteCache=remoteManager.getCache(getEntityCacheConfigName(),true);
  MyListener remoteListener=new MyListener();
  remoteCache.addCacheListener(remoteListener);
  TransactionManager remoteTM=remoteCache.getConfiguration().getRuntimeConfig().getTransactionManager();
  SessionFactory localFactory=getEnvironment().getSessionFactory();
  SessionFactory remoteFactory=getSecondNodeEnvironment().getSessionFactory();
  try {
    System.out.println("Create node 0");
    IdContainer ids=createCustomer(localFactory,localTM);
    sleep(SLEEP_TIME);
    System.out.println("Find node 0");
    getCustomer(ids.customerId,localFactory,localTM);
    System.out.println("Find(2) node 0");
    localListener.clear();
    getCustomer(ids.customerId,localFactory,localTM);
    System.out.println("Check cache 0");
    assertLoadedFromCache(localListener,ids.customerId,ids.contactIds);
    sleep(SLEEP_TIME);
    System.out.println("Find node 1");
    getCustomer(ids.customerId,remoteFactory,remoteTM);
    System.out.println("Check cache 1");
    assertLoadedFromCache(remoteListener,ids.customerId,ids.contactIds);
  }
  finally {
    System.out.println("Cleaning up");
    cleanup(localFactory,localTM);
  }
}
