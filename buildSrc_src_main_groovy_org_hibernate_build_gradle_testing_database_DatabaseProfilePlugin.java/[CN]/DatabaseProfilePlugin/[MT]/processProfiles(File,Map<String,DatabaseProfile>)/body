{
  DatabaseProfile databaseProfile=null;
  final File matrixDotGradleFile=new File(directory,MATRIX_BUILD_FILE);
  if (matrixDotGradleFile.exists() && matrixDotGradleFile.isFile()) {
    log.debug("Found matrix.gradle file : " + matrixDotGradleFile);
    databaseProfile=new MatrixDotGradleProfile(matrixDotGradleFile,project);
  }
  final File jdbcDirectory=new File(directory,JDBC_DIR);
  if (jdbcDirectory.exists() && jdbcDirectory.isDirectory()) {
    databaseProfile=new JdbcDirectoryProfile(jdbcDirectory,project);
  }
  if (databaseProfile == null) {
    for (    File subDirectory : directory.listFiles()) {
      if (subDirectory.isDirectory()) {
        processProfiles(subDirectory,profileMap);
      }
    }
    return;
  }
  final String profileName=databaseProfile.getName();
  if (ignored().contains(profileName)) {
    log.debug("Skipping ignored database profile [{}]",profileName);
    return;
  }
  DatabaseProfile previousEntry=profileMap.put(profileName,databaseProfile);
  if (previousEntry != null) {
    log.lifecycle("Found duplicate profile definitions [name={}], [{}] taking precedence over [{}]",profileName,databaseProfile.getDirectory().getAbsolutePath(),previousEntry.getDirectory().getAbsolutePath());
  }
}
