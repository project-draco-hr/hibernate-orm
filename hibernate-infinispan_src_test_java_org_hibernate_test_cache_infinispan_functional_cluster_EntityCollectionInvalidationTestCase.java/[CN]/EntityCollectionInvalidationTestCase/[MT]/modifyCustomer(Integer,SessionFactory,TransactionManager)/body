{
  log.debug("Modify customer with id=" + id);
  tm.begin();
  try {
    Session session=sessionFactory.getCurrentSession();
    IdContainer ids=new IdContainer();
    Set contactIds=new HashSet();
    Customer customer=doGetCustomer(id,session,tm);
    customer.setName("NewJBoss");
    ids.customerId=customer.getId();
    Set<Contact> contacts=customer.getContacts();
    for (    Contact c : contacts) {
      contactIds.add(c.getId());
    }
    Contact contact=contacts.iterator().next();
    contacts.remove(contact);
    contactIds.remove(contact.getId());
    ids.contactIds=contactIds;
    contact.setCustomer(null);
    session.save(customer);
    tm.commit();
    return ids;
  }
 catch (  Exception e) {
    try {
      tm.rollback();
    }
 catch (    Exception e1) {
      log.error("Exception rolling back txn",e1);
    }
    throw e;
  }
 finally {
    log.debug("Find customer ended.");
  }
}
