{
  deleteMembership(getUser(),getGroup(),getMembership());
  getUser().setMemberships(new HashSet());
  getGroup().setMemberships(new HashSet());
  addMembership(getUser(),getGroup(),createMembership("membership"));
  Session s=openSession();
  s.beginTransaction();
  try {
    s.merge(getUser());
    fail("should have failed because inserts are before deletes");
  }
 catch (  ConstraintViolationException ex) {
    s.getTransaction().rollback();
  }
 finally {
    s.close();
  }
}
