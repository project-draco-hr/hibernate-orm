{
  EntityManager em=getOrCreateEntityManager();
  CriteriaBuilder cb=em.getCriteriaBuilder();
  CriteriaQuery<Node> query=cb.createQuery(Node.class);
  Root<Batch> root=query.from(Batch.class);
  MapJoin nodes=(MapJoin)root.join("batchNodeMetadata");
  query.select(nodes.key());
  query.where(cb.equal(root.get("id"),1));
  em.createQuery(query).getResultList();
  em.close();
}
