{
  if (begun) {
    return;
  }
  if (commitFailed) {
    throw new TransactionException("cannot re-start transaction after failed commit");
  }
  LOG.begin();
  try {
    newTransaction=userTransaction.getStatus() == Status.STATUS_NO_TRANSACTION;
    if (newTransaction) {
      userTransaction.begin();
      LOG.beganNewJtaTransaction();
    }
  }
 catch (  Exception e) {
    LOG.error(LOG.unableToBeginJtaTransaction(),e);
    throw new TransactionException(LOG.unableToBeginJtaTransaction(),e);
  }
  boolean synchronization=jdbcContext.registerSynchronizationIfPossible();
  if (!newTransaction && !synchronization)   LOG.managerLookupClassShouldBeSet();
  if (!synchronization) {
    callback=jdbcContext.registerCallbackIfNecessary();
  }
  begun=true;
  commitSucceeded=false;
  jdbcContext.afterTransactionBegin(this);
}
