{
  if (begun) {
    return;
  }
  if (commitFailed) {
    throw new TransactionException("cannot re-start transaction after failed commit");
  }
  log.debug("begin");
  try {
    newTransaction=userTransaction.getStatus() == Status.STATUS_NO_TRANSACTION;
    if (newTransaction) {
      userTransaction.begin();
      log.debug("Began a new JTA transaction");
    }
  }
 catch (  Exception e) {
    log.error("JTA transaction begin failed",e);
    throw new TransactionException("JTA transaction begin failed",e);
  }
  boolean synchronization=jdbcContext.registerSynchronizationIfPossible();
  if (!newTransaction && !synchronization) {
    log.warn("You should set hibernate.transaction.manager_lookup_class if cache is enabled");
  }
  if (!synchronization) {
    callback=jdbcContext.registerCallbackIfNecessary();
  }
  begun=true;
  commitSucceeded=false;
  jdbcContext.afterTransactionBegin(this);
}
