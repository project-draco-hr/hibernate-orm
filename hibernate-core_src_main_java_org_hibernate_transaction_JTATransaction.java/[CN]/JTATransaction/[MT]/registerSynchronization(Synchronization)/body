{
  if (getTransactionManager() == null) {
    throw new IllegalStateException("JTA TransactionManager not available");
  }
 else {
    try {
      getTransactionManager().getTransaction().registerSynchronization(sync);
    }
 catch (    Exception e) {
      throw new TransactionException("could not register synchronization",e);
    }
  }
}
