{
  if (clazzToProcess.isAnnotationPresent(Entity.class) && clazzToProcess.isAnnotationPresent(MappedSuperclass.class)) {
    throw new AnnotationException("An entity cannot be annotated with both @Entity and @MappedSuperclass: " + clazzToProcess.getName());
  }
  InheritanceState inheritanceState=inheritanceStatePerClass.get(clazzToProcess);
  AnnotatedClassType classType=mappings.getClassType(clazzToProcess);
  if (AnnotatedClassType.EMBEDDABLE_SUPERCLASS.equals(classType)) {
    bindQueries(clazzToProcess,mappings);
    bindTypeDefs(clazzToProcess,mappings);
    bindFilterDefs(clazzToProcess,mappings);
  }
  if (!isEntityClassType(clazzToProcess,classType)) {
    return;
  }
  if (LOG.isDebugEnabled()) {
    LOG.debugf("Binding entity from annotated class: %s",clazzToProcess.getName());
  }
  PersistentClass superEntity=getSuperEntity(clazzToProcess,inheritanceStatePerClass,mappings,inheritanceState);
  PersistentClass persistentClass=makePersistentClass(inheritanceState,superEntity);
  Entity entityAnn=clazzToProcess.getAnnotation(Entity.class);
  org.hibernate.annotations.Entity hibEntityAnn=clazzToProcess.getAnnotation(org.hibernate.annotations.Entity.class);
  EntityBinder entityBinder=new EntityBinder(entityAnn,hibEntityAnn,clazzToProcess,persistentClass,mappings);
  entityBinder.setInheritanceState(inheritanceState);
  bindQueries(clazzToProcess,mappings);
  bindFilterDefs(clazzToProcess,mappings);
  bindTypeDefs(clazzToProcess,mappings);
  bindFetchProfiles(clazzToProcess,mappings);
  BinderHelper.bindAnyMetaDefs(clazzToProcess,mappings);
  String schema="";
  String table="";
  String catalog="";
  List<UniqueConstraintHolder> uniqueConstraints=new ArrayList<UniqueConstraintHolder>();
  javax.persistence.Table tabAnn=null;
  if (clazzToProcess.isAnnotationPresent(javax.persistence.Table.class)) {
    tabAnn=clazzToProcess.getAnnotation(javax.persistence.Table.class);
    table=tabAnn.name();
    schema=tabAnn.schema();
    catalog=tabAnn.catalog();
    uniqueConstraints=TableBinder.buildUniqueConstraintHolders(tabAnn.uniqueConstraints());
  }
  Ejb3JoinColumn[] inheritanceJoinedColumns=makeInheritanceJoinColumns(clazzToProcess,mappings,inheritanceState,superEntity);
  Ejb3DiscriminatorColumn discriminatorColumn=null;
  if (InheritanceType.SINGLE_TABLE.equals(inheritanceState.getType())) {
    discriminatorColumn=processDiscriminatorProperties(clazzToProcess,mappings,inheritanceState,entityBinder);
  }
  entityBinder.setProxy(clazzToProcess.getAnnotation(Proxy.class));
  entityBinder.setBatchSize(clazzToProcess.getAnnotation(BatchSize.class));
  entityBinder.setWhere(clazzToProcess.getAnnotation(Where.class));
  entityBinder.setCache(determineCacheSettings(clazzToProcess,mappings));
  entityBinder.setNaturalIdCache(clazzToProcess,clazzToProcess.getAnnotation(NaturalIdCache.class));
  bindFilters(clazzToProcess,entityBinder,mappings);
  entityBinder.bindEntity();
  if (inheritanceState.hasTable()) {
    Check checkAnn=clazzToProcess.getAnnotation(Check.class);
    String constraints=checkAnn == null ? null : checkAnn.constraints();
    entityBinder.bindTable(schema,catalog,table,uniqueConstraints,constraints,inheritanceState.hasDenormalizedTable() ? superEntity.getTable() : null);
  }
 else   if (clazzToProcess.isAnnotationPresent(Table.class)) {
    LOG.invalidTableAnnotation(clazzToProcess.getName());
  }
  PropertyHolder propertyHolder=PropertyHolderBuilder.buildPropertyHolder(clazzToProcess,persistentClass,entityBinder,mappings,inheritanceStatePerClass);
  javax.persistence.SecondaryTable secTabAnn=clazzToProcess.getAnnotation(javax.persistence.SecondaryTable.class);
  javax.persistence.SecondaryTables secTabsAnn=clazzToProcess.getAnnotation(javax.persistence.SecondaryTables.class);
  entityBinder.firstLevelSecondaryTablesBinding(secTabAnn,secTabsAnn);
  OnDelete onDeleteAnn=clazzToProcess.getAnnotation(OnDelete.class);
  boolean onDeleteAppropriate=false;
  if (InheritanceType.JOINED.equals(inheritanceState.getType()) && inheritanceState.hasParents()) {
    onDeleteAppropriate=true;
    final JoinedSubclass jsc=(JoinedSubclass)persistentClass;
    SimpleValue key=new DependantValue(mappings,jsc.getTable(),jsc.getIdentifier());
    jsc.setKey(key);
    ForeignKey fk=clazzToProcess.getAnnotation(ForeignKey.class);
    if (fk != null && !BinderHelper.isEmptyAnnotationValue(fk.name())) {
      key.setForeignKeyName(fk.name());
    }
    if (onDeleteAnn != null) {
      key.setCascadeDeleteEnabled(OnDeleteAction.CASCADE.equals(onDeleteAnn.action()));
    }
 else {
      key.setCascadeDeleteEnabled(false);
    }
    SecondPass sp=new JoinedSubclassFkSecondPass(jsc,inheritanceJoinedColumns,key,mappings);
    mappings.addSecondPass(sp);
    mappings.addSecondPass(new CreateKeySecondPass(jsc));
  }
 else   if (InheritanceType.SINGLE_TABLE.equals(inheritanceState.getType())) {
    if (!inheritanceState.hasParents()) {
      if (inheritanceState.hasSiblings() || !discriminatorColumn.isImplicit()) {
        bindDiscriminatorToPersistentClass((RootClass)persistentClass,discriminatorColumn,entityBinder.getSecondaryTables(),propertyHolder,mappings);
        entityBinder.bindDiscriminatorValue();
      }
    }
  }
 else   if (InheritanceType.TABLE_PER_CLASS.equals(inheritanceState.getType())) {
  }
  if (onDeleteAnn != null && !onDeleteAppropriate)   LOG.invalidOnDeleteAnnotation(propertyHolder.getEntityName());
  HashMap<String,IdGenerator> classGenerators=buildLocalGenerators(clazzToProcess,mappings);
  final InheritanceState.ElementsToProcess elementsToProcess=inheritanceState.getElementsToProcess();
  inheritanceState.postProcess(persistentClass,entityBinder);
  final boolean subclassAndSingleTableStrategy=inheritanceState.getType() == InheritanceType.SINGLE_TABLE && inheritanceState.hasParents();
  Set<String> idPropertiesIfIdClass=new HashSet<String>();
  boolean isIdClass=mapAsIdClass(inheritanceStatePerClass,inheritanceState,persistentClass,entityBinder,propertyHolder,elementsToProcess,idPropertiesIfIdClass,mappings);
  if (!isIdClass) {
    entityBinder.setWrapIdsInEmbeddedComponents(elementsToProcess.getIdPropertyCount() > 1);
  }
  processIdPropertiesIfNotAlready(inheritanceStatePerClass,mappings,persistentClass,entityBinder,propertyHolder,classGenerators,elementsToProcess,subclassAndSingleTableStrategy,idPropertiesIfIdClass);
  if (!inheritanceState.hasParents()) {
    final RootClass rootClass=(RootClass)persistentClass;
    mappings.addSecondPass(new CreateKeySecondPass(rootClass));
  }
 else {
    superEntity.addSubclass((Subclass)persistentClass);
  }
  mappings.addClass(persistentClass);
  mappings.addSecondPass(new SecondaryTableSecondPass(entityBinder,propertyHolder,clazzToProcess));
  entityBinder.processComplementaryTableDefinitions(clazzToProcess.getAnnotation(org.hibernate.annotations.Table.class));
  entityBinder.processComplementaryTableDefinitions(clazzToProcess.getAnnotation(org.hibernate.annotations.Tables.class));
  entityBinder.processComplementaryTableDefinitions(tabAnn);
}
