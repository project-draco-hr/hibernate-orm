{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Human friend=new Human();
  friend.setName(new Name("Bob",'B',"Bobbert"));
  s.save(friend);
  Human brett=new Human();
  brett.setName(new Name("Brett",'E',"Meyer"));
  brett.setFriends(new ArrayList());
  brett.getFriends().add(friend);
  s.save(brett);
  s.flush();
  Zoo zoo=new Zoo();
  Map directors=new HashMap();
  directors.put(brett.getId().toString(),brett);
  zoo.setDirectors(directors);
  s.save(zoo);
  s.flush();
  try {
    s.createQuery("delete from Zoo").executeUpdate();
    s.createQuery("delete from Human").executeUpdate();
  }
 catch (  ConstraintViolationException cve) {
    fail("The join table was not cleared prior to the bulk delete.");
  }
 finally {
    t.rollback();
    s.close();
  }
}
