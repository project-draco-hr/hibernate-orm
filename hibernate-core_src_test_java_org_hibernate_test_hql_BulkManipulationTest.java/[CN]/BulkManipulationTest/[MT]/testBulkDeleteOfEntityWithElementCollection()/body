{
{
    Session s=openSession();
    s.beginTransaction();
    Farm farm=new Farm();
    farm.setName("Old McDonald Farm 'o the Earth");
    farm.setAccreditations(new HashSet<Farm.Accreditation>());
    farm.getAccreditations().add(Farm.Accreditation.ORGANIC);
    farm.getAccreditations().add(Farm.Accreditation.SUSTAINABLE);
    s.save(farm);
    s.getTransaction().commit();
    s.close();
  }
{
    Session s=openSession();
    s.beginTransaction();
    s.doWork(new Work(){
      @Override public void execute(      Connection connection) throws SQLException {
        final Statement statement=connection.createStatement();
        final ResultSet resultSet=statement.executeQuery("select count(*) from farm_accreditations");
        assertTrue(resultSet.next());
        final int count=resultSet.getInt(1);
        assertEquals(2,count);
      }
    }
);
    s.getTransaction().commit();
    s.close();
  }
{
    Session s=openSession();
    s.beginTransaction();
    s.createQuery("delete Farm").executeUpdate();
    s.getTransaction().commit();
    s.close();
  }
{
    Session s=openSession();
    s.beginTransaction();
    s.doWork(new Work(){
      @Override public void execute(      Connection connection) throws SQLException {
        final Statement statement=connection.createStatement();
        final ResultSet resultSet=statement.executeQuery("select count(*) from farm_accreditations");
        assertTrue(resultSet.next());
        final int count=resultSet.getInt(1);
        assertEquals(0,count);
      }
    }
);
    s.getTransaction().commit();
    s.close();
  }
}
