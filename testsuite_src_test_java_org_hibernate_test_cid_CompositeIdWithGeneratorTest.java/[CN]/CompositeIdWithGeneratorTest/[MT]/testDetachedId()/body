{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Date timestamp1=new Date();
  Date timestamp2=new Date(timestamp1.getTime() + 1);
  PurchaseRecord record1=new PurchaseRecord();
  record1.setTimestamp(timestamp1);
  PurchaseRecord record2=new PurchaseRecord();
  record2.setTimestamp(timestamp2);
  s.persist(record1);
  s.persist(record2);
  t.commit();
  s.close();
  PurchaseRecord.Id generatedId1=record1.getId();
  PurchaseRecord.Id generatedId2=record2.getId();
  PurchaseRecord.Id toChangeId1=new PurchaseRecord.Id();
  toChangeId1.setPurchaseNumber(record2.getId().getPurchaseNumber());
  toChangeId1.setPurchaseSequence(record2.getId().getPurchaseSequence());
  record1.setId(toChangeId1);
  s=openSession();
  t=s.beginTransaction();
  PurchaseRecord find1=(PurchaseRecord)s.get(PurchaseRecord.class,generatedId1);
  PurchaseRecord find2=(PurchaseRecord)s.get(PurchaseRecord.class,generatedId2);
  t.commit();
  s.close();
  assertEquals(generatedId1,find1.getId());
  assertEquals(timestamp1,find1.getTimestamp());
  assertEquals(generatedId2,find2.getId());
  assertEquals(timestamp2,find2.getTimestamp());
  s=openSession();
  t=s.beginTransaction();
  s.update(record1);
  t.commit();
  s.close();
  PurchaseRecord.Id foundId1=record1.getId();
  assertSame(toChangeId1,foundId1);
  assertEquals(toChangeId1.getPurchaseNumber(),foundId1.getPurchaseNumber());
  assertEquals(toChangeId1.getPurchaseSequence(),foundId1.getPurchaseSequence());
  s=openSession();
  t=s.beginTransaction();
  find2=(PurchaseRecord)s.get(PurchaseRecord.class,generatedId2);
  t.commit();
  s.close();
  assertEquals(timestamp1,find2.getTimestamp());
  assertEquals(generatedId2,find2.getId());
}
