{
  if (sessionFactory != null) {
    throw new IllegalStateException("attempt to initialize already initialized ExecutionEnvironment");
  }
  if (!settings.appliesTo(getDialect())) {
    return;
  }
  this.conectionProviderInjectionProperties=conectionProviderInjectionProperties;
  Configuration configuration=new Configuration();
  configuration.setProperty(Environment.CACHE_PROVIDER,"org.hibernate.cache.HashtableCacheProvider");
  settings.configure(configuration);
  if (settings.createSchema()) {
    configuration.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
  }
  configuration.setProperty(Environment.DIALECT,getDialect().getClass().getName());
  applyMappings(configuration);
  configuration.buildMappings();
  applyCacheSettings(configuration);
  settings.afterConfigurationBuilt(configuration.createMappings(),getDialect());
  this.configuration=configuration;
  serviceRegistry=ServiceRegistryBuilder.buildServiceRegistry(getServiceRegistryProperties());
  sessionFactory=configuration.buildSessionFactory(serviceRegistry);
  settings.afterSessionFactoryBuilt((SessionFactoryImplementor)sessionFactory);
}
