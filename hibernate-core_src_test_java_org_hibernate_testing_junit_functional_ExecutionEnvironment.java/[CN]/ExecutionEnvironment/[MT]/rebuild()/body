{
  if (!allowRebuild) {
    return;
  }
  if (sessionFactory != null) {
    sessionFactory.close();
    sessionFactory=null;
  }
  if (serviceRegistryHolder != null) {
    serviceRegistryHolder.destroy();
    serviceRegistryHolder=null;
  }
  serviceRegistryHolder=new ServiceRegistryHolder(getServiceRegistryProperties());
  sessionFactory=configuration.buildSessionFactory(serviceRegistryHolder.getServiceRegistry());
  settings.afterSessionFactoryBuilt((SessionFactoryImplementor)sessionFactory);
}
