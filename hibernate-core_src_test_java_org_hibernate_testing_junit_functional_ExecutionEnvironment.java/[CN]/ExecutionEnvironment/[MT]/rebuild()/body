{
  if (!allowRebuild) {
    return;
  }
  if (sessionFactory != null) {
    sessionFactory.close();
    sessionFactory=null;
  }
  if (serviceRegistry != null) {
    ServiceRegistryBuilder.destroy(serviceRegistry);
  }
  serviceRegistry=ServiceRegistryBuilder.buildServiceRegistry(getServiceRegistryProperties());
  sessionFactory=configuration.buildSessionFactory(serviceRegistry);
  settings.afterSessionFactoryBuilt((SessionFactoryImplementor)sessionFactory);
}
