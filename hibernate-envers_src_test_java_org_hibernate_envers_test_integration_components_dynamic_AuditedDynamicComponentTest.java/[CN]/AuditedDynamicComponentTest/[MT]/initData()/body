{
  Session session=openSession();
  SimpleEntity simpleEntity=new SimpleEntity(1L,"Very simple entity");
  session.getTransaction().begin();
  session.save(simpleEntity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  AuditedDynamicComponentEntity entity=new AuditedDynamicComponentEntity(1L,"static field value");
  entity.getCustomFields().put("prop1",13);
  entity.getCustomFields().put("prop2",0.1f);
  entity.getCustomFields().put("prop3",simpleEntity);
  session.save(entity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  SimpleEntity simpleEntity2=new SimpleEntity(2L,"Not so simple entity");
  session.save(simpleEntity2);
  entity=(AuditedDynamicComponentEntity)session.get(AuditedDynamicComponentEntity.class,entity.getId());
  entity.getCustomFields().put("prop3",simpleEntity2);
  session.update(entity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  entity=(AuditedDynamicComponentEntity)session.get(AuditedDynamicComponentEntity.class,entity.getId());
  entity.getCustomFields().put("prop1",2);
  session.update(entity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  entity=(AuditedDynamicComponentEntity)session.load(AuditedDynamicComponentEntity.class,entity.getId());
  entity.getCustomFields().remove("prop2");
  session.update(entity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  entity=(AuditedDynamicComponentEntity)session.load(AuditedDynamicComponentEntity.class,entity.getId());
  entity.getCustomFields().clear();
  session.update(entity);
  session.getTransaction().commit();
  session.getTransaction().begin();
  entity=(AuditedDynamicComponentEntity)session.load(AuditedDynamicComponentEntity.class,entity.getId());
  session.delete(entity);
  session.getTransaction().commit();
  session.close();
}
