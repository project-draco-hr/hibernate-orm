{
  if (PersistenceType.BASIC.equals(getAttribute().getKeyType().getPersistenceType())) {
    throw new BasicPathUsageException("Cannot join to map key of basic type",getAttribute());
  }
  if (jt.equals(JoinType.RIGHT)) {
    throw new UnsupportedOperationException("RIGHT JOIN not supported");
  }
  final MapKeyHelpers.MapPath<K,V> mapKeySource=new MapKeyHelpers.MapPath<K,V>(queryBuilder(),getAttribute().getJavaType(),this,getAttribute(),getParentPath().getModel());
  final MapKeyHelpers.MapKeyAttribute mapKeyAttribute=new MapKeyHelpers.MapKeyAttribute(queryBuilder(),getAttribute());
  final Join<Map<K,V>,K> join=new MapKeyHelpers.MapKeyJoin<K,V>(queryBuilder(),mapKeySource,mapKeyAttribute,jt);
  return join;
}
