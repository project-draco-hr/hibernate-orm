{
  log.tracef("%s Starting entity identifier : %s",StringHelper.repeat(">>",fetchOwnerStack.size()),entityIdentifierDefinition.getEntityDefinition().getEntityPersister().getEntityName());
  final EntityReference entityReference=(EntityReference)currentFetchOwner();
  if (!entityReference.getEntityPersister().equals(entityIdentifierDefinition.getEntityDefinition().getEntityPersister())) {
    throw new WalkingException(String.format("Encountered unexpected fetch owner [%s] in stack while processing entity identifier for [%s]",entityReference.getEntityPersister().getEntityName(),entityIdentifierDefinition.getEntityDefinition().getEntityPersister().getEntityName()));
  }
  final FetchOwner identifierAttributeCollector;
  if (entityIdentifierDefinition.isEncapsulated()) {
    identifierAttributeCollector=new EncapsulatedIdentifierAttributeCollector(sessionFactory,entityReference);
  }
 else {
    identifierAttributeCollector=new NonEncapsulatedIdentifierAttributeCollector(sessionFactory,entityReference);
  }
  pushToStack(identifierAttributeCollector);
}
