{
  if (EntityFetch.class.isInstance(entityReference)) {
    final EntityFetch entityFetch=(EntityFetch)entityReference;
    final FetchOwner entityFetchOwner=entityFetch.getOwner();
    final EntityType attributeDefinitionTypeAsEntityType=(EntityType)attributeDefinition.getType();
    final boolean sameType=attributeDefinitionTypeAsEntityType.getAssociatedEntityName().equals(entityFetchOwner.retrieveFetchSourcePersister().getEntityName());
    if (sameType) {
      return new KeyManyToOneBidirectionalEntityFetch(sessionFactory(),LockMode.READ,this,attributeDefinition,(EntityReference)entityFetchOwner,fetchStrategy);
    }
  }
  final EntityFetch fetch=super.buildEntityFetch(attributeDefinition,fetchStrategy,loadPlanBuildingContext);
  fetchToHydratedStateExtractorMap.put(fetch,attributeDefinition.getHydratedCompoundValueExtractor());
  return fetch;
}
