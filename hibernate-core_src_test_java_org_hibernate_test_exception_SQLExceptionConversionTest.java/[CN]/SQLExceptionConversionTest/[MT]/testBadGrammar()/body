{
  final Session session=openSession();
  session.beginTransaction();
  session.doWork(new Work(){
    @Override public void execute(    Connection connection) throws SQLException {
      PreparedStatement ps=null;
      try {
        ps=((SessionImplementor)session).getTransactionCoordinator().getJdbcCoordinator().getStatementPreparer().prepareStatement("SELECT user_id, user_name FROM tbl_no_there");
        ((SessionImplementor)session).getTransactionCoordinator().getJdbcCoordinator().getResultSetReturn().extract(ps);
        fail("SQL compilation should have failed");
      }
 catch (      SQLGrammarException ignored) {
      }
 finally {
        if (ps != null) {
          try {
            ((SessionImplementor)session).getTransactionCoordinator().getJdbcCoordinator().release(ps);
          }
 catch (          Throwable ignore) {
          }
        }
      }
    }
  }
);
  session.getTransaction().rollback();
  session.close();
}
