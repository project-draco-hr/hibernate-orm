{
  if (!criteria.isLookupByNaturalKey()) {
    return null;
  }
  final String entityName=criteria.getEntityOrClassName();
  final EntityPersister entityPersister=getFactory().getMetamodel().entityPersister(entityName);
  if (!entityPersister.hasNaturalIdentifier()) {
    return null;
  }
  final CriterionEntry criterionEntry=criteria.iterateExpressionEntries().next();
  final NaturalIdentifier naturalIdentifier=(NaturalIdentifier)criterionEntry.getCriterion();
  final Map<String,Object> naturalIdValues=naturalIdentifier.getNaturalIdValues();
  final int[] naturalIdentifierProperties=entityPersister.getNaturalIdentifierProperties();
  if (naturalIdentifierProperties.length != naturalIdValues.size()) {
    return null;
  }
  final String[] propertyNames=entityPersister.getPropertyNames();
  final NaturalIdLoadAccess naturalIdLoader=this.byNaturalId(entityName);
  for (  int naturalIdentifierProperty : naturalIdentifierProperties) {
    final String naturalIdProperty=propertyNames[naturalIdentifierProperty];
    final Object naturalIdValue=naturalIdValues.get(naturalIdProperty);
    if (naturalIdValue == null) {
      return null;
    }
    naturalIdLoader.using(naturalIdProperty,naturalIdValue);
  }
  log.warn("Session.byNaturalId(" + entityName + ") should be used for naturalId queries instead of Restrictions.naturalId() from a Criteria");
  return naturalIdLoader;
}
