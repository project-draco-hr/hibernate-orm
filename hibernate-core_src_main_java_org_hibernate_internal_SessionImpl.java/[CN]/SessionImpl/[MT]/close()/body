{
  log.tracef("Closing session [%s]",getSessionIdentifier());
  if (getSessionFactory().getSessionFactoryOptions().isJpaBootstrap()) {
    checkSessionFactoryOpen();
    checkOpen();
    if (discardOnClose || !isTransactionInProgress()) {
      super.close();
    }
 else {
      waitingForAutoClose=true;
      closed=true;
    }
  }
 else {
    super.close();
    if (getFactory().getStatistics().isStatisticsEnabled()) {
      getFactory().getStatistics().closeSession();
    }
  }
}
