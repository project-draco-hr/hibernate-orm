{
  while (!processes.isEmpty()) {
    try {
      processes.poll().doAfterTransactionCompletion(success,session);
    }
 catch (    CacheException ce) {
      LOG.unableToReleaseCacheLock(ce);
    }
catch (    Exception e) {
      throw new AssertionFailure("Exception releasing cache locks",e);
    }
  }
  if (session.getFactory().getSessionFactoryOptions().isQueryCacheEnabled()) {
    session.getFactory().getUpdateTimestampsCache().invalidate(querySpacesToInvalidate.toArray(new String[querySpacesToInvalidate.size()]),session);
  }
  querySpacesToInvalidate.clear();
}
