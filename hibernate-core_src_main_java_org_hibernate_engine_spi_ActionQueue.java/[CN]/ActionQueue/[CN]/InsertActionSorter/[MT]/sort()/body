{
  for (  EntityInsertAction action : (List<EntityInsertAction>)insertions) {
    String entityName=action.getEntityName();
    Object currentEntity=action.getInstance();
    Integer batchNumber;
    if (latestBatches.containsKey(entityName)) {
      batchNumber=findBatchNumber(action,entityName);
    }
 else {
      batchNumber=actionBatches.size();
      latestBatches.put(entityName,batchNumber);
    }
    entityBatchNumber.put(currentEntity,batchNumber);
    addToBatch(batchNumber,action);
  }
  insertions.clear();
  for (int i=0; i < actionBatches.size(); i++) {
    List<EntityInsertAction> batch=actionBatches.get(i);
    for (    EntityInsertAction action : batch) {
      insertions.add(action);
    }
  }
}
