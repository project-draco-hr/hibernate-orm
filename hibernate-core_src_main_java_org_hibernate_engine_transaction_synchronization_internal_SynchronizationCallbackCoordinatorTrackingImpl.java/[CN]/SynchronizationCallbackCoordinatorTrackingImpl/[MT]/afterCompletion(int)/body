{
  if (JtaStatusHelper.isRollback(status)) {
    final long currentThreadId=Thread.currentThread().getId();
    final boolean isRegistrationThread=currentThreadId == registrationThreadId;
    if (!isRegistrationThread) {
      delayedCompletionHandlingStatus=status;
      transactionCoordinator().getJdbcCoordinator().getLogicalConnection().close();
      log.rollbackFromBackgroundThread(status);
      return;
    }
  }
  doAfterCompletion(status);
}
