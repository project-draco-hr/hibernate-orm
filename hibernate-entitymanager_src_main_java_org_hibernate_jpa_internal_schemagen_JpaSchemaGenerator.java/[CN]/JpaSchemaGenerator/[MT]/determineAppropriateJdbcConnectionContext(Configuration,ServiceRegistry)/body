{
  final SqlStatementLogger sqlStatementLogger=serviceRegistry.getService(JdbcServices.class).getSqlStatementLogger();
  final Connection providedConnection=(Connection)hibernateConfiguration.getProperties().get(AvailableSettings.SCHEMA_GEN_CONNECTION);
  if (providedConnection != null) {
    return new JdbcConnectionContext(new ProvidedJdbcConnectionAccess(providedConnection),sqlStatementLogger);
  }
  final ConnectionProvider connectionProvider=serviceRegistry.getService(ConnectionProvider.class);
  if (connectionProvider != null) {
    return new JdbcConnectionContext(new ConnectionProviderJdbcConnectionAccess(connectionProvider),sqlStatementLogger);
  }
  return new JdbcConnectionContext(null,sqlStatementLogger){
    @Override public Connection getJdbcConnection(){
      throw new PersistenceException("No connection information supplied");
    }
  }
;
}
