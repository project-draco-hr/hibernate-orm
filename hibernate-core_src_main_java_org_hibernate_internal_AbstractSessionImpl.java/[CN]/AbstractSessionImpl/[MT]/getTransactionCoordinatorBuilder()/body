{
  TransactionCoordinatorBuilder transactionCoordinatorBuilder=factory.getServiceRegistry().getService(TransactionCoordinatorBuilder.class);
  if (transactionCoordinatorBuilder instanceof TransactionCoordinatorJtaBuilder) {
    ((TransactionCoordinatorJtaBuilder)transactionCoordinatorBuilder).setJtaPlatform(factory.getSettings().getJtaPlatform()).setAutoJoinTransactions(shouldAutoJoinTransaction()).setPerformJtaThreadTracking(factory.getSettings().isJtaTrackByThread()).setPreferUserTransactions(factory.getSettings().isPreferUserTransaction());
  }
  return transactionCoordinatorBuilder;
}
