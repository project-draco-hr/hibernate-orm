{
  final boolean autoRegister=ConfigurationHelper.getBoolean(AUTO_REGISTER,configuration.getProperties(),true);
  if (!autoRegister) {
    LOG.debug("Skipping Envers listener auto registration");
    return;
  }
  EventListenerRegistry listenerRegistry=serviceRegistry.getService(EventListenerRegistry.class);
  listenerRegistry.addDuplicationStrategy(EnversListenerDuplicationStrategy.INSTANCE);
  final AuditConfiguration enversConfiguration=AuditConfiguration.getFor(configuration);
  if (enversConfiguration.getEntCfg().hasAuditedEntities()) {
    listenerRegistry.appendListeners(EventType.POST_DELETE,new EnversPostDeleteEventListenerImpl(enversConfiguration));
    listenerRegistry.appendListeners(EventType.POST_INSERT,new EnversPostInsertEventListenerImpl(enversConfiguration));
    listenerRegistry.appendListeners(EventType.POST_UPDATE,new EnversPostUpdateEventListenerImpl(enversConfiguration));
    listenerRegistry.appendListeners(EventType.POST_COLLECTION_RECREATE,new EnversPostCollectionRecreateEventListenerImpl(enversConfiguration));
    listenerRegistry.appendListeners(EventType.PRE_COLLECTION_REMOVE,new EnversPreCollectionRemoveEventListenerImpl(enversConfiguration));
    listenerRegistry.appendListeners(EventType.PRE_COLLECTION_UPDATE,new EnversPreCollectionUpdateEventListenerImpl(enversConfiguration));
  }
}
