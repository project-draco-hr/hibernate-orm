{
  Session s=openSession();
  s.beginTransaction();
  ProxyBean proxyBean=new ProxyBean();
  proxyBean.setSomeString("my-bean");
  proxyBean.setSomeLong(1234);
  s.save(proxyBean);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  proxyBean=(ProxyBean)s.load(ProxyBean.class,proxyBean.getSomeString());
  assertTrue(proxyBean instanceof HibernateProxy);
  try {
    Field field=proxyBean.getClass().getDeclaredField("CGLIB$THREAD_CALLBACKS");
    field.setAccessible(true);
    ThreadLocal threadCallbacksThreadLocal=(ThreadLocal)field.get(null);
    assertTrue(threadCallbacksThreadLocal.get() == null);
  }
 catch (  NoSuchFieldException e1) {
    fail("unable to find CGLIB$THREAD_CALLBACKS field in proxy.");
  }
catch (  Throwable t) {
    fail("unexpected exception type : " + t);
  }
 finally {
    s.delete(proxyBean);
    s.getTransaction().commit();
    s.close();
  }
}
