{
  this.audited=audited;
  cfg=new Ejb3Configuration();
  Properties configValues=cfg.getProperties();
  if (!audited) {
    configValues.setProperty(EnversIntegrator.AUTO_REGISTER,"false");
  }
  configValues.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
  configValues.setProperty(Environment.DIALECT,"org.hibernate.dialect.H2Dialect");
  configValues.setProperty(Environment.DRIVER,"org.h2.Driver");
  configValues.setProperty(Environment.USER,"sa");
  configValues.setProperty(Environment.URL,"jdbc:h2:mem:" + this.getClass().getName() + ";DB_CLOSE_DELAY=-1");
  if (auditStrategy != null && !"".equals(auditStrategy)) {
    cfg.setProperty("org.hibernate.envers.audit_strategy",auditStrategy);
  }
  configure(cfg);
  serviceRegistry=(BasicServiceRegistryImpl)new ServiceRegistryBuilder(configValues).buildServiceRegistry();
  emf=cfg.buildEntityManagerFactory(serviceRegistry);
  newEntityManager();
}
