{
  this.audited=audited;
  Properties configurationProperties=new Properties();
  if (!audited) {
    configurationProperties.setProperty(EnversIntegrator.AUTO_REGISTER,"false");
  }
  configurationProperties.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
  configurationProperties.setProperty(Environment.DIALECT,"org.hibernate.dialect.H2Dialect");
  configurationProperties.setProperty(Environment.DRIVER,"org.h2.Driver");
  configurationProperties.setProperty(Environment.USER,"sa");
  configurationProperties.setProperty(Environment.URL,"jdbc:h2:mem:" + this.getClass().getName() + ";DB_CLOSE_DELAY=-1");
  if (auditStrategy != null && !"".equals(auditStrategy)) {
    configurationProperties.setProperty("org.hibernate.envers.audit_strategy",auditStrategy);
  }
  addConfigurationProperties(configurationProperties);
  cfg=new Ejb3Configuration();
  configure(cfg);
  cfg.configure(configurationProperties);
  serviceRegistry=createServiceRegistry(cfg);
  emf=cfg.buildEntityManagerFactory(serviceRegistry);
  newEntityManager();
}
