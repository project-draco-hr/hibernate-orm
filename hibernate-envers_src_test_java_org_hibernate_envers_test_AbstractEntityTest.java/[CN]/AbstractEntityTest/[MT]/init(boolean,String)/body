{
  this.audited=audited;
  cfg=new Ejb3Configuration();
  if (!audited) {
    cfg.setProperty(EnversIntegrator.AUTO_REGISTER,"false");
  }
  cfg.configure("hibernate.test.cfg.xml");
  if (auditStrategy != null && !"".equals(auditStrategy)) {
    cfg.setProperty("org.hibernate.envers.audit_strategy",auditStrategy);
  }
  cfg.setProperty(Environment.URL,"jdbc:h2:mem:" + this.getClass().getName());
  configure(cfg);
  cfg.configure(cfg.getHibernateConfiguration().getProperties());
  serviceRegistry=new BasicServiceRegistryImpl(cfg.getProperties());
  emf=cfg.buildEntityManagerFactory(serviceRegistry);
  newEntityManager();
}
