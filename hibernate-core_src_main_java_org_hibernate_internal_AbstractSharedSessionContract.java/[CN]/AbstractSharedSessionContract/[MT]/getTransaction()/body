{
  if (getFactory().getSessionFactoryOptions().isJpaBootstrap()) {
    if (getTransactionCoordinator().getTransactionCoordinatorBuilder().isJta()) {
      if (!getFactory().getSessionFactoryOptions().isJtaTransactionAccessEnabled()) {
        throw new IllegalStateException("A JTA EntityManager cannot use getTransaction()");
      }
    }
  }
  return accessTransaction();
}
