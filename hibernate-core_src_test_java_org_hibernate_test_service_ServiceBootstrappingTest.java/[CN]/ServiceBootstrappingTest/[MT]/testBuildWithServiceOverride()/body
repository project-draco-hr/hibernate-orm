{
  BasicServiceRegistryImpl serviceRegistry=(BasicServiceRegistryImpl)new ServiceRegistryBuilder(ConnectionProviderBuilder.getConnectionProviderProperties()).buildServiceRegistry();
  JdbcServices jdbcServices=serviceRegistry.getService(JdbcServices.class);
  assertTrue(jdbcServices.getDialect() instanceof H2Dialect);
  assertTrue(jdbcServices.getConnectionProvider().isUnwrappableAs(DriverManagerConnectionProviderImpl.class));
  Properties props=ConnectionProviderBuilder.getConnectionProviderProperties();
  props.setProperty(Environment.DIALECT,H2Dialect.class.getName());
  serviceRegistry=(BasicServiceRegistryImpl)new ServiceRegistryBuilder(props).addService(ConnectionProvider.class,new UserSuppliedConnectionProviderImpl()).buildServiceRegistry();
  jdbcServices=serviceRegistry.getService(JdbcServices.class);
  assertTrue(jdbcServices.getDialect() instanceof H2Dialect);
  assertTrue(jdbcServices.getConnectionProvider().isUnwrappableAs(UserSuppliedConnectionProviderImpl.class));
  serviceRegistry.destroy();
}
