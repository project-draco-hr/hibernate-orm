{
  SessionFactoryImplementor sf=(SessionFactoryImplementor)new Configuration().setProperty(AvailableSettings.TRANSACTION_STRATEGY,JtaTransactionFactory.SHORT_NAME).setProperty(AvailableSettings.AUTO_CLOSE_SESSION,"true").buildSessionFactory();
  JournalingInterceptor interceptor=new JournalingInterceptor();
  try {
    JtaPlatform instance=sf.getServiceRegistry().getService(JtaPlatform.class);
    TransactionManager transactionManager=instance.retrieveTransactionManager();
    transactionManager.begin();
    Session session=sf.withOptions().interceptor(interceptor).openSession();
    transactionManager.commit();
    if (session.isOpen()) {
      try {
        session.close();
      }
 catch (      Exception ignore) {
      }
      fail("auto-close-session setting did not close session");
    }
  }
  finally {
    sf.close();
  }
  assertEquals(0,interceptor.afterStart);
  assertEquals(1,interceptor.beforeCompletion);
  assertEquals(1,interceptor.afterCompletion);
}
