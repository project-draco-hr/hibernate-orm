{
  if (!transactionCoordinator.getJdbcCoordinator().getLogicalConnection().isReadyForSerialization()) {
    throw new IllegalStateException("Cannot serialize a session while connected");
  }
  log.trace("serializing session");
  oos.defaultWriteObject();
  oos.writeBoolean(rootSession == null);
  oos.writeObject(connectionReleaseMode.toString());
  oos.writeObject(entityMode.toString());
  oos.writeBoolean(autoClear);
  oos.writeObject(flushMode.toString());
  oos.writeObject(cacheMode.toString());
  oos.writeBoolean(flushBeforeCompletionEnabled);
  oos.writeBoolean(autoCloseSessionEnabled);
  oos.writeObject(interceptor);
  factory.serialize(oos);
  if (rootSession == null) {
    transactionCoordinator.serialize(oos);
  }
  persistenceContext.serialize(oos);
  actionQueue.serialize(oos);
  oos.writeObject(loadQueryInfluencers);
  oos.writeObject(childSessionsByEntityMode);
}
