{
  if (currentReturnDescriptor == null) {
    if (executed) {
      throw new IllegalStateException("Unexpected condition");
    }
 else {
      throw new IllegalStateException("hasMoreReturns() not called before getNextReturn()");
    }
  }
  if (!hasMoreResults(currentReturnDescriptor)) {
    throw new IllegalStateException("Results have been exhausted");
  }
  CurrentReturnDescriptor copyReturnDescriptor=currentReturnDescriptor;
  currentReturnDescriptor=null;
  if (copyReturnDescriptor.isResultSet) {
    try {
      return new ResultSetReturn(this,callableStatement.getResultSet());
    }
 catch (    SQLException e) {
      throw convert(e,"Error calling CallableStatement.getResultSet");
    }
  }
 else   if (copyReturnDescriptor.updateCount >= 0) {
    return new UpdateCountReturn(this,copyReturnDescriptor.updateCount);
  }
 else {
    this.refCursorParamIndex++;
    ResultSet resultSet;
    int refCursorParamIndex=copyReturnDescriptor.refCursorParamIndex;
    StoredProcedureParameterImplementor refCursorParam=refCursorParameters[refCursorParamIndex];
    if (refCursorParam.getName() != null) {
      resultSet=procedureCall.session().getFactory().getServiceRegistry().getService(RefCursorSupport.class).getResultSet(callableStatement,refCursorParam.getName());
    }
 else {
      resultSet=procedureCall.session().getFactory().getServiceRegistry().getService(RefCursorSupport.class).getResultSet(callableStatement,refCursorParam.getPosition());
    }
    return new ResultSetReturn(this,resultSet);
  }
}
