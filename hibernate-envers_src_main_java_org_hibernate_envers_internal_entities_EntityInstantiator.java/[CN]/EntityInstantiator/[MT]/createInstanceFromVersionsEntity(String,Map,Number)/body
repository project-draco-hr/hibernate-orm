{
  if (versionsEntity == null) {
    return null;
  }
  final String type=enversService.getEntitiesConfigurations().getEntityNameForVersionsEntityName((String)versionsEntity.get("$type$"));
  if (type != null) {
    entityName=type;
  }
  final IdMapper idMapper=enversService.getEntitiesConfigurations().get(entityName).getIdMapper();
  final Map originalId=(Map)versionsEntity.get(enversService.getAuditEntitiesConfiguration().getOriginalIdPropName());
  replaceNonAuditIdProxies(versionsEntity,revision);
  final Object primaryKey=idMapper.mapToIdFromMap(originalId);
  if (versionsReader.getFirstLevelCache().contains(entityName,revision,primaryKey)) {
    return versionsReader.getFirstLevelCache().get(entityName,revision,primaryKey);
  }
  Object ret;
  try {
    EntityConfiguration entCfg=enversService.getEntitiesConfigurations().get(entityName);
    if (entCfg == null) {
      entCfg=enversService.getEntitiesConfigurations().getNotVersionEntityConfiguration(entityName);
    }
    final Class<?> cls=ReflectionTools.loadClass(entCfg.getEntityClassName(),enversService.getClassLoaderService());
    ret=ReflectHelper.getDefaultConstructor(cls).newInstance();
  }
 catch (  Exception e) {
    throw new AuditException(e);
  }
  versionsReader.getFirstLevelCache().put(entityName,revision,primaryKey,ret);
  enversService.getEntitiesConfigurations().get(entityName).getPropertyMapper().mapToEntityFromMap(enversService,ret,versionsEntity,primaryKey,versionsReader,revision);
  idMapper.mapToEntityFromMap(ret,originalId);
  versionsReader.getFirstLevelCache().putOnEntityNameCache(primaryKey,revision,ret,entityName);
  return ret;
}
