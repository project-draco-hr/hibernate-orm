{
  secondPassCompile();
  String defaultCatalog=properties.getProperty(Environment.DEFAULT_CATALOG);
  String defaultSchema=properties.getProperty(Environment.DEFAULT_SCHEMA);
  ArrayList script=new ArrayList(50);
  Iterator iter=getTableMappings();
  while (iter.hasNext()) {
    Table table=(Table)iter.next();
    if (table.isPhysicalTable()) {
      TableMetadata tableInfo=databaseMetadata.getTableMetadata(table.getName(),(table.getSchema() == null) ? defaultSchema : table.getSchema(),(table.getCatalog() == null) ? defaultCatalog : table.getCatalog(),table.isQuoted());
      if (tableInfo == null) {
        script.add(table.sqlCreateString(dialect,mapping,defaultCatalog,defaultSchema));
      }
 else {
        Iterator subiter=table.sqlAlterStrings(dialect,mapping,tableInfo,defaultCatalog,defaultSchema);
        while (subiter.hasNext()) {
          script.add(subiter.next());
        }
      }
      Iterator comments=table.sqlCommentStrings(dialect,defaultCatalog,defaultSchema);
      while (comments.hasNext()) {
        script.add(comments.next());
      }
    }
  }
  iter=getTableMappings();
  while (iter.hasNext()) {
    Table table=(Table)iter.next();
    if (table.isPhysicalTable()) {
      TableMetadata tableInfo=databaseMetadata.getTableMetadata(table.getName(),table.getSchema(),table.getCatalog(),table.isQuoted());
      if (dialect.hasAlterTable()) {
        Iterator subIter=table.getForeignKeyIterator();
        while (subIter.hasNext()) {
          ForeignKey fk=(ForeignKey)subIter.next();
          if (fk.isPhysicalConstraint()) {
            boolean create=tableInfo == null || (tableInfo.getForeignKeyMetadata(fk) == null && (!(dialect instanceof MySQLDialect) || tableInfo.getIndexMetadata(fk.getName()) == null));
            if (create) {
              script.add(fk.sqlCreateString(dialect,mapping,defaultCatalog,defaultSchema));
            }
          }
        }
      }
    }
  }
  iter=iterateGenerators(dialect);
  while (iter.hasNext()) {
    PersistentIdentifierGenerator generator=(PersistentIdentifierGenerator)iter.next();
    Object key=generator.generatorKey();
    if (!databaseMetadata.isSequence(key) && !databaseMetadata.isTable(key)) {
      String[] lines=generator.sqlCreateStrings(dialect);
      for (int i=0; i < lines.length; i++) {
        script.add(lines[i]);
      }
    }
  }
  return ArrayHelper.toStringArray(script);
}
