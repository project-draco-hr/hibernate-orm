{
  try {
    org.hibernate.Query hqlQuery=internalGetSession().createQuery(jpaqlString);
    if (options.getValueHandlers() == null) {
      if (options.getResultMetadataValidator() != null) {
        options.getResultMetadataValidator().validate(hqlQuery.getReturnTypes());
      }
    }
    List tupleElements=Tuple.class.equals(resultClass) ? ((CompoundSelectionImpl<Tuple>)selection).getCompoundSelectionItems() : null;
    if (options.getValueHandlers() != null || tupleElements != null) {
      hqlQuery.setResultTransformer(new CriteriaQueryTransformer(options.getValueHandlers(),tupleElements));
    }
    return new QueryImpl<T>(hqlQuery,this,options.getNamedParameterExplicitTypes());
  }
 catch (  HibernateException he) {
    throw convert(he);
  }
}
