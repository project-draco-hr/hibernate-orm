{
  PersistenceException pe;
  if (e instanceof StaleObjectStateException) {
    StaleObjectStateException sose=(StaleObjectStateException)e;
    Serializable identifier=sose.getIdentifier();
    if (identifier != null) {
      try {
        Object entity=internalGetSession().load(sose.getEntityName(),identifier);
        if (entity instanceof Serializable) {
          pe=new OptimisticLockException(e.getMessage(),e,entity);
        }
 else {
          pe=new OptimisticLockException(e.getMessage(),e);
        }
      }
 catch (      EntityNotFoundException enfe) {
        pe=new OptimisticLockException(e.getMessage(),e);
      }
    }
 else {
      pe=new OptimisticLockException(e.getMessage(),e);
    }
  }
 else {
    pe=new OptimisticLockException(e.getMessage(),e);
  }
  return pe;
}
