{
  try {
    org.hibernate.Query hqlQuery=internalGetSession().createQuery(jpaqlString);
    if (queryOptions.getValueHandlers() == null) {
      if (queryOptions.getResultMetadataValidator() != null) {
        queryOptions.getResultMetadataValidator().validate(hqlQuery.getReturnTypes());
      }
    }
    List tupleElements=Tuple.class.equals(resultClass) ? ((CompoundSelectionImpl<Tuple>)selection).getCompoundSelectionItems() : null;
    if (queryOptions.getValueHandlers() != null || tupleElements != null) {
      hqlQuery.setResultTransformer(new CriteriaQueryTransformer(queryOptions.getValueHandlers(),tupleElements));
    }
    return new QueryImpl<T>(hqlQuery,this,queryOptions.getNamedParameterExplicitTypes());
  }
 catch (  RuntimeException e) {
    throw convert(e);
  }
}
