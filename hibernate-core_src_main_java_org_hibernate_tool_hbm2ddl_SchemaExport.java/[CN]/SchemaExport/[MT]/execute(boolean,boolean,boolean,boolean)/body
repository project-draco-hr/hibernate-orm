{
  LOG.runningHbm2ddlSchemaExport();
  Connection connection=null;
  Writer outputFileWriter=null;
  List<NamedReader> importFileReaders=new ArrayList<NamedReader>();
  Statement statement=null;
  exceptions.clear();
  try {
    for (    String currentFile : importFiles.split(",")) {
      try {
        final String resourceName=currentFile.trim();
        InputStream stream=ConfigHelper.getResourceAsStream(resourceName);
        importFileReaders.add(new NamedReader(resourceName,stream));
      }
 catch (      HibernateException e) {
        LOG.importFileNotFound(currentFile);
      }
    }
    if (outputFile != null) {
      LOG.writingGeneratedSchemaToFile(outputFile);
      outputFileWriter=new FileWriter(outputFile);
    }
    if (export) {
      LOG.exportingGeneratedSchemaToDatabase();
      connectionHelper.prepare(true);
      connection=connectionHelper.getConnection();
      statement=connection.createStatement();
    }
    if (!justCreate) {
      drop(script,export,outputFileWriter,statement);
    }
    if (!justDrop) {
      create(script,export,outputFileWriter,statement);
      if (export && importFileReaders.size() > 0) {
        for (        NamedReader reader : importFileReaders) {
          importScript(reader,statement);
        }
      }
    }
    LOG.schemaExportComplete();
  }
 catch (  Exception e) {
    exceptions.add(e);
    LOG.error(LOG.schemaExportUnsuccessful(),e);
  }
 finally {
    try {
      if (statement != null) {
        statement.close();
      }
      if (connection != null) {
        connectionHelper.release();
      }
    }
 catch (    Exception e) {
      exceptions.add(e);
      LOG.error(LOG.unableToCloseConnection(),e);
    }
    try {
      if (outputFileWriter != null) {
        outputFileWriter.close();
      }
    }
 catch (    IOException ioe) {
      exceptions.add(ioe);
      LOG.error(LOG.unableToCloseOutputFile(outputFile),ioe);
    }
    for (    NamedReader reader : importFileReaders) {
      try {
        reader.getReader().close();
      }
 catch (      IOException ioe) {
        exceptions.add(ioe);
        LOG.error(LOG.unableToCloseInputFiles(reader.getName()),ioe);
      }
    }
  }
}
