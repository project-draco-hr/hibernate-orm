{
  if (type.isAssignableFrom(SessionFactory.class)) {
    return type.cast(sessionFactory);
  }
  if (type.isAssignableFrom(SessionFactoryImplementor.class)) {
    return type.cast(sessionFactory);
  }
  if (type.isAssignableFrom(SessionFactoryImpl.class)) {
    return type.cast(sessionFactory);
  }
  if (type.isAssignableFrom(HibernateEntityManagerFactory.class)) {
    return type.cast(this);
  }
  if (type.isAssignableFrom(EntityManagerFactoryImpl.class)) {
    return type.cast(this);
  }
  throw new PersistenceException("Hibernate cannot unwrap EntityManagerFactory as '" + type.getName() + "'");
}
