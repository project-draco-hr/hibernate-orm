{
  try {
    boolean mucked=false;
    if (getSpecifiedMaxResults() != 1 && !(SQLQuery.class.isAssignableFrom(query.getClass()))) {
      mucked=true;
      query.setMaxResults(2);
    }
    List<X> result=query.list();
    if (mucked) {
      query.setMaxResults(getSpecifiedMaxResults());
    }
    if (result.size() == 0) {
      NoResultException nre=new NoResultException("No entity found for query");
      getEntityManager().handlePersistenceException(nre);
      throw nre;
    }
 else     if (result.size() > 1) {
      Set<X> uniqueResult=new HashSet<X>(result);
      if (uniqueResult.size() > 1) {
        NonUniqueResultException nure=new NonUniqueResultException("result returns more than one elements");
        getEntityManager().handlePersistenceException(nure);
        throw nure;
      }
 else {
        return uniqueResult.iterator().next();
      }
    }
 else {
      return result.get(0);
    }
  }
 catch (  QueryExecutionRequestException he) {
    throw new IllegalStateException(he);
  }
catch (  TypeMismatchException e) {
    throw new IllegalArgumentException(e);
  }
catch (  HibernateException he) {
    throw getEntityManager().convert(he);
  }
}
