{
  String original=buildString(CLOB_SIZE,'x');
  String changed=buildString(CLOB_SIZE,'y');
  String empty="";
  Session s=openSession();
  s.beginTransaction();
  LobHolder entity=new LobHolder();
  entity.setClobLocator(s.getLobHelper().createClob(original));
  s.save(entity);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  entity=(LobHolder)s.get(LobHolder.class,entity.getId());
  assertEquals(CLOB_SIZE,entity.getClobLocator().length());
  assertEquals(original,extractData(entity.getClobLocator()));
  s.getTransaction().commit();
  s.close();
  if (getDialect().supportsLobValueChangePropogation()) {
    s=openSession();
    s.beginTransaction();
    entity=(LobHolder)s.get(LobHolder.class,entity.getId(),LockMode.UPGRADE);
    entity.getClobLocator().truncate(1);
    entity.getClobLocator().setString(1,changed);
    s.getTransaction().commit();
    s.close();
    s=openSession();
    s.beginTransaction();
    entity=(LobHolder)s.get(LobHolder.class,entity.getId(),LockMode.UPGRADE);
    assertNotNull(entity.getClobLocator());
    assertEquals(CLOB_SIZE,entity.getClobLocator().length());
    assertEquals(changed,extractData(entity.getClobLocator()));
    entity.getClobLocator().truncate(1);
    entity.getClobLocator().setString(1,original);
    s.getTransaction().commit();
    s.close();
  }
  s=openSession();
  s.beginTransaction();
  entity=(LobHolder)s.get(LobHolder.class,entity.getId(),LockMode.UPGRADE);
  assertNotNull(entity.getClobLocator());
  assertEquals(CLOB_SIZE,entity.getClobLocator().length());
  assertEquals(original,extractData(entity.getClobLocator()));
  entity.setClobLocator(s.getLobHelper().createClob(changed));
  s.getTransaction().commit();
  s.close();
  if (!(getDialect() instanceof SybaseASE15Dialect)) {
    s=openSession();
    s.beginTransaction();
    entity=(LobHolder)s.get(LobHolder.class,entity.getId());
    assertEquals(CLOB_SIZE,entity.getClobLocator().length());
    assertEquals(changed,extractData(entity.getClobLocator()));
    entity.setClobLocator(s.getLobHelper().createClob(empty));
    s.getTransaction().commit();
    s.close();
    s=openSession();
    s.beginTransaction();
    entity=(LobHolder)s.get(LobHolder.class,entity.getId());
    if (entity.getClobLocator() != null) {
      assertEquals(empty.length(),entity.getClobLocator().length());
      assertEquals(empty,extractData(entity.getClobLocator()));
    }
    s.delete(entity);
    s.getTransaction().commit();
    s.close();
  }
}
