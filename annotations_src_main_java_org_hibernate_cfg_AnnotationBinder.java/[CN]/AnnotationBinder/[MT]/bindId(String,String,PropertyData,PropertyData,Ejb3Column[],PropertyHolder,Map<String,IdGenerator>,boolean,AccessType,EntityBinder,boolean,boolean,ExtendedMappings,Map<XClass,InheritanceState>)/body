{
  PersistentClass persistentClass=propertyHolder.getPersistentClass();
  if (!(persistentClass instanceof RootClass)) {
    throw new AnnotationException("Unable to define/override @Id(s) on a subclass: " + propertyHolder.getEntityName());
  }
  RootClass rootClass=(RootClass)persistentClass;
  String persistentClassName=rootClass.getClassName();
  SimpleValue id;
  final String propertyName=inferredData.getPropertyName();
  if (isComposite) {
    id=fillComponent(propertyHolder,inferredData,baseInferredData,propertyAccessor,false,entityBinder,isEmbedded,isIdentifierMapper,false,mappings,inheritanceStatePerClass);
    Component componentId=(Component)id;
    componentId.setKey(true);
    if (rootClass.getIdentifier() != null) {
      throw new AnnotationException(componentId.getComponentClassName() + " must not have @Id properties when used as an @EmbeddedId");
    }
    if (componentId.getPropertySpan() == 0) {
      throw new AnnotationException(componentId.getComponentClassName() + " has no persistent id property");
    }
    XProperty property=inferredData.getProperty();
    setupComponentTuplizer(property,componentId);
  }
 else {
    final XClass persistentXClass;
    try {
      persistentXClass=mappings.getReflectionManager().classForName(persistentClassName,AnnotationBinder.class);
    }
 catch (    ClassNotFoundException e) {
      throw new AssertionFailure("Persistence class name cannot be converted into a Class",e);
    }
    final PropertyData annotatedWithMapsId=mappings.getPropertyAnnotatedWithMapsId(persistentXClass,"");
    if (annotatedWithMapsId != null) {
      columns=buildExplicitJoinColumns(propertyHolder,annotatedWithMapsId.getProperty(),annotatedWithMapsId,entityBinder,mappings);
      if (columns == null) {
        columns=buildDefaultJoinColumnsForXToOne(propertyHolder,annotatedWithMapsId.getProperty(),annotatedWithMapsId,entityBinder,mappings);
      }
    }
    for (    Ejb3Column column : columns) {
      column.forceNotNull();
    }
    SimpleValueBinder value=new SimpleValueBinder();
    value.setPropertyName(propertyName);
    value.setReturnedClassName(inferredData.getTypeName());
    value.setColumns(columns);
    value.setPersistentClassName(persistentClassName);
    value.setMappings(mappings);
    value.setType(inferredData.getProperty(),inferredData.getClassOrElement());
    id=value.make();
  }
  rootClass.setIdentifier(id);
  BinderHelper.makeIdGenerator(id,generatorType,generatorName,mappings,localGenerators);
  if (isEmbedded) {
    rootClass.setEmbeddedIdentifier(inferredData.getPropertyClass() == null);
  }
 else {
    PropertyBinder binder=new PropertyBinder();
    binder.setName(propertyName);
    binder.setValue(id);
    binder.setAccessType(inferredData.getDefaultAccess());
    binder.setProperty(inferredData.getProperty());
    Property prop=binder.make();
    rootClass.setIdentifierProperty(prop);
    final org.hibernate.mapping.MappedSuperclass superclass=BinderHelper.getMappedSuperclassOrNull(inferredData.getDeclaringClass(),inheritanceStatePerClass,mappings);
    if (superclass != null) {
      superclass.setDeclaredIdentifierProperty(prop);
    }
 else {
      rootClass.setDeclaredIdentifierProperty(prop);
    }
  }
}
