{
  if (!begun && !commitFailed) {
    throw new TransactionException("Transaction not successfully started");
  }
  log.debug("rollback");
  if (!commitFailed) {
    try {
      rollbackAndResetAutoCommit();
      log.debug("rolled back JDBC Connection");
      rolledBack=true;
      notifySynchronizationsAfterTransactionCompletion(Status.STATUS_ROLLEDBACK);
    }
 catch (    SQLException e) {
      log.error("JDBC rollback failed",e);
      notifySynchronizationsAfterTransactionCompletion(Status.STATUS_UNKNOWN);
      throw new TransactionException("JDBC rollback failed",e);
    }
 finally {
      if (callback) {
        jdbcContext.afterTransactionCompletion(false,this);
      }
      closeIfRequired();
    }
  }
}
