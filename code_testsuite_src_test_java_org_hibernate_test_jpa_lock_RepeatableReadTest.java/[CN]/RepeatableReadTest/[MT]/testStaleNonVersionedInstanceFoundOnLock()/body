{
  if (!readCommittedIsolationMaintained("repeatable read tests")) {
    return;
  }
  if (getDialect().doesReadCommittedCauseWritersToBlockReaders()) {
    reportSkip("lock blocking","stale versioned instance");
    return;
  }
  String check="Lock Modes";
  Session s1=getSessions().openSession();
  Transaction t1=s1.beginTransaction();
  Part part=new Part(new Item("EJB3 Specification"),check,"3.3.5.3",new BigDecimal(0.0));
  s1.save(part);
  t1.commit();
  s1.close();
  Long partId=part.getId();
  s1=getSessions().openSession();
  t1=s1.beginTransaction();
  part=(Part)s1.get(Part.class,partId);
  Session s2=getSessions().openSession();
  Transaction t2=s2.beginTransaction();
  Part part2=(Part)s2.get(Part.class,partId);
  part2.setName("Lock Mode Types");
  t2.commit();
  s2.close();
  s1.lock(part,LockMode.READ);
  part2=(Part)s1.get(Part.class,partId);
  assertTrue(part == part2);
  assertEquals("encountered non-repeatable read",check,part2.getName());
  try {
    s1.lock(part,LockMode.UPGRADE);
  }
 catch (  Throwable t) {
    t1.rollback();
    t1=s1.beginTransaction();
  }
  part2=(Part)s1.get(Part.class,partId);
  assertTrue(part == part2);
  assertEquals("encountered non-repeatable read",check,part2.getName());
  t1.commit();
  s1.close();
  s1=getSessions().openSession();
  t1=s1.beginTransaction();
  s1.delete(part);
  s1.delete(part.getItem());
  t1.commit();
  s1.close();
}
