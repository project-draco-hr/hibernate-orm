{
  LOG.debug("Registered: " + uid + " ("+ (name == null ? "<unnamed>" : name)+ ")");
  INSTANCES.put(uid,instance);
  if (name != null)   NAMED_INSTANCES.put(name,instance);
  if (name == null)   LOG.notBindingFactoryToJndi();
 else {
    LOG.factoryName(name);
    try {
      Context ctx=JndiHelper.getInitialContext(properties);
      JndiHelper.bind(ctx,name,instance);
      LOG.factoryBoundToJndiName(name);
      ((EventContext)ctx).addNamingListener(name,EventContext.OBJECT_SCOPE,LISTENER);
    }
 catch (    InvalidNameException ine) {
      LOG.invalidJndiName(name,ine);
    }
catch (    NamingException ne) {
      LOG.warn(LOG.unableToBindFactoryToJndi(),ne);
    }
catch (    ClassCastException cce) {
      LOG.initialContextDidNotImplementEventContext();
    }
  }
}
