{
  final Type type=propertyValue.getType();
  final Value value=propertyValue.getElement();
  final boolean oneToManyAttachedType=type instanceof BagType || type instanceof SetType || type instanceof MapType|| type instanceof ListType;
  final boolean inverseOneToMany=(value instanceof OneToMany) && (propertyValue.isInverse());
  final boolean owningManyToOneWithJoinTableBidirectional=(value instanceof ManyToOne) && (propertyAuditingData.getRelationMappedBy() != null);
  final boolean fakeOneToManyBidirectional=(value instanceof OneToMany) && (propertyAuditingData.getAuditMappedBy() != null);
  if (propertyAuditingData.isIndexed()) {
    if (oneToManyAttachedType && inverseOneToMany && !fakeOneToManyBidirectional&& !owningManyToOneWithJoinTableBidirectional) {
      throw new MappingException("Mapping failure for [" + referencingEntityConfiguration.getEntityClassName() + "#"+ propertyName+ "]: "+ "An indexed @OneToMany should be mapped by also using @JoinColumn and @AuditMappedBy.");
    }
  }
  if (oneToManyAttachedType && (inverseOneToMany || fakeOneToManyBidirectional || owningManyToOneWithJoinTableBidirectional)) {
    addOneToManyAttached(fakeOneToManyBidirectional);
  }
 else {
    addWithMiddleTable();
  }
}
