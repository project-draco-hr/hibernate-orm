{
  Session session=openSession();
  session.beginTransaction();
  Person p=new Person("Abe","Lincoln");
  session.save(p);
  session.getTransaction().commit();
  session=openSession();
  session.beginTransaction();
  long count=session.doReturningWork(new ReturningWork<Long>(){
    public Long execute(    Connection connection) throws SQLException {
      Statement statement=null;
      long personCount=0;
      try {
        statement=connection.createStatement();
        ResultSet resultSet=null;
        try {
          resultSet=statement.executeQuery("select count(*) from T_JDBC_PERSON");
          resultSet.next();
          personCount=resultSet.getLong(1);
          assertEquals(1L,personCount);
        }
  finally {
          releaseQuietly(resultSet);
        }
      }
  finally {
        releaseQuietly(statement);
      }
      return personCount;
    }
  }
);
  session.getTransaction().commit();
  session.close();
  assertEquals(1L,count);
  session=openSession();
  session.beginTransaction();
  session.delete(p);
  session.getTransaction().commit();
  session.close();
}
