{
  final Session session=openSession();
  session.beginTransaction();
  try {
    session.doWork(new Work(){
      public void execute(      Connection connection) throws SQLException {
        Statement statement=null;
        try {
          statement=((SessionImplementor)session).getTransactionCoordinator().getJdbcCoordinator().getStatementPreparer().createStatement();
          ((SessionImplementor)session).getTransactionCoordinator().getJdbcCoordinator().getResultSetReturn().extract(statement,"select * from non_existent");
        }
  finally {
          releaseQuietly(((SessionImplementor)session),statement);
        }
      }
    }
);
    fail("expecting exception");
  }
 catch (  JDBCException expected) {
  }
  session.getTransaction().commit();
  session.close();
}
