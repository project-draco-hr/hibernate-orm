{
  SessionFactoryImplementor factory=session.getFactory();
  ArrayList tmpSpaces=new ArrayList();
  for (int i=0; i < affectedQueryables.length; i++) {
    tmpSpaces.addAll(Arrays.asList(affectedQueryables[i].getQuerySpaces()));
    if (affectedQueryables[i].hasCache()) {
      entityCleanups.add(new EntityCleanup(affectedQueryables[i].getCacheAccessStrategy()));
    }
    Set roles=factory.getCollectionRolesByEntityParticipant(affectedQueryables[i].getEntityName());
    if (roles != null) {
      Iterator itr=roles.iterator();
      while (itr.hasNext()) {
        String role=(String)itr.next();
        CollectionPersister collectionPersister=factory.getCollectionPersister(role);
        if (collectionPersister.hasCache()) {
          collectionCleanups.add(new CollectionCleanup(collectionPersister.getCacheAccessStrategy()));
        }
      }
    }
  }
  this.affectedTableSpaces=(Serializable[])tmpSpaces.toArray(new Serializable[tmpSpaces.size()]);
}
