{
  final Class entityClass=Hibernate.getClass(entity);
  final ClassMetadata classMetadata=emf.getSessionFactory().getClassMetadata(entityClass);
  if (classMetadata == null) {
    throw new IllegalArgumentException(entityClass + " is not an entity");
  }
  return classMetadata.getIdentifier(entity,EntityMode.POJO);
}
