{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Location mel=new Location("Melbourne, Australia");
  Location mars=new Location("Mars");
  s.save(mel);
  s.save(mars);
  Human gavin=new Human();
  gavin.setIdentity("gavin");
  gavin.setSex('M');
  gavin.setLocation(mel);
  mel.addBeing(gavin);
  Alien x23y4=new Alien();
  x23y4.setIdentity("x23y4$$hu%3");
  x23y4.setLocation(mars);
  x23y4.setSpecies("martian");
  mars.addBeing(x23y4);
  Alien yy3dk=new Alien();
  yy3dk.setIdentity("yy3dk&*!!!");
  yy3dk.setLocation(mars);
  yy3dk.setSpecies("martian");
  mars.addBeing(yy3dk);
  Hive hive=new Hive();
  hive.setLocation(mars);
  hive.getMembers().add(x23y4);
  x23y4.setHive(hive);
  hive.getMembers().add(yy3dk);
  yy3dk.setHive(hive);
  s.persist(hive);
  yy3dk.getHivemates().add(x23y4);
  x23y4.getHivemates().add(yy3dk);
  s.flush();
  s.clear();
  hive=(Hive)s.createQuery("from Hive h").uniqueResult();
  assertFalse(Hibernate.isInitialized(hive.getMembers()));
  assertEquals(hive.getMembers().size(),2);
  s.clear();
  hive=(Hive)s.createQuery("from Hive h left join fetch h.location left join fetch h.members").uniqueResult();
  assertTrue(Hibernate.isInitialized(hive.getMembers()));
  assertEquals(hive.getMembers().size(),2);
  s.clear();
  x23y4=(Alien)s.createQuery("from Alien a left join fetch a.hivemates where a.identity like 'x%'").uniqueResult();
  assertTrue(Hibernate.isInitialized(x23y4.getHivemates()));
  assertEquals(x23y4.getHivemates().size(),1);
  s.clear();
  x23y4=(Alien)s.createQuery("from Alien a where a.identity like 'x%'").uniqueResult();
  assertFalse(Hibernate.isInitialized(x23y4.getHivemates()));
  assertEquals(x23y4.getHivemates().size(),1);
  s.clear();
  x23y4=(Alien)s.createCriteria(Alien.class).addOrder(Order.asc("identity")).list().get(0);
  s.delete(x23y4.getHive());
  s.delete(s.get(Location.class,mel.getId()));
  s.delete(s.get(Location.class,mars.getId()));
  assertTrue(s.createQuery("from Being").list().isEmpty());
  t.commit();
  s.close();
}
