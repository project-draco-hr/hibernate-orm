{
  final boolean traceEnabled=LOG.isTraceEnabled();
  if (traceEnabled)   LOG.tracev("Total checked-out connections: {0}",checkedOut.intValue());
synchronized (pool) {
    if (!pool.isEmpty()) {
      int last=pool.size() - 1;
      if (traceEnabled)       LOG.tracev("Using pooled JDBC connection, pool size: {0}",last);
      Connection pooled=pool.remove(last);
      if (isolation != null) {
        pooled.setTransactionIsolation(isolation.intValue());
      }
      if (pooled.getAutoCommit() != autocommit) {
        pooled.setAutoCommit(autocommit);
      }
      checkedOut.incrementAndGet();
      return pooled;
    }
  }
  final boolean debugEnabled=LOG.isDebugEnabled();
  if (debugEnabled)   LOG.debug("Opening new JDBC connection");
  Connection conn;
  if (driver != null) {
    conn=driver.connect(url,connectionProps);
  }
 else {
    conn=DriverManager.getConnection(url,connectionProps);
  }
  if (isolation != null) {
    conn.setTransactionIsolation(isolation.intValue());
  }
  if (conn.getAutoCommit() != autocommit) {
    conn.setAutoCommit(autocommit);
  }
  if (debugEnabled) {
    LOG.debugf("Created connection to: %s, Isolation Level: %s",url,conn.getTransactionIsolation());
  }
  checkedOut.incrementAndGet();
  return conn;
}
