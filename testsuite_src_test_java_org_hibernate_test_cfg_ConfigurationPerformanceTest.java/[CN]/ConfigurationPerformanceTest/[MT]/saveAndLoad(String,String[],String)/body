{
  System.err.println("saveAndLoad from " + prefix + " with cfg = "+ cfgName);
  File cachedCfgFile=new File(workPackageDir,cfgName);
  Configuration cfg;
  long start;
  if (!cachedCfgFile.exists()) {
    start=System.currentTimeMillis();
    cfg=new Configuration();
    cfg.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
    System.err.println("Created configuration: " + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
    start=System.currentTimeMillis();
    for (int i=0; i < files.length; i++) {
      String file=files[i];
      cfg.addCacheableFile(new File(prefix + file));
    }
    System.err.println("Added " + (files.length) + " resources: "+ (System.currentTimeMillis() - start) / 1000.0 + " sec.");
    ObjectOutputStream os=new ObjectOutputStream(new FileOutputStream(cachedCfgFile));
    os.writeObject(cfg);
    os.flush();
    os.close();
  }
 else {
    start=System.currentTimeMillis();
    ObjectInputStream is=new ObjectInputStream(new FileInputStream(cachedCfgFile));
    cfg=(Configuration)is.readObject();
    is.close();
    System.err.println("Loaded serializable configuration:" + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
  }
  start=System.currentTimeMillis();
  System.err.println("Start build of session factory");
  SessionFactory factory=cfg.buildSessionFactory();
  System.err.println("Build session factory:" + (System.currentTimeMillis() - start) / 1000.0 + " sec.");
  return factory;
}
