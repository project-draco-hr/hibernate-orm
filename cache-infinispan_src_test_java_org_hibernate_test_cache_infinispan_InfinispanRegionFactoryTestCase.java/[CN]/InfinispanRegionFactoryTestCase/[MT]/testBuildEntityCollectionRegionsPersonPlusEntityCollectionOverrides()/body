{
  final String person="com.acme.Person";
  final String address="com.acme.Address";
  final String car="com.acme.Car";
  final String addresses="com.acme.Person.addresses";
  final String parts="com.acme.Car.parts";
  Properties p=new Properties();
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.cfg","person-cache");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.eviction.strategy","LRU");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.eviction.wake_up_interval","2000");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.eviction.max_entries","5000");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.expiration.lifespan","60000");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.expiration.max_idle","30000");
  p.setProperty("hibernate.cache.infinispan.entity.cfg","myentity-cache");
  p.setProperty("hibernate.cache.infinispan.entity.eviction.strategy","FIFO");
  p.setProperty("hibernate.cache.infinispan.entity.eviction.wake_up_interval","3000");
  p.setProperty("hibernate.cache.infinispan.entity.eviction.max_entries","20000");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.cfg","addresses-cache");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.eviction.strategy","FIFO");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.eviction.wake_up_interval","2500");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.eviction.max_entries","5500");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.expiration.lifespan","65000");
  p.setProperty("hibernate.cache.infinispan.com.acme.Person.addresses.expiration.max_idle","35000");
  p.setProperty("hibernate.cache.infinispan.collection.cfg","mycollection-cache");
  p.setProperty("hibernate.cache.infinispan.collection.eviction.strategy","LRU");
  p.setProperty("hibernate.cache.infinispan.collection.eviction.wake_up_interval","3500");
  p.setProperty("hibernate.cache.infinispan.collection.eviction.max_entries","25000");
  InfinispanRegionFactory factory=new InfinispanRegionFactory();
  factory.start(null,p);
  CacheManager manager=factory.getCacheManager();
  manager.getGlobalConfiguration().setTransportClass(null);
  try {
    assertNotNull(factory.getTypeOverrides().get(person));
    assertFalse(factory.getDefinedConfigurations().contains(person));
    assertNotNull(factory.getTypeOverrides().get(addresses));
    assertFalse(factory.getDefinedConfigurations().contains(addresses));
    CacheAdapter cache=null;
    EntityRegionImpl region=(EntityRegionImpl)factory.buildEntityRegion(person,p,null);
    assertNotNull(factory.getTypeOverrides().get(person));
    assertTrue(factory.getDefinedConfigurations().contains(person));
    assertNull(factory.getTypeOverrides().get(address));
    cache=region.getCacheAdapter();
    Configuration cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.LRU,cacheCfg.getEvictionStrategy());
    assertEquals(2000,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(5000,cacheCfg.getEvictionMaxEntries());
    assertEquals(60000,cacheCfg.getExpirationLifespan());
    assertEquals(30000,cacheCfg.getExpirationMaxIdle());
    region=(EntityRegionImpl)factory.buildEntityRegion(address,p,null);
    assertNotNull(factory.getTypeOverrides().get(person));
    assertTrue(factory.getDefinedConfigurations().contains(person));
    assertNull(factory.getTypeOverrides().get(address));
    cache=region.getCacheAdapter();
    cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.FIFO,cacheCfg.getEvictionStrategy());
    assertEquals(3000,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(20000,cacheCfg.getEvictionMaxEntries());
    region=(EntityRegionImpl)factory.buildEntityRegion(car,p,null);
    assertNotNull(factory.getTypeOverrides().get(person));
    assertTrue(factory.getDefinedConfigurations().contains(person));
    assertNull(factory.getTypeOverrides().get(address));
    cache=region.getCacheAdapter();
    cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.FIFO,cacheCfg.getEvictionStrategy());
    assertEquals(3000,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(20000,cacheCfg.getEvictionMaxEntries());
    CollectionRegionImpl collectionRegion=(CollectionRegionImpl)factory.buildCollectionRegion(addresses,p,null);
    assertNotNull(factory.getTypeOverrides().get(addresses));
    assertTrue(factory.getDefinedConfigurations().contains(person));
    assertNull(factory.getTypeOverrides().get(parts));
    cache=collectionRegion.getCacheAdapter();
    cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.FIFO,cacheCfg.getEvictionStrategy());
    assertEquals(2500,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(5500,cacheCfg.getEvictionMaxEntries());
    assertEquals(65000,cacheCfg.getExpirationLifespan());
    assertEquals(35000,cacheCfg.getExpirationMaxIdle());
    collectionRegion=(CollectionRegionImpl)factory.buildCollectionRegion(parts,p,null);
    assertNotNull(factory.getTypeOverrides().get(addresses));
    assertTrue(factory.getDefinedConfigurations().contains(addresses));
    assertNull(factory.getTypeOverrides().get(parts));
    cache=collectionRegion.getCacheAdapter();
    cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.LRU,cacheCfg.getEvictionStrategy());
    assertEquals(3500,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(25000,cacheCfg.getEvictionMaxEntries());
    collectionRegion=(CollectionRegionImpl)factory.buildCollectionRegion(parts,p,null);
    assertNotNull(factory.getTypeOverrides().get(addresses));
    assertTrue(factory.getDefinedConfigurations().contains(addresses));
    assertNull(factory.getTypeOverrides().get(parts));
    cache=collectionRegion.getCacheAdapter();
    cacheCfg=cache.getConfiguration();
    assertEquals(EvictionStrategy.LRU,cacheCfg.getEvictionStrategy());
    assertEquals(3500,cacheCfg.getEvictionWakeUpInterval());
    assertEquals(25000,cacheCfg.getEvictionMaxEntries());
  }
  finally {
    factory.stop();
  }
}
