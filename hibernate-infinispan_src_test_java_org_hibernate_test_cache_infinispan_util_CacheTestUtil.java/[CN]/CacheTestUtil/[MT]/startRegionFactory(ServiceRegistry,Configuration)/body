{
  try {
    Settings settings=cfg.buildSettings(reg);
    Properties properties=cfg.getProperties();
    String factoryType=cfg.getProperty(Environment.CACHE_REGION_FACTORY);
    Class clazz=Thread.currentThread().getContextClassLoader().loadClass(factoryType);
    InfinispanRegionFactory regionFactory;
    if (clazz == InfinispanRegionFactory.class) {
      regionFactory=new SingleNodeTestCase.TestInfinispanRegionFactory();
    }
 else {
      regionFactory=(InfinispanRegionFactory)clazz.newInstance();
    }
    regionFactory.start(settings,properties);
    return regionFactory;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
