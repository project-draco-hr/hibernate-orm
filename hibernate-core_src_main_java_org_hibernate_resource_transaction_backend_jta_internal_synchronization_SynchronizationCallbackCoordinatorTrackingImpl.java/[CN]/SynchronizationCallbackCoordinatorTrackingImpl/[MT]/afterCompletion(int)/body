{
  log.tracef("Synchronization coordinator: afterCompletion(status=%s)",status);
  if (JtaStatusHelper.isRollback(status)) {
    final long currentThreadId=Thread.currentThread().getId();
    final boolean isRegistrationThread=currentThreadId == registrationThreadId;
    if (!isRegistrationThread) {
      delayedCompletionHandling=true;
      log.rollbackFromBackgroundThread(status);
      return;
    }
  }
  doAfterCompletion(JtaStatusHelper.isCommitted(status),false);
}
