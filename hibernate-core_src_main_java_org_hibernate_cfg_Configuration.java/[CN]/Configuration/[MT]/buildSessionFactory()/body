{
  Environment.verifyProperties(properties);
  ConfigurationHelper.resolvePlaceHolders(properties);
  final ServiceRegistry serviceRegistry=new ServiceRegistryBuilder().applySettings(properties).buildServiceRegistry();
  setSessionFactoryObserver(new SessionFactoryObserver(){
    @Override public void sessionFactoryCreated(    SessionFactory factory){
    }
    @Override public void sessionFactoryClosed(    SessionFactory factory){
      ((BasicServiceRegistryImpl)serviceRegistry).destroy();
    }
  }
);
  return buildSessionFactory(serviceRegistry);
}
