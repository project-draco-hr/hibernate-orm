{
  LOG.startingSecondPassCompile();
{
    if (!isDefaultProcessed) {
      final Object isDelimited=reflectionManager.getDefaults().get("delimited-identifier");
      if (isDelimited != null && isDelimited == Boolean.TRUE) {
        getProperties().put(Environment.GLOBALLY_QUOTED_IDENTIFIERS,"true");
      }
      AnnotationBinder.bindDefaults(createMappings());
      isDefaultProcessed=true;
    }
  }
{
    metadataSourceQueue.syncAnnotatedClasses();
    metadataSourceQueue.processMetadata(determineMetadataSourcePrecedence());
  }
{
    for (    CacheHolder holder : caches) {
      if (holder.isClass) {
        applyCacheConcurrencyStrategy(holder);
      }
 else {
        applyCollectionCacheConcurrencyStrategy(holder);
      }
    }
    caches.clear();
  }
  try {
    inSecondPass=true;
    processSecondPassesOfType(PkDrivenByDefaultMapsIdSecondPass.class);
    processSecondPassesOfType(SetSimpleValueTypeSecondPass.class);
    processSecondPassesOfType(CopyIdentifierComponentSecondPass.class);
    processFkSecondPassInOrder();
    processSecondPassesOfType(CreateKeySecondPass.class);
    processSecondPassesOfType(SecondaryTableSecondPass.class);
    originalSecondPassCompile();
    inSecondPass=false;
  }
 catch (  RecoverableException e) {
    throw (RuntimeException)e.getCause();
  }
  for (  Map.Entry<Table,List<UniqueConstraintHolder>> tableListEntry : uniqueConstraintHoldersByTable.entrySet()) {
    final Table table=tableListEntry.getKey();
    final List<UniqueConstraintHolder> uniqueConstraints=tableListEntry.getValue();
    int uniqueIndexPerTable=0;
    for (    UniqueConstraintHolder holder : uniqueConstraints) {
      uniqueIndexPerTable++;
      final String keyName=StringHelper.isEmpty(holder.getName()) ? "key" + uniqueIndexPerTable : holder.getName();
      buildUniqueKeyFromColumnNames(table,keyName,holder.getColumns());
    }
  }
  applyConstraintsToDDL();
}
