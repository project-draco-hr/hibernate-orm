{
  try {
    ErrorLogger errorLogger=new ErrorLogger(resourceName);
    Document document=xmlHelper.createSAXReader(errorLogger,entityResolver).read(new InputSource(stream));
    if (errorLogger.hasErrors()) {
      throw new MappingException("invalid configuration",errorLogger.getErrors().get(0));
    }
    doConfigure(document);
  }
 catch (  DocumentException e) {
    throw new HibernateException("Could not parse configuration: " + resourceName,e);
  }
 finally {
    try {
      stream.close();
    }
 catch (    IOException ioe) {
      LOG.unableToCloseInputStreamForResource(resourceName,ioe);
    }
  }
  return this;
}
