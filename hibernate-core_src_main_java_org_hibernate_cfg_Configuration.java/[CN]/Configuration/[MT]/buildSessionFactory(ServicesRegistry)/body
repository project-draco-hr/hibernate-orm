{
  log.debug("Preparing to build session factory with filters : " + filterDefinitions);
  secondPassCompile();
  if (!metadataSourceQueue.isEmpty()) {
    log.warn("mapping metadata cache was not completely processed");
  }
  enableLegacyHibernateValidator();
  enableBeanValidation();
  enableHibernateSearch();
  validate();
  Environment.verifyProperties(properties);
  Properties copy=new Properties();
  copy.putAll(properties);
  ConfigurationHelper.resolvePlaceHolders(copy);
  Settings settings=buildSettings(copy,serviceRegistry.getService(JdbcServices.class).getConnectionProvider());
  return new SessionFactoryImpl(this,mapping,serviceRegistry,settings,getInitializedEventListeners(),sessionFactoryObserver);
}
