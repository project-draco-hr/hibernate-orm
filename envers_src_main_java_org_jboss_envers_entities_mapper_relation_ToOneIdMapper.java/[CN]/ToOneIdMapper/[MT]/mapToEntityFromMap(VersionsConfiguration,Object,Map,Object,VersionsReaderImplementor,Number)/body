{
  if (obj == null) {
    return;
  }
  Object entityId=delegate.mapToIdFromMap((Map)data.get(propertyName));
  Object value;
  if (entityId == null) {
    value=null;
  }
 else {
    if (versionsReader.getFirstLevelCache().contains(referencedEntityName,revision,entityId)) {
      value=versionsReader.getFirstLevelCache().get(referencedEntityName,revision,entityId);
    }
 else {
      Class<?> entityClass=ReflectionTools.loadClass(referencedEntityName);
      value=versionsReader.getSessionImplementor().getFactory().getEntityPersister(referencedEntityName).createProxy(null,new ToOneDelegateSessionImplementor(versionsReader,entityClass,entityId,revision));
    }
  }
  Setter setter=ReflectionTools.getSetter(obj.getClass(),propertyName);
  setter.set(obj,value,null);
}
