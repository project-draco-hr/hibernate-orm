{
  Map settings=new HashMap();
  settings.put(AvailableSettings.SHARED_CACHE_MODE,mode);
  settings.put(Environment.CACHE_REGION_FACTORY,CustomRegionFactory.class.getName());
  settings.put(AvailableSettings.LOADED_CLASSES,Arrays.asList(ExplicitlyCacheableEntity.class,ExplicitlyNonCacheableEntity.class,NoCacheableAnnotationEntity.class));
  PersistenceUnitInfoAdapter adapter=new PersistenceUnitInfoAdapter();
  EntityManagerFactoryBuilderImpl emfb=(EntityManagerFactoryBuilderImpl)Bootstrap.getEntityManagerFactoryBuilder(adapter,settings);
  Configuration hibernateConfiguration=emfb.buildHibernateConfiguration(emfb.buildServiceRegistry());
  hibernateConfiguration.buildMappings();
  return hibernateConfiguration;
}
