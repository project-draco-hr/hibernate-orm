{
  Integer aId1=createAAndB();
  Integer aId2=createAAndB();
  Session s=openSession();
  s.getTransaction().begin();
  List resultList=s.createQuery("from A where id in (" + aId1 + ","+ aId2+ ") order by id").list();
  A a1=(A)resultList.get(0);
  A a2=(A)resultList.get(1);
  assertEquals(aId1,a1.getId());
  assertEquals(aId2,a2.getId());
  assertFalse(Hibernate.isInitialized(a1.getB()));
  assertFalse(Hibernate.isInitialized(a2.getB()));
  assertEquals("foo",a1.getB().getOtherProperty());
  assertTrue(Hibernate.isInitialized(a1.getB()));
  assertFalse(Hibernate.isInitialized(a2.getB()));
  assertTrue(((SessionImplementor)session).getPersistenceContext().containsEntity(new EntityKey(((SessionImplementor)session).getContextEntityIdentifier(a2.getB()),((SessionImplementor)session).getFactory().getEntityPersister(B.class.getName()))));
  assertFalse(Hibernate.isInitialized(a2.getB()));
  assertEquals("foo",a2.getB().getOtherProperty());
  assertTrue(Hibernate.isInitialized(a2.getB()));
  s.getTransaction().commit();
  s.close();
}
