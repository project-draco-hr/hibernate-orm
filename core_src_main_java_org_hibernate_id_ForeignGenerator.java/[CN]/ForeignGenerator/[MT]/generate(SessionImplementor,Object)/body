{
  Session session=(Session)sessionImplementor;
  Object associatedObject=sessionImplementor.getFactory().getClassMetadata(entityName).getPropertyValue(object,propertyName,session.getEntityMode());
  if (associatedObject == null) {
    throw new IdentifierGenerationException("attempted to assign id from null one-to-one property: " + propertyName);
  }
  EntityType type=(EntityType)sessionImplementor.getFactory().getClassMetadata(entityName).getPropertyType(propertyName);
  Serializable id;
  try {
    id=ForeignKeys.getEntityIdentifierIfNotUnsaved(type.getAssociatedEntityName(),associatedObject,sessionImplementor);
  }
 catch (  TransientObjectException toe) {
    id=session.save(type.getAssociatedEntityName(),associatedObject);
  }
  if (session.contains(object)) {
    return IdentifierGeneratorFactory.SHORT_CIRCUIT_INDICATOR;
  }
  return id;
}
