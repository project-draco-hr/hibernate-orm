{
  final EnversService enversService=serviceRegistry.getService(EnversService.class);
  if (!enversService.isEnabled()) {
    log.debug("Skipping Envers listener registrations : EnversService disabled");
    return;
  }
  final boolean autoRegister=serviceRegistry.getService(ConfigurationService.class).getSetting(AUTO_REGISTER,StandardConverters.BOOLEAN,true);
  if (!autoRegister) {
    log.debug("Skipping Envers listener registrations : Listener auto-registration disabled");
    return;
  }
  if (!enversService.isInitialized()) {
    throw new HibernateException("Expecting EnversService to have been initialized prior to call to EnversIntegrator#integrate");
  }
  if (!enversService.getEntitiesConfigurations().hasAuditedEntities()) {
    log.debug("Skipping Envers listener registrations : No audited entities found");
    return;
  }
  final EventListenerRegistry listenerRegistry=serviceRegistry.getService(EventListenerRegistry.class);
  listenerRegistry.addDuplicationStrategy(EnversListenerDuplicationStrategy.INSTANCE);
  if (enversService.getEntitiesConfigurations().hasAuditedEntities()) {
    listenerRegistry.appendListeners(EventType.POST_DELETE,new EnversPostDeleteEventListenerImpl(enversService));
    listenerRegistry.appendListeners(EventType.POST_INSERT,new EnversPostInsertEventListenerImpl(enversService));
    listenerRegistry.appendListeners(EventType.POST_UPDATE,new EnversPostUpdateEventListenerImpl(enversService));
    listenerRegistry.appendListeners(EventType.POST_COLLECTION_RECREATE,new EnversPostCollectionRecreateEventListenerImpl(enversService));
    listenerRegistry.appendListeners(EventType.PRE_COLLECTION_REMOVE,new EnversPreCollectionRemoveEventListenerImpl(enversService));
    listenerRegistry.appendListeners(EventType.PRE_COLLECTION_UPDATE,new EnversPreCollectionUpdateEventListenerImpl(enversService));
  }
}
