{
  Session session=getSessions().openSession();
  session.beginTransaction();
  Iterator stocks=session.createQuery("from Stock").list().iterator();
  while (stocks.hasNext()) {
    final Stock stock=(Stock)stocks.next();
    stock.setCurrentValuation(null);
    session.flush();
    Iterator valuations=stock.getValuations().iterator();
    while (valuations.hasNext()) {
      session.delete(valuations.next());
    }
    session.delete(stock);
  }
  session.getTransaction().commit();
  session.close();
}
