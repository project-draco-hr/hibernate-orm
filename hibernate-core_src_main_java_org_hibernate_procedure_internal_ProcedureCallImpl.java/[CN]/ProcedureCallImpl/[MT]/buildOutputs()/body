{
  final StringBuilder buffer=new StringBuilder().append("{call ").append(procedureName).append("(");
  String sep="";
  for (  ParameterRegistrationImplementor parameter : registeredParameters) {
    for (int i=0; i < parameter.getSqlTypes().length; i++) {
      buffer.append(sep).append("?");
      sep=",";
    }
  }
  buffer.append(")}");
  try {
    final CallableStatement statement=(CallableStatement)getSession().getTransactionCoordinator().getJdbcCoordinator().getStatementPreparer().prepareStatement(buffer.toString(),true);
    int i=1;
    for (    ParameterRegistrationImplementor parameter : registeredParameters) {
      if (parameter == null) {
        throw new QueryException("Registered stored procedure parameters had gaps");
      }
      parameter.prepare(statement,i);
      i+=parameter.getSqlTypes().length;
    }
    return new ProcedureOutputsImpl(this,statement);
  }
 catch (  SQLException e) {
    throw getSession().getFactory().getSQLExceptionHelper().convert(e,"Error preparing CallableStatement",getProcedureName());
  }
}
