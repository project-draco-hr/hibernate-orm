{
  configuration=new Ejb3Configuration();
  configuration.addProperties(loadProperties());
  if (recreateSchema()) {
    configuration.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
  }
  for (  Class clazz : getAnnotatedClasses()) {
    configuration.addAnnotatedClass(clazz);
  }
  for (  Map.Entry<Class,String> entry : getCachedClasses().entrySet()) {
    configuration.setProperty(HibernatePersistence.CLASS_CACHE_PREFIX + "." + entry.getKey().getName(),entry.getValue());
  }
  for (  Map.Entry<String,String> entry : getCachedCollections().entrySet()) {
    configuration.setProperty(HibernatePersistence.COLLECTION_CACHE_PREFIX + "." + entry.getKey(),entry.getValue());
  }
}
