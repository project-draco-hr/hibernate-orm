{
  CopyCache copyCache=new CopyCache();
  onMerge(event,copyCache);
  Map transientCopyCache=getTransientCopyCache(event,copyCache);
  if (transientCopyCache.size() > 0) {
    retryMergeTransientEntities(event,transientCopyCache,copyCache);
    transientCopyCache=getTransientCopyCache(event,copyCache);
    if (transientCopyCache.size() > 0) {
      Set transientEntityNames=new HashSet();
      for (Iterator it=transientCopyCache.keySet().iterator(); it.hasNext(); ) {
        Object transientEntity=it.next();
        String transientEntityName=event.getSession().guessEntityName(transientEntity);
        transientEntityNames.add(transientEntityName);
        log.trace("transient instance could not be processed by merge: " + transientEntityName + "["+ transientEntity+ "]");
      }
      throw new TransientObjectException("one or more objects is an unsaved transient instance - save transient instance(s) before merging: " + transientEntityNames);
    }
  }
  copyCache.clear();
  copyCache=null;
}
