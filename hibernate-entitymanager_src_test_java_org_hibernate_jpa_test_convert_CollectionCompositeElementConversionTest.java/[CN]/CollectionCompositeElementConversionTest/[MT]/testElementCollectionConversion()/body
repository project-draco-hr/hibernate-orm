{
  final PersistenceUnitDescriptorAdapter pu=new PersistenceUnitDescriptorAdapter(){
    @Override public List<String> getManagedClassNames(){
      return Arrays.asList(Disguise.class.getName(),ColorTypeConverter.class.getName());
    }
  }
;
  final Map settings=new HashMap();
  settings.put(AvailableSettings.HBM2DDL_AUTO,"create-drop");
  EntityManagerFactory emf=Bootstrap.getEntityManagerFactoryBuilder(pu,settings).build();
  try {
    EntityManager em=emf.createEntityManager();
    em.getTransaction().begin();
    Disguise disguise=new Disguise(1);
    disguise.traits.add(new Traits(ColorType.BLUE,ColorType.RED));
    em.persist(disguise);
    em.getTransaction().commit();
    em.close();
    em=emf.createEntityManager();
    em.getTransaction().begin();
    assertEquals(1,em.find(Disguise.class,1).traits.size());
    em.getTransaction().commit();
    em.close();
    em=emf.createEntityManager();
    em.getTransaction().begin();
    disguise=em.find(Disguise.class,1);
    em.remove(disguise);
    em.getTransaction().commit();
    em.close();
  }
  finally {
    emf.close();
  }
}
