{
  final EntityType fetchedType=(EntityType)attributeDefinition.getType();
  final EntityPersister fetchedPersister=loadPlanBuildingContext.getSessionFactory().getEntityPersister(fetchedType.getAssociatedEntityName());
  if (fetchedPersister == null) {
    throw new WalkingException(String.format("Unable to locate EntityPersister [%s] for fetch [%s]",fetchedType.getAssociatedEntityName(),attributeDefinition.getName()));
  }
  final ExpandingQuerySpace leftHandSide=(ExpandingQuerySpace)resolveCompositeQuerySpace(loadPlanBuildingContext);
  final EntityFetch fetch;
  if (targetEntityReference == null) {
    final Join join=leftHandSide.addEntityJoin(attributeDefinition,fetchedPersister,loadPlanBuildingContext.getQuerySpaces().generateImplicitUid(),attributeDefinition.isNullable());
    fetch=new EntityFetchImpl(this,attributeDefinition,fetchStrategy,join);
  }
 else {
    fetch=new BidirectionalEntityFetchImpl(this,attributeDefinition,fetchStrategy,targetEntityReference);
  }
  addFetch(fetch);
  return fetch;
}
