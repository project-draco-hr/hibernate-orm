{
  SessionFactoryBuilder sfBuilder=metadata().getSessionFactoryBuilder();
  populate(sfBuilder,standardServiceRegistry);
  SessionFactoryImplementor sessionFactory;
  try {
    sessionFactory=(SessionFactoryImplementor)sfBuilder.build();
  }
 catch (  Exception e) {
    throw persistenceException("Unable to build Hibernate SessionFactory",e);
  }
  return new EntityManagerFactoryImpl(persistenceUnit.getName(),sessionFactory,metadata(),settings,configurationValues);
}
