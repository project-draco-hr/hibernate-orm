{
  final EntityMode em=loadContexts.getPersistenceContext().getSession().getEntityMode();
  final CollectionKey collectionKey=new CollectionKey(persister,key,em);
  if (LOG.isTraceEnabled())   LOG.findingLoadingCollection(MessageHelper.collectionInfoString(persister.getRole(),key));
  final LoadingCollectionEntry loadingCollectionEntry=loadContexts.locateLoadingCollectionEntry(collectionKey);
  if (loadingCollectionEntry == null) {
    PersistentCollection collection=loadContexts.getPersistenceContext().getCollection(collectionKey);
    if (collection != null) {
      if (collection.wasInitialized()) {
        LOG.collectionAlreadyInitialized();
        return null;
      }
 else       LOG.collectionNotYetInitialized();
    }
 else {
      Object owner=loadContexts.getPersistenceContext().getCollectionOwner(key,persister);
      final boolean newlySavedEntity=owner != null && loadContexts.getPersistenceContext().getEntry(owner).getStatus() != Status.LOADING && em != EntityMode.DOM4J;
      if (newlySavedEntity) {
        LOG.owningEntityAlreadyLoaded();
        return null;
      }
 else {
        LOG.instantiatingNewCollection(key,resultSet);
        collection=persister.getCollectionType().instantiate(loadContexts.getPersistenceContext().getSession(),persister,key);
      }
    }
    collection.beforeInitialize(persister,-1);
    collection.beginRead();
    localLoadingCollectionKeys.add(collectionKey);
    loadContexts.registerLoadingCollectionXRef(collectionKey,new LoadingCollectionEntry(resultSet,persister,key,collection));
    return collection;
  }
 else {
    if (loadingCollectionEntry.getResultSet() == resultSet) {
      LOG.foundLoadingCollection();
      return loadingCollectionEntry.getCollection();
    }
 else {
      LOG.collectionAlreadyInitializing();
      return null;
    }
  }
}
