{
  Session session=getFactory().openSession();
  session.getTransaction().begin();
  List<Person> persons=(List<Person>)session.createQuery(query).list();
  session.getTransaction().commit();
  session.close();
  for (  Person person : persons) {
    assertTrue(Hibernate.isInitialized(person));
    if (shouldHaveVehicle(person)) {
      assertNotNull(person.getVehicle());
      assertTrue(Hibernate.isInitialized(person.getVehicle()));
      assertNotNull(person.getVehicle().getDriver());
    }
  }
}
