{
  Configuration cfg=new Configuration();
  cfg.addAnnotatedClass(Gate.class);
  BasicServiceRegistry serviceRegistry=new ServiceRegistryBuilder(cfg.getProperties()).buildServiceRegistry();
  SessionFactory sessionFactory=cfg.buildSessionFactory(serviceRegistry);
  sessionFactory.close();
  ServiceRegistryBuilder.destroy(serviceRegistry);
  serviceRegistry=new ServiceRegistryBuilder(cfg.getProperties()).addService(PersisterClassResolver.class,new GoofyPersisterClassProvider()).buildServiceRegistry();
  cfg=new Configuration();
  cfg.addAnnotatedClass(Gate.class);
  try {
    sessionFactory=cfg.buildSessionFactory(serviceRegistry);
    sessionFactory.close();
  }
 catch (  MappingException e) {
    assertEquals("The entity persister should be overridden",GoofyPersisterClassProvider.NoopEntityPersister.class,((GoofyException)e.getCause()).getValue());
  }
 finally {
    ServiceRegistryBuilder.destroy(serviceRegistry);
  }
  cfg=new Configuration();
  cfg.addAnnotatedClass(Portal.class);
  cfg.addAnnotatedClass(Window.class);
  serviceRegistry=new ServiceRegistryBuilder(cfg.getProperties()).addService(PersisterClassResolver.class,new GoofyPersisterClassProvider()).buildServiceRegistry();
  try {
    sessionFactory=cfg.buildSessionFactory(serviceRegistry);
    sessionFactory.close();
  }
 catch (  MappingException e) {
    assertEquals("The collection persister should be overridden but not the entity persister",GoofyPersisterClassProvider.NoopCollectionPersister.class,((GoofyException)e.getCause()).getValue());
  }
 finally {
    ServiceRegistryBuilder.destroy(serviceRegistry);
  }
}
