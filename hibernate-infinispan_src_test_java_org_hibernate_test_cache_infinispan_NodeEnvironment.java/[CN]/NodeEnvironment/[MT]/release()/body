{
  if (entityRegionMap != null) {
    for (    final EntityRegionImpl region : entityRegionMap.values()) {
      withinTx(region.getTransactionManager(),new Callable<Void>(){
        @Override public Void call() throws Exception {
          region.getCacheAdapter().withFlags(FlagAdapter.CACHE_MODE_LOCAL).clear();
          return null;
        }
      }
);
      region.getCacheAdapter().stop();
    }
    entityRegionMap.clear();
  }
  if (collectionRegionMap != null) {
    for (    final CollectionRegionImpl collectionRegion : collectionRegionMap.values()) {
      withinTx(collectionRegion.getTransactionManager(),new Callable<Void>(){
        @Override public Void call() throws Exception {
          collectionRegion.getCacheAdapter().withFlags(FlagAdapter.CACHE_MODE_LOCAL).clear();
          return null;
        }
      }
);
      collectionRegion.getCacheAdapter().stop();
    }
    collectionRegionMap.clear();
  }
  if (regionFactory != null) {
    regionFactory.stop();
  }
  if (serviceRegistry != null) {
    serviceRegistry.destroy();
  }
}
