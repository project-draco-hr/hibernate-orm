{
  for (  final Map.Entry<PropertyData,PropertyMapper> entry : compositeMapper.getProperties().entrySet()) {
    final String propertyName=entry.getKey().getName();
    final PropertyMapper nestedMapper=entry.getValue();
    if (nestedMapper instanceof CompositeMapperBuilder) {
      addMiddleEqualToQuery((CompositeMapperBuilder)nestedMapper,parameters,idPrefix1,prefix1,idPrefix2,prefix2);
    }
 else     if (nestedMapper instanceof ToOneIdMapper) {
      ((ToOneIdMapper)nestedMapper).addMiddleEqualToQuery(parameters,idPrefix1,prefix1,idPrefix2,prefix2);
    }
 else {
      Parameters sub1=parameters.addSubParameters("or");
      sub1.addWhere(prefix1 + '.' + propertyName,false,"=",prefix2 + '.' + propertyName,false);
      Parameters sub2=sub1.addSubParameters("and");
      sub2.addNullRestriction(prefix1 + '.' + propertyName,false);
      sub2.addNullRestriction(prefix2 + '.' + propertyName,false);
    }
  }
}
