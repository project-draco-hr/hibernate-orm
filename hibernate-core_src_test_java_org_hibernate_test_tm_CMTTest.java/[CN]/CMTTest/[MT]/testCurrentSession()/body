{
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s=sessionFactory().getCurrentSession();
  Session s2=sessionFactory().getCurrentSession();
  assertSame(s,s2);
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  assertFalse(s.isOpen());
}
