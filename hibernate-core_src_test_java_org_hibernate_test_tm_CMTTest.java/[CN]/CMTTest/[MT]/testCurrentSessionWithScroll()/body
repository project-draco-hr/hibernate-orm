{
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s=sessionFactory().getCurrentSession();
  Map item1=new HashMap();
  item1.put("name","Item - 1");
  item1.put("description","The first item");
  s.persist("Item",item1);
  Map item2=new HashMap();
  item2.put("name","Item - 2");
  item2.put("description","The second item");
  s.persist("Item",item2);
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=sessionFactory().getCurrentSession();
  ScrollableResults results=s.createQuery("from Item").scroll();
  results.next();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=sessionFactory().getCurrentSession();
  results=s.createQuery("from Item").scroll();
  results.next();
  results.close();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=sessionFactory().getCurrentSession();
  results=s.createQuery("from Item").scroll();
  while (results.next()) {
  }
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=sessionFactory().getCurrentSession();
  results=s.createQuery("from Item").scroll();
  while (results.next()) {
  }
  results.close();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=sessionFactory().getCurrentSession();
  s.createQuery("delete from Item").executeUpdate();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
}
