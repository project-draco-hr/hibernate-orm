{
  sessionFactory().getStatistics().clear();
  assertNotNull(sessionFactory().getEntityPersister("Item").getCacheAccessStrategy());
  assertEquals(0,sessionFactory().getStatistics().getEntityLoadCount());
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s=openSession();
  Map foo=new HashMap();
  foo.put("name","Foo");
  foo.put("description","a big foo");
  s.persist("Item",foo);
  Map bar=new HashMap();
  bar.put("name","Bar");
  bar.put("description","a small bar");
  s.persist("Item",bar);
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().evictEntity("Item");
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s1=openSession();
  foo=(Map)s1.get("Item","Foo");
  Transaction tx1=sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().suspend();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s2=openSession();
  foo=(Map)s2.get("Item","Foo");
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().resume(tx1);
  tx1.commit();
  sessionFactory().evictEntity("Item");
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s1=openSession();
  s1.createCriteria("Item").list();
  tx1=sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().suspend();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s2=openSession();
  s2.createCriteria("Item").list();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().resume(tx1);
  tx1.commit();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s2=openSession();
  s2.createCriteria("Item").list();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  assertEquals(7,sessionFactory().getStatistics().getEntityLoadCount());
  assertEquals(0,sessionFactory().getStatistics().getEntityFetchCount());
  assertEquals(3,sessionFactory().getStatistics().getQueryExecutionCount());
  assertEquals(0,sessionFactory().getStatistics().getQueryCacheHitCount());
  assertEquals(0,sessionFactory().getStatistics().getQueryCacheMissCount());
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=openSession();
  s.createQuery("delete from Item").executeUpdate();
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
}
