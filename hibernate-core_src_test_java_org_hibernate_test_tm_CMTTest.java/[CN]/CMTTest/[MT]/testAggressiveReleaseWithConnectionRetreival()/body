{
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s=openSession();
  Map item1=new HashMap();
  item1.put("name","Item - 1");
  item1.put("description","The first item");
  s.save("Item",item1);
  Map item2=new HashMap();
  item2.put("name","Item - 2");
  item2.put("description","The second item");
  s.save("Item",item2);
  sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  try {
    sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
    s=sessionFactory().getCurrentSession();
    s.createQuery("from Item").scroll().next();
    s.connection();
    sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  }
  finally {
    sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
    s=openSession();
    s.createQuery("delete from Item").executeUpdate();
    sessionFactory().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  }
}
