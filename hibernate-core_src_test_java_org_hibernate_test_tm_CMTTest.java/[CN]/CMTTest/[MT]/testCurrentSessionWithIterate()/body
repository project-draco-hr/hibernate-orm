{
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  Session s=openSession();
  Map item1=new HashMap();
  item1.put("name","Item - 1");
  item1.put("description","The first item");
  s.persist("Item",item1);
  Map item2=new HashMap();
  item2.put("name","Item - 2");
  item2.put("description","The second item");
  s.persist("Item",item2);
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=getSessions().getCurrentSession();
  Iterator itr=s.createQuery("from Item").iterate();
  if (!itr.hasNext()) {
    fail("No results in iterator");
  }
  itr.next();
  if (!itr.hasNext()) {
    fail("Only one result in iterator");
  }
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=getSessions().getCurrentSession();
  itr=s.createQuery("from Item").iterate();
  if (!itr.hasNext()) {
    fail("No results in iterator");
  }
  while (itr.hasNext()) {
    itr.next();
  }
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().begin();
  s=openSession();
  s.createQuery("delete from Item").executeUpdate();
  sfi().getServiceRegistry().getService(JtaPlatform.class).retrieveTransactionManager().commit();
}
