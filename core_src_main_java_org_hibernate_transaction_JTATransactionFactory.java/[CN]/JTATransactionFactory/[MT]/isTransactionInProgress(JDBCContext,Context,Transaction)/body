{
  try {
    if (transaction != null) {
      UserTransaction ut=((JTATransaction)transaction).getUserTransaction();
      if (ut != null) {
        return JTAHelper.isInProgress(ut.getStatus());
      }
    }
    if (jdbcContext.getFactory().getTransactionManager() != null) {
      return JTAHelper.isInProgress(jdbcContext.getFactory().getTransactionManager().getStatus());
    }
 else {
      UserTransaction ut=getUserTransaction();
      return ut != null && JTAHelper.isInProgress(ut.getStatus());
    }
  }
 catch (  SystemException se) {
    throw new TransactionException("Unable to check transaction status",se);
  }
}
