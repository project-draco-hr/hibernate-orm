{
  EntityReferenceAliasesImpl aliases=aliasesByEntityReference.get(entityReference);
  if (aliases == null) {
    if (BidirectionalEntityFetch.class.isInstance(entityReference)) {
      return resolveAliases(((BidirectionalEntityFetch)entityReference).getTargetEntityReference());
    }
    final EntityPersister entityPersister=entityReference.getEntityPersister();
    aliases=new EntityReferenceAliasesImpl(createTableAlias(entityPersister),createEntityAliases(entityPersister));
    aliasesByEntityReference.put(entityReference,aliases);
  }
  return aliases;
}
