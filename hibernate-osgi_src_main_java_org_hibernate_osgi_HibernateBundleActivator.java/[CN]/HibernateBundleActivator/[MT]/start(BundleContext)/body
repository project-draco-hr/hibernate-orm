{
  osgiClassLoader=new OsgiClassLoader();
  osgiClassLoader.addBundle(FrameworkUtil.getBundle(Session.class));
  osgiClassLoader.addBundle(FrameworkUtil.getBundle(HibernatePersistenceProvider.class));
  ClassLoaderHelper.overridenClassLoader=osgiClassLoader;
  osgiJtaPlatform=new OsgiJtaPlatform(context);
  Dictionary properties=new Hashtable();
  properties.put("javax.persistence.provider",HibernatePersistenceProvider.class.getName());
  context.registerService(PersistenceProvider.class.getName(),new OsgiPersistenceProviderService(osgiClassLoader,osgiJtaPlatform,context),properties);
  context.registerService(SessionFactory.class.getName(),new OsgiSessionFactoryService(osgiClassLoader,osgiJtaPlatform,context),new Hashtable());
}
