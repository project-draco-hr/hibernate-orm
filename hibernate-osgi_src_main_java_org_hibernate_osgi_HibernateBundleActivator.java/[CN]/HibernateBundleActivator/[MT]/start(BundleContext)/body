{
  osgiClassLoader=new OsgiClassLoader();
  osgiClassLoader.addBundle(FrameworkUtil.getBundle(Session.class));
  osgiClassLoader.addBundle(FrameworkUtil.getBundle(HibernatePersistenceProvider.class));
  ClassLoaderHelper.overridenClassLoader=osgiClassLoader;
  osgiServiceUtil=new OsgiServiceUtil(context);
  final OsgiJtaPlatform osgiJtaPlatform=new OsgiJtaPlatform(osgiServiceUtil);
  final Dictionary properties=new Hashtable();
  properties.put("javax.persistence.provider",HibernatePersistenceProvider.class.getName());
  persistenceProviderService=context.registerService(PersistenceProvider.class.getName(),new OsgiPersistenceProviderService(osgiClassLoader,osgiJtaPlatform,osgiServiceUtil),properties);
  sessionFactoryService=context.registerService(SessionFactory.class.getName(),new OsgiSessionFactoryService(osgiClassLoader,osgiJtaPlatform,osgiServiceUtil),new Hashtable());
}
