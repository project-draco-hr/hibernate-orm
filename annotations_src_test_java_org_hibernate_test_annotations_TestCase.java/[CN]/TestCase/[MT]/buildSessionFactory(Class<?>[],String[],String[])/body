{
  if (getSessions() != null) {
    getSessions().close();
  }
  try {
    setCfg(new AnnotationConfiguration());
    configure(cfg);
    if (recreateSchema()) {
      cfg.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
    }
    for (    String aPackage : packages) {
      getCfg().addPackage(aPackage);
    }
    for (    Class<?> aClass : classes) {
      getCfg().addAnnotatedClass(aClass);
    }
    for (    String xmlFile : xmlFiles) {
      InputStream is=Thread.currentThread().getContextClassLoader().getResourceAsStream(xmlFile);
      getCfg().addInputStream(is);
    }
    setSessions(getCfg().buildSessionFactory());
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
