{
  log.trace("===> opening session for request [" + request.hashCode() + "]");
  Session session=HibernateUtil.getSessionFactory().openSession();
  try {
    ManagedSessionContext.bind(session);
    chain.doFilter(request,response);
  }
  finally {
    log.trace("===> cleaning-up session for request [" + request.hashCode() + "]");
    ManagedSessionContext.unbind(HibernateUtil.getSessionFactory());
    try {
      session.close();
    }
 catch (    Throwable t) {
      log.warn("was unable to properly close session for request [" + request.hashCode() + "]");
    }
  }
}
