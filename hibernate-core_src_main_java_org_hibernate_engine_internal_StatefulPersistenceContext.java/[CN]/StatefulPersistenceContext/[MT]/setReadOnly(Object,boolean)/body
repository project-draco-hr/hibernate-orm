{
  if (object == null) {
    throw new AssertionFailure("object must be non-null.");
  }
  if (isReadOnly(object) == readOnly) {
    return;
  }
  if (object instanceof HibernateProxy) {
    final HibernateProxy proxy=(HibernateProxy)object;
    setProxyReadOnly(proxy,readOnly);
    if (Hibernate.isInitialized(proxy)) {
      setEntityReadOnly(proxy.getHibernateLazyInitializer().getImplementation(),readOnly);
    }
  }
 else {
    setEntityReadOnly(object,readOnly);
    final Object maybeProxy=getSession().getPersistenceContext().proxyFor(object);
    if (maybeProxy instanceof HibernateProxy) {
      setProxyReadOnly((HibernateProxy)maybeProxy,readOnly);
    }
  }
}
