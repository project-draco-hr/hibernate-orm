{
  if (sessionFactory == null) {
    return;
  }
  sessionFactory.close();
  serviceRegistry.destroy();
  serviceRegistry=buildServiceRegistry(configuration);
  if (isMetadataUsed) {
    sessionFactory=(SessionFactoryImplementor)buildMetadata(serviceRegistry).buildSessionFactory();
  }
 else {
    sessionFactory=(SessionFactoryImplementor)configuration.buildSessionFactory(serviceRegistry);
  }
  afterSessionFactoryBuilt();
}
