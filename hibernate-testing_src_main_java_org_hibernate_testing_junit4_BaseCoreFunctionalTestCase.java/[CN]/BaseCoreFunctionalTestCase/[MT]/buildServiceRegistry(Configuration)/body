{
  Properties properties=new Properties();
  properties.putAll(configuration.getProperties());
  Environment.verifyProperties(properties);
  ConfigurationHelper.resolvePlaceHolders(properties);
  final BootstrapServiceRegistry bootstrapServiceRegistry=generateBootstrapRegistry(properties);
  StandardServiceRegistryBuilder registryBuilder=new StandardServiceRegistryBuilder(bootstrapServiceRegistry).applySettings(properties);
  prepareBasicRegistryBuilder(registryBuilder);
  return (StandardServiceRegistryImpl)registryBuilder.buildServiceRegistry();
}
