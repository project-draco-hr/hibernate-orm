{
  Properties properties=new Properties();
  properties.putAll(configuration.getProperties());
  Environment.verifyProperties(properties);
  ConfigurationHelper.resolvePlaceHolders(properties);
  final BootstrapServiceRegistryImpl bootstrapServiceRegistry=generateBootstrapRegistry(properties);
  ServiceRegistryBuilder registryBuilder=new ServiceRegistryBuilder(bootstrapServiceRegistry).applySettings(properties);
  prepareBasicRegistryBuilder(registryBuilder);
  return (BasicServiceRegistryImpl)registryBuilder.buildServiceRegistry();
}
