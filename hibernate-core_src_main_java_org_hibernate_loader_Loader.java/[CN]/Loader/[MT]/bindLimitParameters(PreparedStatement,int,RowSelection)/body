{
  Dialect dialect=getFactory().getDialect();
  if (!dialect.supportsVariableLimit()) {
    return 0;
  }
  if (!hasMaxRows(selection)) {
    throw new AssertionFailure("no max results set");
  }
  int firstRow=interpretFirstRow(getFirstRow(selection));
  int lastRow=getMaxOrLimit(selection,dialect);
  boolean hasFirstRow=dialect.supportsLimitOffset() && (firstRow > 0 || dialect.forceLimitUsage());
  boolean reverse=dialect.bindLimitParametersInReverseOrder();
  if (hasFirstRow) {
    statement.setInt(index + (reverse ? 1 : 0),firstRow);
  }
  statement.setInt(index + (reverse || !hasFirstRow ? 0 : 1),lastRow);
  return hasFirstRow ? 2 : 1;
}
