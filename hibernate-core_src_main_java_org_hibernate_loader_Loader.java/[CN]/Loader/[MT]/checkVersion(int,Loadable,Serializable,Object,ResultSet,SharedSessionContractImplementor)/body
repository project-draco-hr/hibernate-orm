{
  Object version=session.getPersistenceContext().getEntry(entity).getVersion();
  if (version != null) {
    final VersionType versionType=persister.getVersionType();
    final Object currentVersion=versionType.nullSafeGet(rs,getEntityAliases()[i].getSuffixedVersionAliases(),session,null);
    if (!versionType.isEqual(version,currentVersion)) {
      if (session.getFactory().getStatistics().isStatisticsEnabled()) {
        session.getFactory().getStatistics().optimisticFailure(persister.getEntityName());
      }
      throw new StaleObjectStateException(persister.getEntityName(),id);
    }
  }
}
