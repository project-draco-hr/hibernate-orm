{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Parent p=new Parent("foo");
  p.getChildren().add(new Child("foo1"));
  p.getChildren().add(new Child("foo2"));
  Parent q=new Parent("bar");
  q.getChildren().add(new Child("bar1"));
  q.getChildren().add(new Child("bar2"));
  Parent r=new Parent("aaa");
  r.getChildren().add(new Child("aaa1"));
  s.persist(p);
  s.persist(q);
  s.persist(r);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  sessionFactory().getStatistics().clear();
  List parents=s.createQuery("from Parent order by name desc").setMaxResults(2).list();
  p=(Parent)parents.get(0);
  q=(Parent)parents.get(1);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  assertFalse(Hibernate.isInitialized(p.getMoreChildren()));
  assertFalse(Hibernate.isInitialized(q.getChildren()));
  assertFalse(Hibernate.isInitialized(q.getMoreChildren()));
  assertEquals(p.getMoreChildren().size(),0);
  assertEquals(p.getChildren().size(),2);
  assertTrue(Hibernate.isInitialized(q.getChildren()));
  assertTrue(Hibernate.isInitialized(q.getMoreChildren()));
  assertEquals(3,sessionFactory().getStatistics().getPrepareStatementCount());
  r=(Parent)s.get(Parent.class,r.getName());
  assertTrue(Hibernate.isInitialized(r.getChildren()));
  assertFalse(Hibernate.isInitialized(r.getMoreChildren()));
  assertEquals(r.getChildren().size(),1);
  assertEquals(r.getMoreChildren().size(),0);
  s.delete(p);
  s.delete(q);
  s.delete(r);
  t.commit();
  s.close();
}
