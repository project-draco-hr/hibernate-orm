{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Parent p=new Parent("foo");
  p.getChildren().add(new Child("foo1"));
  p.getChildren().add(new Child("foo2"));
  Parent q=new Parent("bar");
  q.getChildren().add(new Child("bar1"));
  q.getChildren().add(new Child("bar2"));
  q.getMoreChildren().addAll(p.getChildren());
  s.persist(p);
  s.persist(q);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  sessionFactory().getStatistics().clear();
  List parents=s.createCriteria(Parent.class).add(Property.forName("name").between("bar","foo")).addOrder(Order.desc("name")).list();
  p=(Parent)parents.get(0);
  q=(Parent)parents.get(1);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  assertFalse(Hibernate.isInitialized(q.getChildren()));
  assertEquals(p.getChildren().size(),2);
  assertTrue(Hibernate.isInitialized(p.getChildren().iterator().next()));
  assertTrue(Hibernate.isInitialized(q.getChildren()));
  assertEquals(q.getChildren().size(),2);
  assertTrue(Hibernate.isInitialized(q.getChildren().iterator().next()));
  assertFalse(Hibernate.isInitialized(p.getMoreChildren()));
  assertFalse(Hibernate.isInitialized(q.getMoreChildren()));
  assertEquals(p.getMoreChildren().size(),0);
  assertTrue(Hibernate.isInitialized(q.getMoreChildren()));
  assertEquals(q.getMoreChildren().size(),2);
  assertTrue(Hibernate.isInitialized(q.getMoreChildren().iterator().next()));
  assertEquals(3,sessionFactory().getStatistics().getPrepareStatementCount());
  Child c=(Child)p.getChildren().get(0);
  c.getFriends().size();
  s.delete(p);
  s.delete(q);
  t.commit();
  s.close();
}
