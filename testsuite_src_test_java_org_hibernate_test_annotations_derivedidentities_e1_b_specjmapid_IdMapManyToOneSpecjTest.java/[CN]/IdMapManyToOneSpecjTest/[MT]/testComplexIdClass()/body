{
  Session s=openSession();
  Transaction tx=s.beginTransaction();
  Customer c1=new Customer("foo","bar","contact1","100",new BigDecimal(1000),new BigDecimal(1000),new BigDecimal(1000));
  s.persist(c1);
  s.flush();
  s.clear();
  Item boat=new Item();
  boat.setId("1");
  boat.setName("cruiser");
  boat.setPrice(new BigDecimal(500));
  boat.setDescription("a boat");
  boat.setCategory(42);
  s.persist(boat);
  Item house=new Item();
  house.setId("2");
  house.setName("blada");
  house.setPrice(new BigDecimal(5000));
  house.setDescription("a house");
  house.setCategory(74);
  s.persist(house);
  s.flush();
  s.clear();
  c1.addInventory(boat,10,new BigDecimal(5000));
  c1.addInventory(house,100,new BigDecimal(50000));
  s.merge(c1);
  s.flush();
  s.clear();
  Customer c12=(Customer)s.createQuery("select c from Customer c").uniqueResult();
  List<CustomerInventory> inventory=c12.getInventories();
  assertEquals(2,inventory.size());
  assertEquals(10,inventory.get(0).getQuantity());
  Item house2=new Item();
  house2.setId("3");
  house2.setName("blada");
  house2.setPrice(new BigDecimal(5000));
  house2.setDescription("a house");
  house2.setCategory(74);
  s.persist(house2);
  s.flush();
  s.clear();
  c12.addInventory(house2,200,new BigDecimal(500000));
  s.merge(c12);
  s.flush();
  s.clear();
  Customer c13=(Customer)s.createQuery("select c from Customer c where c.id = " + c12.getId()).uniqueResult();
  assertEquals(3,c13.getInventories().size());
  tx.rollback();
  s.close();
}
