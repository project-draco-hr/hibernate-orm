{
  if (em == null) {
    return;
  }
  if (em.getTransaction().isActive()) {
    em.getTransaction().rollback();
    log.warn("You left an open transaction! Fix your test case. For now, we are closing it for you.");
  }
  if (em.isOpen()) {
    em.close();
    log.warn("The EntityManager is not closed. Closing it.");
  }
}
