{
  if (scrollable && !factory.getSettings().isScrollableResultSetsEnabled()) {
    throw new AssertionFailure("scrollable result sets are not enabled");
  }
  if (useGetGeneratedKeys && !factory.getSettings().isGetGeneratedKeysEnabled()) {
    throw new AssertionFailure("getGeneratedKeys() support is not enabled");
  }
  sql=getSQL(sql);
  log(sql);
  log.trace("preparing statement");
  PreparedStatement result;
  if (scrollable) {
    if (callable) {
      result=conn.prepareCall(sql,scrollMode.toResultSetType(),ResultSet.CONCUR_READ_ONLY);
    }
 else {
      result=conn.prepareStatement(sql,scrollMode.toResultSetType(),ResultSet.CONCUR_READ_ONLY);
    }
  }
 else   if (useGetGeneratedKeys) {
    result=GetGeneratedKeysHelper.prepareStatement(conn,sql);
  }
 else   if (namedGeneratedKeys != null) {
    result=NamedGeneratedKeysHelper.prepareStatement(conn,sql,namedGeneratedKeys);
  }
 else {
    if (callable) {
      result=conn.prepareCall(sql);
    }
 else {
      result=conn.prepareStatement(sql);
    }
  }
  setTimeout(result);
  if (factory.getStatistics().isStatisticsEnabled()) {
    factory.getStatisticsImplementor().prepareStatement();
  }
  return result;
}
