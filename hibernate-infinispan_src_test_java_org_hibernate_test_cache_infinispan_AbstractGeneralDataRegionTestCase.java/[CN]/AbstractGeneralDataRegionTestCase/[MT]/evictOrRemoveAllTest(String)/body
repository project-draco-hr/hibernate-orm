{
  Configuration cfg=createConfiguration();
  InfinispanRegionFactory regionFactory=CacheTestUtil.startRegionFactory(new ServiceRegistryBuilder().applySettings(cfg.getProperties()).buildServiceRegistry(),cfg,getCacheTestSupport());
  CacheAdapter localCache=getInfinispanCache(regionFactory);
  avoidConcurrentFlush();
  GeneralDataRegion localRegion=(GeneralDataRegion)createRegion(regionFactory,getStandardRegionName(REGION_PREFIX),cfg.getProperties(),null);
  cfg=createConfiguration();
  regionFactory=CacheTestUtil.startRegionFactory(new ServiceRegistryBuilder().applySettings(cfg.getProperties()).buildServiceRegistry(),cfg,getCacheTestSupport());
  CacheAdapter remoteCache=getInfinispanCache(regionFactory);
  avoidConcurrentFlush();
  GeneralDataRegion remoteRegion=(GeneralDataRegion)createRegion(regionFactory,getStandardRegionName(REGION_PREFIX),cfg.getProperties(),null);
  Set keys=localCache.keySet();
  assertEquals("No valid children in " + keys,0,getValidKeyCount(keys));
  keys=remoteCache.keySet();
  assertEquals("No valid children in " + keys,0,getValidKeyCount(keys));
  assertNull("local is clean",localRegion.get(KEY));
  assertNull("remote is clean",remoteRegion.get(KEY));
  regionPut(localRegion);
  assertEquals(VALUE1,localRegion.get(KEY));
  sleep(250);
  regionPut(remoteRegion);
  assertEquals(VALUE1,remoteRegion.get(KEY));
  sleep(250);
  localRegion.evictAll();
  sleep(250);
  assertNull(localRegion.get(KEY));
  assertEquals("No valid children in " + keys,0,getValidKeyCount(localCache.keySet()));
  assertEquals(null,remoteRegion.get(KEY));
  assertEquals("No valid children in " + keys,0,getValidKeyCount(remoteCache.keySet()));
  assertEquals("local is clean",null,localRegion.get(KEY));
  assertEquals("remote is clean",null,remoteRegion.get(KEY));
}
