{
  final InfinispanRegionFactory factory=new TestInfinispanRegionFactory(){
    @Override protected org.infinispan.transaction.lookup.TransactionManagerLookup createTransactionManagerLookup(    SessionFactoryOptions settings,    Properties properties){
      return new HibernateTransactionManagerLookup(null,null){
        @Override public TransactionManager getTransactionManager() throws Exception {
          AbstractJtaPlatform jta=new JBossStandAloneJtaPlatform();
          jta.injectServices(ServiceRegistryBuilder.buildServiceRegistry());
          return jta.getTransactionManager();
        }
      }
;
    }
    @Override protected EmbeddedCacheManager createCacheManager(    Properties properties,    ServiceRegistry serviceRegistry) throws CacheException {
      if (manager != null)       return manager;
 else       return super.createCacheManager(properties,serviceRegistry);
    }
  }
;
  factory.start(sfOptionsForStart(),p);
  return factory;
}
