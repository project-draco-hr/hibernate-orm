{
  TypeMirror collectionElementType;
  if (explicitTargetEntityName != null) {
    Elements elements=context.getProcessingEnvironment().getElementUtils();
    TypeElement element=elements.getTypeElement(explicitTargetEntityName);
    collectionElementType=element.asType();
  }
 else {
    List<? extends TypeMirror> typeArguments=t.getTypeArguments();
    if (typeArguments.size() == 0) {
      throw new MetaModelGenerationException("Unable to determine collection type for property in " + getSimpleName());
    }
 else     if (Map.class.getCanonicalName().equals(fqNameOfReturnedType)) {
      collectionElementType=t.getTypeArguments().get(1);
    }
 else {
      collectionElementType=t.getTypeArguments().get(0);
    }
  }
  return collectionElementType;
}
