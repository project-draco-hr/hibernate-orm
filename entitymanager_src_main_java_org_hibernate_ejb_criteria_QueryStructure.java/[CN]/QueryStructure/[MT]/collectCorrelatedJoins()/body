{
  if (!isSubQuery) {
    throw new IllegalStateException("Query is not identified as sub-query");
  }
  final Set<Join<?,?>> correlatedJoins;
  if (correlationRoots != null) {
    correlatedJoins=new HashSet<Join<?,?>>();
    for (    FromImplementor<?,?> correlationRoot : correlationRoots) {
      correlatedJoins.addAll(correlationRoot.getJoins());
    }
  }
 else {
    correlatedJoins=Collections.emptySet();
  }
  return correlatedJoins;
}
