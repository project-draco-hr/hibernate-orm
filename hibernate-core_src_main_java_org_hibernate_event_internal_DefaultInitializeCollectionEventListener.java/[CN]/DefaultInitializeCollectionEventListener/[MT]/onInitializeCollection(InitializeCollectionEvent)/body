{
  PersistentCollection collection=event.getCollection();
  SessionImplementor source=event.getSession();
  CollectionEntry ce=source.getPersistenceContext().getCollectionEntry(collection);
  if (ce == null)   throw new HibernateException("collection was evicted");
  if (!collection.wasInitialized()) {
    final boolean traceEnabled=LOG.isTraceEnabled();
    if (traceEnabled) {
      LOG.tracev("Initializing collection {0}",MessageHelper.collectionInfoString(ce.getLoadedPersister(),collection,ce.getLoadedKey(),source));
      LOG.trace("Checking second-level cache");
    }
    final boolean foundInCache=initializeCollectionFromCache(ce.getLoadedKey(),ce.getLoadedPersister(),collection,source);
    if (foundInCache && traceEnabled) {
      LOG.trace("Collection initialized from cache");
    }
 else {
      if (traceEnabled) {
        LOG.trace("Collection not cached");
      }
      ce.getLoadedPersister().initialize(ce.getLoadedKey(),source);
      if (traceEnabled) {
        LOG.trace("Collection initialized");
      }
      if (source.getFactory().getStatistics().isStatisticsEnabled()) {
        source.getFactory().getStatisticsImplementor().fetchCollection(ce.getLoadedPersister().getRole());
      }
    }
  }
}
