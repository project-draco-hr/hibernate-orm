{
  if (!begun) {
    throw new TransactionException("Transaction not successfully started");
  }
  LOG.debugf("Commit");
  if (!transactionContext.isFlushModeNever() && callback) {
    transactionContext.managedFlush();
  }
  notifySynchronizationsBeforeTransactionCompletion();
  if (callback) {
    jdbcContext.beforeTransactionCompletion(this);
  }
  try {
    commitAndResetAutoCommit();
    LOG.debugf("Committed JDBC Connection");
    committed=true;
    if (callback) {
      jdbcContext.afterTransactionCompletion(true,this);
    }
    notifySynchronizationsAfterTransactionCompletion(Status.STATUS_COMMITTED);
  }
 catch (  SQLException e) {
    LOG.error(LOG.unableToPerformJdbcCommit(),e);
    commitFailed=true;
    if (callback) {
      jdbcContext.afterTransactionCompletion(false,this);
    }
    notifySynchronizationsAfterTransactionCompletion(Status.STATUS_UNKNOWN);
    throw new TransactionException(LOG.unableToPerformJdbcCommit(),e);
  }
 finally {
    closeIfRequired();
  }
}
