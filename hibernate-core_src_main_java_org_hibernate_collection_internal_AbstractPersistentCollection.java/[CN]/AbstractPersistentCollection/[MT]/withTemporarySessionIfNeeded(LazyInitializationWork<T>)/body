{
  SessionImplementor originalSession=null;
  boolean isTempSession=false;
  boolean isJTA=false;
  if (session == null) {
    if (allowLoadOutsideTransaction) {
      session=openTemporarySessionForLoading();
      isTempSession=true;
    }
 else {
      throwLazyInitializationException("could not initialize proxy - no Session");
    }
  }
 else   if (!session.isOpen()) {
    if (allowLoadOutsideTransaction) {
      originalSession=session;
      session=openTemporarySessionForLoading();
      isTempSession=true;
    }
 else {
      throwLazyInitializationException("could not initialize proxy - the owning Session was closed");
    }
  }
 else   if (!session.isConnected()) {
    if (allowLoadOutsideTransaction) {
      originalSession=session;
      session=openTemporarySessionForLoading();
      isTempSession=true;
    }
 else {
      throwLazyInitializationException("could not initialize proxy - the owning Session is disconnected");
    }
  }
  if (isTempSession) {
    isJTA=session.getTransactionCoordinator().getTransactionCoordinatorBuilder().isJta();
    if (!isJTA) {
      ((Session)session).beginTransaction();
    }
    session.getPersistenceContext().addUninitializedDetachedCollection(session.getFactory().getCollectionPersister(getRole()),this);
  }
  try {
    return lazyInitializationWork.doWork();
  }
  finally {
    if (isTempSession) {
      try {
        if (!isJTA) {
          ((Session)session).getTransaction().commit();
        }
        ((Session)session).close();
      }
 catch (      Exception e) {
        LOG.warn("Unable to close temporary session used to load lazy collection associated to no session");
      }
      session=originalSession;
    }
  }
}
