{
  PersistenceMetadata metadata=new PersistenceMetadata();
{
    Ejb3Configuration cfg=new Ejb3Configuration();
    Ejb3Configuration configured=cfg.configure(metadata,Collections.singletonMap(AvailableSettings.SHARED_CACHE_MODE,SharedCacheMode.DISABLE_SELECTIVE));
    assertEquals(SharedCacheMode.DISABLE_SELECTIVE.name(),configured.getProperties().get(AvailableSettings.SHARED_CACHE_MODE));
  }
{
    Ejb3Configuration cfg=new Ejb3Configuration();
    Ejb3Configuration configured=cfg.configure(metadata,Collections.singletonMap(AvailableSettings.SHARED_CACHE_MODE,SharedCacheMode.DISABLE_SELECTIVE.name()));
    assertEquals(SharedCacheMode.DISABLE_SELECTIVE.name(),configured.getProperties().get(AvailableSettings.SHARED_CACHE_MODE));
  }
  metadata.setSharedCacheMode(SharedCacheMode.ENABLE_SELECTIVE.name());
{
    Ejb3Configuration cfg=new Ejb3Configuration();
    Ejb3Configuration configured=cfg.configure(metadata,null);
    assertEquals(SharedCacheMode.ENABLE_SELECTIVE.name(),configured.getProperties().get(AvailableSettings.SHARED_CACHE_MODE));
  }
{
    Ejb3Configuration cfg=new Ejb3Configuration();
    Ejb3Configuration configured=cfg.configure(metadata,Collections.singletonMap(AvailableSettings.SHARED_CACHE_MODE,SharedCacheMode.DISABLE_SELECTIVE));
    assertEquals(SharedCacheMode.DISABLE_SELECTIVE.name(),configured.getProperties().get(AvailableSettings.SHARED_CACHE_MODE));
  }
}
