{
  Session s=openSession();
  s.beginTransaction();
  Baz baz=new Baz();
  s.save(baz);
  List l=new ArrayList();
  List l2=new ArrayList();
  baz.setIdFooBag(l);
  baz.setByteBag(l2);
  l.add(new Foo());
  l.add(new Bar());
  byte[] bytes="ffo".getBytes();
  l2.add(bytes);
  l2.add("foo".getBytes());
  s.flush();
  l.add(new Foo());
  l.add(new Bar());
  l2.add("bar".getBytes());
  s.flush();
  s.delete(l.remove(3));
  bytes[1]='o';
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  baz=(Baz)s.load(Baz.class,baz.getCode());
  assertTrue(baz.getIdFooBag().size() == 3);
  assertTrue(baz.getByteBag().size() == 3);
  bytes="foobar".getBytes();
  Iterator iter=baz.getIdFooBag().iterator();
  while (iter.hasNext())   s.delete(iter.next());
  baz.setIdFooBag(null);
  baz.getByteBag().add(bytes);
  baz.getByteBag().add(bytes);
  assertTrue(baz.getByteBag().size() == 5);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  baz=(Baz)s.load(Baz.class,baz.getCode());
  assertTrue(baz.getIdFooBag().size() == 0);
  assertTrue(baz.getByteBag().size() == 5);
  baz.getIdFooBag().add(new Foo());
  iter=baz.getByteBag().iterator();
  iter.next();
  iter.remove();
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  baz=(Baz)s.load(Baz.class,baz.getCode());
  assertTrue(baz.getIdFooBag().size() == 1);
  assertTrue(baz.getByteBag().size() == 4);
  s.delete(baz);
  s.getTransaction().commit();
  s.close();
}
