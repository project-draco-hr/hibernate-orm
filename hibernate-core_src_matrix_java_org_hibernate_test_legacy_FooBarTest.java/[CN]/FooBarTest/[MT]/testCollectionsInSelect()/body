{
  Session s=openSession();
  Transaction t=s.beginTransaction();
  Foo[] foos=new Foo[]{null,new Foo()};
  s.save(foos[1]);
  Baz baz=new Baz();
  baz.setDefaults();
  baz.setFooArray(foos);
  s.save(baz);
  Baz baz2=new Baz();
  baz2.setDefaults();
  s.save(baz2);
  Bar bar=new Bar();
  bar.setBaz(baz);
  s.save(bar);
  List list=s.createQuery("select new Result(foo.string, foo.long, foo.integer) from Foo foo").list();
  assertTrue(list.size() == 2 && (list.get(0) instanceof Result) && (list.get(1) instanceof Result));
  list=s.createQuery("select new Result( baz.name, max(foo.long), count(foo) ) from Baz baz join baz.fooArray foo group by baz.name").list();
  assertTrue(list.size() == 1 && (list.get(0) instanceof Result));
  Result r=((Result)list.get(0));
  assertEquals(r.getName(),baz.getName());
  assertEquals(r.getCount(),1);
  assertTrue(r.getAmount() > 696969696969696000l);
  if (!(getDialect() instanceof MySQLDialect) && !(getDialect() instanceof HSQLDialect) && !(getDialect() instanceof SAPDBDialect)&& !(getDialect() instanceof PointbaseDialect)) {
    s.createQuery("select count(*) from Baz as baz where 1 in indices(baz.fooArray)").list();
    s.createQuery("select count(*) from Bar as bar where 'abc' in elements(bar.baz.fooArray)").list();
    s.createQuery("select count(*) from Bar as bar where 1 in indices(bar.baz.fooArray)").list();
    if (!(getDialect() instanceof DB2Dialect) && !(getDialect() instanceof Oracle8iDialect) && !(getDialect() instanceof SybaseDialect)&& !(getDialect() instanceof Sybase11Dialect)&& !(getDialect() instanceof SybaseASE15Dialect)&& !(getDialect() instanceof PostgreSQLDialect)) {
      s.createQuery("select count(*) from Bar as bar, bar.component.glarch.proxyArray as g where g.id in indices(bar.baz.fooArray)").list();
      s.createQuery("select max( elements(bar.baz.fooArray) ) from Bar as bar, bar.component.glarch.proxyArray as g where g.id in indices(bar.baz.fooArray)").list();
    }
    s.createQuery("select count(*) from Bar as bar where '1' in (from bar.component.glarch.proxyArray g where g.name='foo')").list();
    s.createQuery("select count(*) from Bar as bar where '1' in (from bar.component.glarch.proxyArray g where g.name='foo')").list();
    s.createQuery("select count(*) from Bar as bar left outer join bar.component.glarch.proxyArray as pg where '1' in (from bar.component.glarch.proxyArray)").list();
  }
  list=s.createQuery("from Baz baz left join baz.fooToGlarch join fetch baz.fooArray foo left join fetch foo.foo").list();
  assertTrue(list.size() == 1 && ((Object[])list.get(0)).length == 2);
  s.createQuery("select baz.name from Bar bar inner join bar.baz baz inner join baz.fooSet foo where baz.name = bar.string").list();
  s.createQuery("SELECT baz.name FROM Bar AS bar INNER JOIN bar.baz AS baz INNER JOIN baz.fooSet AS foo WHERE baz.name = bar.string").list();
  if (!(getDialect() instanceof HSQLDialect))   s.createQuery("select baz.name from Bar bar join bar.baz baz left outer join baz.fooSet foo where baz.name = bar.string").list();
  s.createQuery("select baz.name from Bar bar join bar.baz baz join baz.fooSet foo where baz.name = bar.string").list();
  s.createQuery("SELECT baz.name FROM Bar AS bar JOIN bar.baz AS baz JOIN baz.fooSet AS foo WHERE baz.name = bar.string").list();
  if (!(getDialect() instanceof HSQLDialect)) {
    s.createQuery("select baz.name from Bar bar left join bar.baz baz left join baz.fooSet foo where baz.name = bar.string").list();
    s.createQuery("select foo.string from Bar bar left join bar.baz.fooSet foo where bar.string = foo.string").list();
  }
  s.createQuery("select baz.name from Bar bar left join bar.baz baz left join baz.fooArray foo where baz.name = bar.string").list();
  s.createQuery("select foo.string from Bar bar left join bar.baz.fooArray foo where bar.string = foo.string").list();
  s.createQuery("select bar.string, foo.string from Bar bar inner join bar.baz as baz inner join baz.fooSet as foo where baz.name = 'name'").list();
  s.createQuery("select foo from Bar bar inner join bar.baz as baz inner join baz.fooSet as foo").list();
  s.createQuery("select foo from Bar bar inner join bar.baz.fooSet as foo").list();
  s.createQuery("select bar.string, foo.string from Bar bar join bar.baz as baz join baz.fooSet as foo where baz.name = 'name'").list();
  s.createQuery("select foo from Bar bar join bar.baz as baz join baz.fooSet as foo").list();
  s.createQuery("select foo from Bar bar join bar.baz.fooSet as foo").list();
  assertTrue(s.createQuery("from Bar bar join bar.baz.fooArray foo").list().size() == 1);
  assertTrue(s.createQuery("from Bar bar join bar.baz.fooSet foo").list().size() == 0);
  assertTrue(s.createQuery("from Bar bar join bar.baz.fooArray foo").list().size() == 1);
  s.delete(bar);
  if (getDialect() instanceof DB2Dialect || getDialect() instanceof PostgreSQLDialect) {
    s.createQuery("select one from One one join one.manies many group by one order by count(many)").iterate();
    s.createQuery("select one from One one join one.manies many group by one having count(many) < 5").iterate();
  }
  s.createQuery("from One one join one.manies many where one.id = 1 and many.id = 1").list();
  s.createQuery("select one.id, elements(one.manies) from One one").iterate();
  s.createQuery("select max( elements(one.manies) ) from One one").iterate();
  s.createQuery("select one, elements(one.manies) from One one").list();
  Iterator iter=s.createQuery("select elements(baz.fooArray) from Baz baz where baz.id=?").setParameter(0,baz.getCode(),StandardBasicTypes.STRING).iterate();
  assertTrue(iter.next() == foos[1] && !iter.hasNext());
  list=s.createQuery("select elements(baz.fooArray) from Baz baz where baz.id=?").setParameter(0,baz.getCode(),StandardBasicTypes.STRING).list();
  assertEquals(1,list.size());
  iter=s.createQuery("select indices(baz.fooArray) from Baz baz where baz.id=?").setParameter(0,baz.getCode(),StandardBasicTypes.STRING).iterate();
  assertTrue(iter.next().equals(new Integer(1)) && !iter.hasNext());
  iter=s.createQuery("select size(baz.stringSet) from Baz baz where baz.id=?").setParameter(0,baz.getCode(),StandardBasicTypes.STRING).iterate();
  assertEquals(new Integer(3),iter.next());
  s.createQuery("from Foo foo where foo.component.glarch.id is not null").list();
  iter=s.createQuery("select baz, size(baz.stringSet), count( distinct elements(baz.stringSet) ), max( elements(baz.stringSet) ) from Baz baz group by baz").iterate();
  while (iter.hasNext()) {
    Object[] arr=(Object[])iter.next();
    log.info(arr[0] + " " + arr[1]+ " "+ arr[2]+ " "+ arr[3]);
  }
  s.delete(baz);
  s.delete(baz2);
  s.delete(foos[1]);
  t.commit();
  s.close();
}
