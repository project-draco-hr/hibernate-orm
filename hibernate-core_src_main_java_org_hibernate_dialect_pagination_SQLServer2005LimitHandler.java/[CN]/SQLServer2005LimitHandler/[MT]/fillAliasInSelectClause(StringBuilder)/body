{
  final String separator=System.lineSeparator();
  final List<String> aliases=new LinkedList<String>();
  final int startPos=shallowIndexOfPattern(sb,SELECT_PATTERN,0);
  int endPos=shallowIndexOfPattern(sb,FROM_PATTERN,startPos);
  int nextComa=startPos;
  int prevComa=startPos;
  int unique=0;
  boolean selectsMultipleColumns=false;
  while (nextComa != -1) {
    prevComa=nextComa;
    nextComa=shallowIndexOfPattern(sb,COMMA_PATTERN,nextComa);
    if (nextComa > endPos) {
      break;
    }
    if (nextComa != -1) {
      final String expression=sb.substring(prevComa,nextComa);
      if (selectsMultipleColumns(expression)) {
        selectsMultipleColumns=true;
      }
 else {
        String alias=getAlias(expression);
        if (alias == null) {
          alias=StringHelper.generateAlias("page",unique);
          sb.insert(nextComa," as " + alias);
          final int aliasExprLength=(" as " + alias).length();
          ++unique;
          nextComa+=aliasExprLength;
          endPos+=aliasExprLength;
        }
        aliases.add(alias);
      }
      ++nextComa;
    }
  }
  endPos=shallowIndexOfPattern(sb,FROM_PATTERN,startPos);
  final String expression=sb.substring(prevComa,endPos);
  if (selectsMultipleColumns(expression)) {
    selectsMultipleColumns=true;
  }
 else {
    String alias=getAlias(expression);
    if (alias == null) {
      alias=StringHelper.generateAlias("page",unique);
      final boolean endWithSeparator=sb.substring(endPos - separator.length()).startsWith(separator);
      sb.insert(endPos - (endWithSeparator ? 2 : 1)," as " + alias);
    }
    aliases.add(alias);
  }
  return selectsMultipleColumns ? "*" : StringHelper.join(", ",aliases.iterator());
}
