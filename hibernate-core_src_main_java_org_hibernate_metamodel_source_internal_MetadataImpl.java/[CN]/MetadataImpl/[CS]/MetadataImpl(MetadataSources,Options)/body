{
  this.serviceRegistry=metadataSources.getServiceRegistry();
  this.options=options;
  this.mappingDefaults=new MappingDefaultsImpl();
  final Binder[] binders;
  if (options.getSourceProcessingOrder() == SourceProcessingOrder.HBM_FIRST) {
    binders=new Binder[]{new HbmBinder(this),new AnnotationBinder(this)};
  }
 else {
    binders=new Binder[]{new AnnotationBinder(this),new HbmBinder(this)};
  }
  final ArrayList<String> processedEntityNames=new ArrayList<String>();
  prepare(binders,metadataSources);
  bindIndependentMetadata(binders,metadataSources);
  bindTypeDependentMetadata(binders,metadataSources);
  bindMappingMetadata(binders,metadataSources,processedEntityNames);
  bindMappingDependentMetadata(binders,metadataSources);
  new EntityReferenceResolver(this).resolve();
  new AttributeTypeResolver(this).resolve();
}
