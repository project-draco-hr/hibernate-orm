{
  if (obj == null) {
    return;
  }
  Object entityId=delegate.mapToIdFromMap((Map)data.get(propertyData.getName()));
  Object value;
  if (entityId == null) {
    value=null;
  }
 else {
    if (versionsReader.getFirstLevelCache().contains(referencedEntityName,revision,entityId)) {
      value=versionsReader.getFirstLevelCache().get(referencedEntityName,revision,entityId);
    }
 else {
      EntityConfiguration entCfg=verCfg.getEntCfg().get(referencedEntityName);
      if (entCfg == null) {
        entCfg=verCfg.getEntCfg().getNotVersionEntityConfiguration(referencedEntityName);
      }
      Class<?> entityClass=ReflectionTools.loadClass(entCfg.getEntityClassName());
      value=versionsReader.getSessionImplementor().getFactory().getEntityPersister(referencedEntityName).createProxy((Serializable)entityId,new ToOneDelegateSessionImplementor(versionsReader,entityClass,entityId,revision,verCfg));
    }
  }
  Setter setter=ReflectionTools.getSetter(obj.getClass(),propertyData);
  setter.set(obj,value,null);
}
