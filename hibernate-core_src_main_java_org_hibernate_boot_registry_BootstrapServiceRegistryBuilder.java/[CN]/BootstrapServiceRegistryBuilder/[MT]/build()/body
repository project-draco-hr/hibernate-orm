{
  final ClassLoaderService classLoaderService;
  if (providedClassLoaderService == null) {
    final Set<ClassLoader> classLoaders=new HashSet<ClassLoader>();
    if (providedClassLoaders != null) {
      classLoaders.addAll(providedClassLoaders);
    }
    if (ClassLoaderHelper.overridenClassLoader != null) {
      classLoaders.add(ClassLoaderHelper.overridenClassLoader);
    }
    classLoaderService=new ClassLoaderServiceImpl(classLoaders);
  }
 else {
    classLoaderService=providedClassLoaderService;
  }
  final IntegratorServiceImpl integratorService=new IntegratorServiceImpl(providedIntegrators,classLoaderService);
  return new BootstrapServiceRegistryImpl(classLoaderService,strategySelectorBuilder.buildSelector(classLoaderService),integratorService);
}
