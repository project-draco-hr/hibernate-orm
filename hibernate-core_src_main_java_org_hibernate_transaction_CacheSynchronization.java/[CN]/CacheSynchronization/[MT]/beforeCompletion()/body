{
  LOG.transactionBeforeCompletionCallback();
  boolean flush;
  try {
    flush=!ctx.isFlushModeNever() && ctx.isFlushBeforeCompletionEnabled() && !JTAHelper.isRollback(transaction.getStatus());
  }
 catch (  SystemException se) {
    LOG.error(LOG.unableToDetermineTransactionStatus(),se);
    setRollbackOnly();
    throw new TransactionException("could not determine transaction status in beforeCompletion()",se);
  }
  try {
    if (flush) {
      LOG.automaticallyFlushingSession();
      ctx.managedFlush();
    }
  }
 catch (  RuntimeException re) {
    setRollbackOnly();
    throw re;
  }
 finally {
    jdbcContext.beforeTransactionCompletion(hibernateTransaction);
  }
}
