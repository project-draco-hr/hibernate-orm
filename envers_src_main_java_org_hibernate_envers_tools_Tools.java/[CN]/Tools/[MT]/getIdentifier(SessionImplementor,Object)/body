{
  if (obj == null) {
    return null;
  }
  if (obj instanceof HibernateProxy) {
    HibernateProxy hibernateProxy=(HibernateProxy)obj;
    return hibernateProxy.getHibernateLazyInitializer().getIdentifier();
  }
  return session.getEntityPersister(null,obj).getIdentifier(obj,session.getEntityMode());
}
