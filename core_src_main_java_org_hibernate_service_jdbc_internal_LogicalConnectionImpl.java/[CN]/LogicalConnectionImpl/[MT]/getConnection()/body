{
  if (isClosed) {
    throw new HibernateException("Logical connection is closed");
  }
  if (physicalConnection == null) {
    if (isUserSuppliedConnection) {
      throw new HibernateException("User-supplied connection was null");
    }
    obtainConnection();
  }
  return physicalConnection;
}
