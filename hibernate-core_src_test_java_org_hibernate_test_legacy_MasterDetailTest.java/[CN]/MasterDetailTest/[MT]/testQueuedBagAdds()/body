{
  Session s=openSession();
  s.beginTransaction();
  Assignable a=new Assignable();
  a.setId("foo");
  a.setCategories(new ArrayList());
  Category c=new Category();
  c.setAssignable(a);
  a.getCategories().add(c);
  s.save(a);
  s.getTransaction().commit();
  s.close();
  sessionFactory().getCache().evictCollectionRegion("org.hibernate.test.legacy.Assignable.categories");
  s=openSession();
  s.beginTransaction();
  a=(Assignable)s.get(Assignable.class,"foo");
  c=new Category();
  c.setAssignable(a);
  a.getCategories().add(c);
  assertFalse(Hibernate.isInitialized(a.getCategories()));
  assertTrue(a.getCategories().size() == 2);
  s.getTransaction().commit();
  s.close();
  sessionFactory().getCache().evictCollectionRegion("org.hibernate.test.legacy.Assignable.categories");
  s=openSession();
  s.beginTransaction();
  a=(Assignable)s.get(Assignable.class,"foo");
  c=new Category();
  c.setAssignable(a);
  a.getCategories().add(c);
  assertFalse(Hibernate.isInitialized(a.getCategories()));
  s.flush();
  assertFalse(Hibernate.isInitialized(a.getCategories()));
  assertTrue(a.getCategories().size() == 3);
  s.getTransaction().commit();
  s.close();
  sessionFactory().getCache().evictCollectionRegion("org.hibernate.test.legacy.Assignable.categories");
  s=openSession();
  s.beginTransaction();
  a=(Assignable)s.get(Assignable.class,"foo");
  assertTrue(a.getCategories().size() == 3);
  s.delete(a);
  s.getTransaction().commit();
  s.close();
}
