{
  CacheContainer localManager=ClusterAwareRegionFactory.getCacheManager(DualNodeTest.LOCAL);
  localCache=localManager.getCache(Account.class.getName());
  SessionFactory localFactory=sessionFactory();
  SessionFactory remoteFactory=secondNodeEnvironment().getSessionFactory();
  AccountDAO dao0=new AccountDAO(useJta,localFactory);
  AccountDAO dao1=new AccountDAO(useJta,remoteFactory);
  Integer id=new Integer(1);
  dao0.createAccount(dao0.getSmith(),id,new Integer(5),DualNodeTest.LOCAL);
  Account acct1=dao1.getAccount(id);
  assertNotNull(acct1);
  assertEquals(DualNodeTest.LOCAL,acct1.getBranch());
  dao1.updateAccountBranch(id,DualNodeTest.REMOTE);
  Account acct0=dao0.getAccount(id);
  assertNotNull(acct0);
  assertEquals(DualNodeTest.LOCAL,acct0.getBranch());
  log.debug("Contents when re-reading from local: " + TestingUtil.printCache(localCache));
  acct0=dao0.getAccountWithRefresh(id);
  assertNotNull(acct0);
  assertEquals(DualNodeTest.REMOTE,acct0.getBranch());
  log.debug("Contents afterQuery refreshing in remote: " + TestingUtil.printCache(localCache));
  AccountDAO dao0A=new AccountDAO(useJta,localFactory);
  Account acct0A=dao0A.getAccount(id);
  assertNotNull(acct0A);
  assertEquals(DualNodeTest.REMOTE,acct0A.getBranch());
  log.debug("Contents afterQuery creating a new session: " + TestingUtil.printCache(localCache));
}
