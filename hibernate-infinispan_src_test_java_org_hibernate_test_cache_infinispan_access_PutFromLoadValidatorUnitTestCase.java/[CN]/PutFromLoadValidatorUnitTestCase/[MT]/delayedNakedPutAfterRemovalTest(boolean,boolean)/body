{
  withCacheManager(new CacheManagerCallable(TestCacheManagerFactory.createCacheManager(false)){
    @Override public void call(){
      PutFromLoadValidator testee=new PutFromLoadValidator(cm.getCache().getAdvancedCache(),cm,transactional ? tm : null,100);
      if (removeRegion) {
        testee.invalidateRegion();
      }
 else {
        testee.beginInvalidatingKey(KEY1);
        testee.endInvalidatingKey(KEY1);
      }
      try {
        if (transactional) {
          tm.begin();
        }
        Thread.sleep(110);
        PutFromLoadValidator.Lock lock=testee.acquirePutFromLoadLock(KEY1);
        try {
          assertNotNull(lock);
        }
  finally {
          if (lock != null) {
            testee.releasePutFromLoadLock(KEY1,null);
          }
        }
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
}
