{
  String impl=properties.getProperty(Environment.CURRENT_SESSION_CONTEXT_CLASS);
  if (impl == null) {
    if (canAccessTransactionManager()) {
      impl="jta";
    }
 else {
      return null;
    }
  }
  if ("jta".equals(impl)) {
    if (!transactionFactory().compatibleWithJtaSynchronization()) {
      log.warn("JTASessionContext being used with JdbcTransactionFactory; auto-flush will not operate correctly with getCurrentSession()");
    }
    return new JTASessionContext(this);
  }
 else   if ("thread".equals(impl)) {
    return new ThreadLocalSessionContext(this);
  }
 else   if ("managed".equals(impl)) {
    return new ManagedSessionContext(this);
  }
 else {
    try {
      Class implClass=ReflectHelper.classForName(impl);
      return (CurrentSessionContext)implClass.getConstructor(new Class[]{SessionFactoryImplementor.class}).newInstance(this);
    }
 catch (    Throwable t) {
      log.error("Unable to construct current session context [" + impl + "]",t);
      return null;
    }
  }
}
