{
  AuditEntitiesConfiguration audEntCfg=auditCfg.getAuditEntCfg();
  String auditedEntityName=audEntCfg.getAuditEntityName(entityName);
  if (getRevisionType(auditCfg,data) != RevisionType.ADD) {
    QueryBuilder qb=new QueryBuilder(auditedEntityName,"e");
    IdMapper idMapper=auditCfg.getEntCfg().get(entityName).getIdMapper();
    idMapper.addIdEqualsToQuery(qb.getRootParameters(),id,auditCfg.getAuditEntCfg().getOriginalIdPropName(),true);
    qb.getRootParameters().addWhere(auditCfg.getAuditEntCfg().getRevisionEndFieldName(),true,"is","null",false);
    @SuppressWarnings({"unchecked"}) List<Object> l=qb.toQuery(session).list();
    updateLastRevision(session,auditCfg,l,id,auditedEntityName,revision);
  }
  session.save(auditedEntityName,data);
}
