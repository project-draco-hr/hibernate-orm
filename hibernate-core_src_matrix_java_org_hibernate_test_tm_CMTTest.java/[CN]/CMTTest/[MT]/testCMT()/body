{
  sessionFactory().getStatistics().clear();
  TestingJtaBootstrap.INSTANCE.getTransactionManager().begin();
  Session s=openSession();
  TestingJtaBootstrap.INSTANCE.getTransactionManager().commit();
  assertFalse(s.isOpen());
  assertEquals(sessionFactory().getStatistics().getFlushCount(),0);
  TestingJtaBootstrap.INSTANCE.getTransactionManager().begin();
  s=openSession();
  TestingJtaBootstrap.INSTANCE.getTransactionManager().rollback();
  assertFalse(s.isOpen());
  TestingJtaBootstrap.INSTANCE.getTransactionManager().begin();
  s=openSession();
  Map item=new HashMap();
  item.put("name","The Item");
  item.put("description","The only item we have");
  s.persist("Item",item);
  TestingJtaBootstrap.INSTANCE.getTransactionManager().commit();
  assertFalse(s.isOpen());
  TestingJtaBootstrap.INSTANCE.getTransactionManager().begin();
  s=openSession();
  item=(Map)s.createQuery("from Item").uniqueResult();
  assertNotNull(item);
  s.delete(item);
  TestingJtaBootstrap.INSTANCE.getTransactionManager().commit();
  assertFalse(s.isOpen());
  assertEquals(sessionFactory().getStatistics().getTransactionCount(),4);
  assertEquals(sessionFactory().getStatistics().getSuccessfulTransactionCount(),3);
  assertEquals(sessionFactory().getStatistics().getEntityDeleteCount(),1);
  assertEquals(sessionFactory().getStatistics().getEntityInsertCount(),1);
  assertEquals(sessionFactory().getStatistics().getSessionOpenCount(),4);
  assertEquals(sessionFactory().getStatistics().getSessionCloseCount(),4);
  assertEquals(sessionFactory().getStatistics().getQueryExecutionCount(),1);
  assertEquals(sessionFactory().getStatistics().getFlushCount(),2);
  TestingJtaBootstrap.INSTANCE.getTransactionManager().begin();
  s=openSession();
  s.createQuery("delete from Item").executeUpdate();
  TestingJtaBootstrap.INSTANCE.getTransactionManager().commit();
}
