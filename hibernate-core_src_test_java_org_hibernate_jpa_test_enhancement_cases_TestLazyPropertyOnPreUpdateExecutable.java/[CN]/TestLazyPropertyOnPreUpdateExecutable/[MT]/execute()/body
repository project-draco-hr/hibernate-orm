{
  EntityWithLazyProperty entity;
  EntityManager em=getOrCreateEntityManager();
  byte[] testArray=new byte[]{0x2A};
  em.getTransaction().begin();
  entity=new EntityWithLazyProperty();
  entity.setSomeField("TEST");
  entity.setLazyData(testArray);
  em.persist(entity);
  em.getTransaction().commit();
  em.close();
  checkLazyField(entity,em,testArray);
  em=getOrCreateEntityManager();
  em.getTransaction().begin();
  entity=em.find(EntityWithLazyProperty.class,entity.getId());
  entity.setSomeField("TEST1");
  assertFalse(Hibernate.isPropertyInitialized(entity,"lazyData"));
  em.getTransaction().commit();
  assertFalse(Hibernate.isPropertyInitialized(entity,"lazyData"));
  em.close();
  checkLazyField(entity,em,testArray);
  em=getOrCreateEntityManager();
  em.getTransaction().begin();
  entity=em.find(EntityWithLazyProperty.class,entity.getId());
  entity.setUpdateLazyFieldInPreUpdate(true);
  entity.setSomeField("TEST2");
  assertFalse(Hibernate.isPropertyInitialized(entity,"lazyData"));
  em.getTransaction().commit();
  assertTrue(Hibernate.isPropertyInitialized(entity,"lazyData"));
  em.close();
  checkLazyField(entity,em,EntityWithLazyProperty.PRE_UPDATE_VALUE);
  em=getOrCreateEntityManager();
  em.getTransaction().begin();
  entity=em.find(EntityWithLazyProperty.class,entity.getId());
  entity.setUpdateLazyFieldInPreUpdate(true);
  assertFalse(Hibernate.isPropertyInitialized(entity,"lazyData"));
  entity.setLazyData(testArray);
  assertTrue(Hibernate.isPropertyInitialized(entity,"lazyData"));
  entity.setSomeField("TEST3");
  em.getTransaction().commit();
  em.close();
  checkLazyField(entity,em,EntityWithLazyProperty.PRE_UPDATE_VALUE);
}
