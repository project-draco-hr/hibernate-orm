{
  sessionFactory().getStatistics().clear();
  Thread.sleep(1);
  Customer customer=createCustomer(0);
  final Integer customerId=customer.getId();
  getCustomerIDs().add(customerId);
  Thread.sleep(1);
  assertNull("contact exists despite not being added",getFirstContact(customerId));
  SecondLevelCacheStatistics customerSlcs=sessionFactory().getStatistics().getSecondLevelCacheStatistics(Customer.class.getName());
  assertEquals(1,customerSlcs.getPutCount());
  assertEquals(1,customerSlcs.getElementCountInMemory());
  assertEquals(1,customerSlcs.getEntries().size());
  log.infof("Add contact to customer {0}",customerId);
  SecondLevelCacheStatistics contactsCollectionSlcs=sessionFactory().getStatistics().getSecondLevelCacheStatistics(Customer.class.getName() + ".contacts");
  assertEquals(1,contactsCollectionSlcs.getPutCount());
  assertEquals(1,contactsCollectionSlcs.getElementCountInMemory());
  assertEquals(1,contactsCollectionSlcs.getEntries().size());
  final Contact contact=addContact(customerId);
  assertNotNull("contact returned by addContact is null",contact);
  assertEquals("Customer.contacts cache was not invalidated afterQuery addContact",0,contactsCollectionSlcs.getElementCountInMemory());
  assertNotNull("Contact missing afterQuery successful add call",getFirstContact(customerId));
  readEveryonesFirstContact();
  removeContact(customerId);
  assertNull("contact still exists afterQuery successful remove call",getFirstContact(customerId));
}
