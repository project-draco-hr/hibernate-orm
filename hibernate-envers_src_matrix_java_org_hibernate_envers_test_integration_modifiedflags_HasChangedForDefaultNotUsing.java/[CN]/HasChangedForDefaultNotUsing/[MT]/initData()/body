{
  PartialModifiedFlagsEntity entity=new PartialModifiedFlagsEntity(entityId);
  EntityManager em=getEntityManager();
  em.getTransaction().begin();
  em.persist(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.setData("data1");
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.setComp1(new Component1("str1","str2"));
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.setComp2(new Component2("str1","str2"));
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  WithModifiedFlagReferencingEntity withModifiedFlagReferencingEntity=new WithModifiedFlagReferencingEntity(refEntityId,"first");
  withModifiedFlagReferencingEntity.setReference(entity);
  em.persist(withModifiedFlagReferencingEntity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  withModifiedFlagReferencingEntity=em.find(WithModifiedFlagReferencingEntity.class,refEntityId);
  withModifiedFlagReferencingEntity.setReference(null);
  withModifiedFlagReferencingEntity.setSecondReference(entity);
  em.merge(withModifiedFlagReferencingEntity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.getStringSet().add("firstElement");
  entity.getStringSet().add("secondElement");
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.getStringSet().remove("secondElement");
  entity.getStringMap().put("someKey","someValue");
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  StrTestEntity strTestEntity=new StrTestEntity("first");
  em.persist(strTestEntity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.getEntitiesSet().add(strTestEntity);
  entity=em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  entity.getEntitiesSet().remove(strTestEntity);
  entity.getEntitiesMap().put("someKey",strTestEntity);
  em.merge(entity);
  em.getTransaction().commit();
  em.getTransaction().begin();
  strTestEntity.setStr("second");
  em.merge(strTestEntity);
  em.getTransaction().commit();
}
