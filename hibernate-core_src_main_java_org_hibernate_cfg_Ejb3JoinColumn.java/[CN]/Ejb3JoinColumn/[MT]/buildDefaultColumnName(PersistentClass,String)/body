{
  String columnName;
  boolean mappedBySide=mappedByTableName != null || mappedByPropertyName != null;
  boolean ownerSide=getPropertyName() != null;
  Boolean isRefColumnQuoted=StringHelper.isQuoted(logicalReferencedColumn);
  String unquotedLogicalReferenceColumn=isRefColumnQuoted ? StringHelper.unquote(logicalReferencedColumn) : logicalReferencedColumn;
  if (mappedBySide) {
    String unquotedMappedbyTable=StringHelper.unquote(mappedByTableName);
    if (JPA2ElementCollection) {
      columnName=getNamingStrategyDelegate().determineElementCollectionForeignKeyColumnName(mappedByPropertyName,mappedByEntityName,mappedByJpaEntityName,unquotedMappedbyTable,unquotedLogicalReferenceColumn);
    }
 else {
      columnName=getNamingStrategyDelegate().determineEntityAssociationForeignKeyColumnName(mappedByPropertyName,mappedByEntityName,mappedByJpaEntityName,unquotedMappedbyTable,unquotedLogicalReferenceColumn);
    }
    if (isRefColumnQuoted || StringHelper.isQuoted(mappedByTableName)) {
      columnName=StringHelper.quote(columnName);
    }
  }
 else   if (ownerSide) {
    String logicalTableName=getMappings().getLogicalTableName(referencedEntity.getTable());
    String unquotedLogicalTableName=StringHelper.unquote(logicalTableName);
    columnName=getNamingStrategyDelegate().determineEntityAssociationForeignKeyColumnName(getPropertyName(),referencedEntity.getEntityName(),referencedEntity.getJpaEntityName(),unquotedLogicalTableName,unquotedLogicalReferenceColumn);
    if (isRefColumnQuoted || StringHelper.isQuoted(logicalTableName)) {
      columnName=StringHelper.quote(columnName);
    }
  }
 else {
    String logicalTableName=getMappings().getLogicalTableName(referencedEntity.getTable());
    String unquotedLogicalTableName=StringHelper.unquote(logicalTableName);
    columnName=getNamingStrategyDelegate().determineJoinKeyColumnName(unquotedLogicalReferenceColumn,unquotedLogicalTableName);
    if (isRefColumnQuoted || StringHelper.isQuoted(logicalTableName)) {
      columnName=StringHelper.quote(columnName);
    }
  }
  return columnName;
}
