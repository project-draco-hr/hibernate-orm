{
  StandardServiceRegistry ssr=new StandardServiceRegistryBuilder().applySetting(Environment.HBM2DDL_AUTO,"none").build();
  try {
    File output=File.createTempFile("update_script",".sql");
    output.deleteOnExit();
    final MetadataImplementor metadata=(MetadataImplementor)new MetadataSources(ssr).addAnnotatedClass(TestEntity.class).buildMetadata();
    metadata.validate();
    SchemaUpdate su=new SchemaUpdate(ssr,metadata);
    su.setHaltOnError(true);
    su.setOutputFile(output.getAbsolutePath());
    su.setDelimiter(EXPECTED_DELIMITER);
    su.setFormat(false);
    su.execute(Target.SCRIPT);
    List<String> sqlLines=Files.readAllLines(output.toPath(),Charset.defaultCharset());
    for (    String line : sqlLines) {
      assertThat("The expected delimiter is not applied " + line,line.endsWith(EXPECTED_DELIMITER),is(true));
    }
  }
  finally {
    StandardServiceRegistryBuilder.destroy(ssr);
  }
}
