{
  String version=null;
  try {
    final File javaCommand=getJavaExecutable();
    Process javaProcess=Runtime.getRuntime().exec(javaCommand.getAbsolutePath() + " -version");
    try {
      version=extractVersion(new BufferedReader(new InputStreamReader(javaProcess.getErrorStream())));
      if (version == null || version.equals("")) {
        version=extractVersion(new BufferedReader(new InputStreamReader(javaProcess.getInputStream())));
      }
    }
  finally {
      javaProcess.destroy();
    }
  }
 catch (  IOException e) {
    throw new RuntimeException("Unable to determine Java version",e);
  }
  return version;
}
