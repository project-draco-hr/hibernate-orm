{
  Session s=openSession();
  s.getTransaction().begin();
  Child c1=new Child("Darwin");
  s.persist(c1);
  Child c2=new Child("Comet");
  s.persist(c2);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.getTransaction().begin();
  Parent p=s.get(Parent.class,parentId);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  p.addChild(c1);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.getTransaction().begin();
  p=s.get(Parent.class,parentId);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  assertEquals(3,p.getChildren().size());
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.getTransaction().begin();
  p=s.get(Parent.class,parentId);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  p.addChild(c2);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  s.merge(p);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.getTransaction().begin();
  p=s.get(Parent.class,parentId);
  assertFalse(Hibernate.isInitialized(p.getChildren()));
  assertEquals(4,p.getChildren().size());
  s.getTransaction().commit();
  s.close();
}
