{
  SqlServerGeometry nativeGeom=new SqlServerGeometry();
  int srid=geom.getSRID();
  nativeGeom.setSrid(srid < 0 ? 0 : srid);
  nativeGeom.setIsValid();
  if (geom.isMeasured()) {
    nativeGeom.setHasMValues();
  }
  CountingPointSequenceBuilder coordinates=new CountingPointSequenceBuilder(geom.getDimensionalFlag());
  List<Figure> figures=new ArrayList<Figure>();
  List<Shape> shapes=new ArrayList<Shape>();
  encode(geom,-1,coordinates,figures,shapes);
  encodePoints(nativeGeom,coordinates.toPointSequence());
  encodeFigures(nativeGeom,figures);
  encodeShapes(nativeGeom,shapes);
  return nativeGeom;
}
