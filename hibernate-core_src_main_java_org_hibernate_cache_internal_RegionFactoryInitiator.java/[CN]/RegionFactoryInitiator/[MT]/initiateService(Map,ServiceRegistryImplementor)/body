{
  final Object impl=configurationValues.get(IMPL_NAME);
  if (impl == null) {
    return new NoCachingRegionFactory();
  }
  if (getServiceInitiated().isInstance(impl)) {
    return (RegionFactory)impl;
  }
  Class<? extends RegionFactory> customImplClass=null;
  if (Class.class.isInstance(impl)) {
    customImplClass=(Class<? extends RegionFactory>)impl;
  }
 else {
    customImplClass=registry.getService(ClassLoaderService.class).classForName(impl.toString());
  }
  try {
    return customImplClass.newInstance();
  }
 catch (  Exception e) {
    throw new ServiceException("Could not initialize custom RegionFactory impl [" + customImplClass.getName() + "]",e);
  }
}
