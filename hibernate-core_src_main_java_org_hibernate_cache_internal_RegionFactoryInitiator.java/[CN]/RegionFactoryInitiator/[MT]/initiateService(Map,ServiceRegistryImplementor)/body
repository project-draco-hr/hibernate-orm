{
  final Properties p=new Properties();
  if (configurationValues != null) {
    p.putAll(configurationValues);
  }
  final boolean useSecondLevelCache=ConfigurationHelper.getBoolean(AvailableSettings.USE_SECOND_LEVEL_CACHE,configurationValues,true);
  final boolean useQueryCache=ConfigurationHelper.getBoolean(AvailableSettings.USE_QUERY_CACHE,configurationValues);
  RegionFactory regionFactory=NoCachingRegionFactory.INSTANCE;
  if (useSecondLevelCache || useQueryCache) {
    final Object setting=configurationValues != null ? configurationValues.get(AvailableSettings.CACHE_REGION_FACTORY) : null;
    regionFactory=registry.getService(StrategySelector.class).resolveStrategy(RegionFactory.class,setting,NoCachingRegionFactory.INSTANCE,new StrategyCreatorRegionFactoryImpl(p));
  }
  LOG.debugf("Cache region factory : %s",regionFactory.getClass().getName());
  return regionFactory;
}
