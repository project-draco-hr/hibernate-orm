{
  userTransaction.begin();
  entityManager.joinTransaction();
  AuditedEntity entity=new AuditedEntity(1,"Marco Polo");
  entityManager.persist(entity);
  userTransaction.commit();
  userTransaction.begin();
  entityManager.joinTransaction();
  entity.setName("George Washington");
  entityManager.merge(entity);
  userTransaction.commit();
  entityManager.clear();
  userTransaction.begin();
  final AuditReader auditReader=AuditReaderFactory.get(entityManager);
  assertEquals(Arrays.asList(1,2),auditReader.getRevisions(AuditedEntity.class,1));
  userTransaction.commit();
}
