{
  final EntityPersister persister=getPersister();
  if (persister.hasCache()) {
    final CacheKey ck=getSession().generateCacheKey(getId(),persister.getIdentifierType(),persister.getRootEntityName());
    if (success && cacheEntry != null) {
      final boolean put=persister.getCacheAccessStrategy().afterUpdate(ck,cacheEntry,nextVersion,previousVersion,lock);
      if (put && getSession().getFactory().getStatistics().isStatisticsEnabled()) {
        getSession().getFactory().getStatisticsImplementor().secondLevelCachePut(getPersister().getCacheAccessStrategy().getRegion().getName());
      }
    }
 else {
      persister.getCacheAccessStrategy().unlockItem(ck,lock);
    }
  }
  postCommitUpdate();
}
