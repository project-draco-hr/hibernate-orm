{
  Item item=new Item("chris","Chris's Item");
  Item another=new Item("another","Owned Item");
  item.addItem(another);
  Session s=null;
  try {
    s=openSession();
    s.beginTransaction();
    s.persist(item);
    s.persist(another);
    s.getTransaction().commit();
  }
 catch (  Exception e) {
    log.error("Exception",e);
    s.getTransaction().rollback();
    throw e;
  }
 finally {
    s.close();
  }
  try {
    s=openSession();
    s.beginTransaction();
    Item loaded=(Item)s.load(Item.class,item.getId());
    assertEquals(1,loaded.getItems().size());
  }
 catch (  Exception e) {
    log.error("Exception",e);
    s.getTransaction().rollback();
    throw e;
  }
 finally {
    s.close();
  }
  try {
    s=openSession();
    s.beginTransaction();
    Statistics stats=s.getSessionFactory().getStatistics();
    SecondLevelCacheStatistics cStats=stats.getSecondLevelCacheStatistics(Item.class.getName() + ".items");
    Item loadedWithCachedCollection=(Item)s.load(Item.class,item.getId());
    stats.logSummary();
    assertEquals(item.getName(),loadedWithCachedCollection.getName());
    assertEquals(item.getItems().size(),loadedWithCachedCollection.getItems().size());
    assertEquals(1,cStats.getHitCount());
    Map cacheEntries=cStats.getEntries();
    assertEquals(1,cacheEntries.size());
  }
 catch (  Exception e) {
    log.error("Exception",e);
    s.getTransaction().rollback();
    throw e;
  }
 finally {
    s.close();
  }
}
