{
  TypeOverrides regionOverride=typeOverrides.get(regionName);
  if (!definedConfigurations.contains(regionName)) {
    final String templateCacheName;
    final ConfigurationBuilder builder=new ConfigurationBuilder();
    if (regionOverride != null) {
      if (log.isDebugEnabled()) {
        log.debug("Cache region specific configuration exists: " + regionOverride);
      }
      final String cacheName=regionOverride.getCacheName();
      if (cacheName != null) {
        templateCacheName=cacheName;
      }
 else {
        templateCacheName=typeOverrides.get(typeKey).getCacheName();
      }
      applyConfiguration(templateCacheName,builder);
      regionOverride=overrideStatisticsIfPresent(regionOverride,properties);
      regionOverride.applyTo(builder);
    }
 else {
      templateCacheName=typeOverrides.get(typeKey).getCacheName();
      builder.read(manager.getCacheConfiguration(templateCacheName));
      typeOverrides.get(typeKey).applyTo(builder);
    }
    if (settings.getMultiTenancyStrategy() == MultiTenancyStrategy.NONE) {
      if (metadata != null && metadata.getKeyType() != null) {
        builder.dataContainer().keyEquivalence(new TypeEquivalance(metadata.getKeyType()));
      }
    }
    configureTransactionManager(builder,templateCacheName,properties);
    manager.defineConfiguration(regionName,builder.build());
    definedConfigurations.add(regionName);
  }
  final AdvancedCache cache=manager.getCache(regionName).getAdvancedCache();
  if (!cache.getStatus().allowInvocations()) {
    cache.start();
  }
  return createCacheWrapper(cache);
}
