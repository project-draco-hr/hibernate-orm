{
  if (properties == null) {
    properties=new HashMap();
  }
  properties.put(AvailableSettings.JTA_PLATFORM,osgiJtaPlatform);
  final List<Integrator> integrators=OsgiServiceUtil.getServiceImpls(Integrator.class,context);
  IntegratorProvider integratorProvider=new IntegratorProvider(){
    @Override public List<Integrator> getIntegrators(){
      return integrators;
    }
  }
;
  properties.put(EntityManagerFactoryBuilderImpl.INTEGRATOR_PROVIDER,integratorProvider);
  final List<StrategyRegistrationProvider> strategyRegistrationProviders=OsgiServiceUtil.getServiceImpls(StrategyRegistrationProvider.class,context);
  StrategyRegistrationProviderList strategyRegistrationProviderList=new StrategyRegistrationProviderList(){
    @Override public List<StrategyRegistrationProvider> getStrategyRegistrationProviders(){
      return strategyRegistrationProviders;
    }
  }
;
  properties.put(EntityManagerFactoryBuilderImpl.STRATEGY_REGISTRATION_PROVIDERS,strategyRegistrationProviderList);
  return properties;
}
