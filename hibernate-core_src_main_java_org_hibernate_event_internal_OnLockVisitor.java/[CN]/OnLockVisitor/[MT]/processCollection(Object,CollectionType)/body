{
  if (collection == null) {
    return null;
  }
  final SessionImplementor session=getSession();
  final CollectionPersister persister=session.getFactory().getCollectionPersister(type.getRole());
  if (collection instanceof PersistentCollection) {
    final PersistentCollection persistentCollection=(PersistentCollection)collection;
    if (persistentCollection.setCurrentSession(session)) {
      if (isOwnerUnchanged(persistentCollection,persister,extractCollectionKeyFromOwner(persister))) {
        if (persistentCollection.isDirty()) {
          throw new HibernateException("reassociated object has dirty collection");
        }
        reattachCollection(persistentCollection,type);
      }
 else {
        throw new HibernateException("reassociated object has dirty collection reference");
      }
    }
 else {
      throw new HibernateException("reassociated object has dirty collection reference");
    }
  }
 else {
    throw new HibernateException("reassociated object has dirty collection reference (or an array)");
  }
  return null;
}
