{
  PendingPut pendingPut=new PendingPut(getOwnerForPut());
  PendingPutMap pendingForKey=new PendingPutMap(pendingPut);
  for (; ; ) {
    PendingPutMap existing=pendingPuts.putIfAbsent(key,pendingForKey);
    if (existing != null) {
      if (existing.acquireLock(10,TimeUnit.SECONDS)) {
        try {
          existing.put(pendingPut);
          PendingPutMap doublecheck=pendingPuts.putIfAbsent(key,existing);
          if (doublecheck == null || doublecheck == existing) {
            break;
          }
        }
  finally {
          existing.releaseLock();
        }
      }
 else {
        break;
      }
    }
 else {
      break;
    }
  }
}
