{
  final Object strategy=configurationValues.get(Environment.TRANSACTION_STRATEGY);
  if (TransactionFactory.class.isInstance(strategy)) {
    return (TransactionFactory)strategy;
  }
  if (strategy == null) {
    LOG.usingDefaultTransactionStrategy();
    return new JdbcTransactionFactory();
  }
  final String strategyClassName=mapLegacyNames(strategy.toString());
  LOG.transactionStrategy(strategyClassName);
  ClassLoaderService classLoaderService=registry.getService(ClassLoaderService.class);
  try {
    return (TransactionFactory)classLoaderService.classForName(strategyClassName).newInstance();
  }
 catch (  Exception e) {
    throw new HibernateException("Unable to instantiate specified TransactionFactory class [" + strategyClassName + "]",e);
  }
}
