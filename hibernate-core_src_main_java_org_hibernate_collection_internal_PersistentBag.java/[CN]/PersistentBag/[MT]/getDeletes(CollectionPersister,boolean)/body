{
  final Type elementType=persister.getElementType();
  final ArrayList deletes=new ArrayList();
  final List sn=(List)getSnapshot();
  final Iterator olditer=sn.iterator();
  int i=0;
  while (olditer.hasNext()) {
    final Object old=olditer.next();
    final Iterator newiter=bag.iterator();
    boolean found=false;
    if (bag.size() > i && elementType.isSame(old,bag.get(i++))) {
      found=true;
    }
 else {
      while (newiter.hasNext()) {
        if (elementType.isSame(old,newiter.next())) {
          found=true;
          break;
        }
      }
    }
    if (!found) {
      deletes.add(old);
    }
  }
  return deletes.iterator();
}
