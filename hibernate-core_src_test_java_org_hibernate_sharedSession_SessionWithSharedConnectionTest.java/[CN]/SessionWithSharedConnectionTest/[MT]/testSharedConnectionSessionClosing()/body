{
  Session session=sessionFactory().openSession();
  session.getTransaction().begin();
  Session secondSession=session.sessionWithOptions().connection().openSession();
  secondSession.createCriteria(IrrelevantEntity.class).list();
  assertFalse(((SessionImplementor)secondSession).getTransactionCoordinator().getJdbcCoordinator().getLogicalConnection().getResourceRegistry().hasRegisteredResources());
  secondSession.close();
  session.getTransaction().commit();
  session.close();
}
