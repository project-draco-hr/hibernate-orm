{
  Session session=sessionFactory().openSession();
  session.getTransaction().begin();
  Session secondSession=session.sessionWithOptions().connection().autoClose(true).openSession();
  secondSession.createCriteria(IrrelevantEntity.class).list();
  assertFalse(((SessionImplementor)secondSession).getTransactionCoordinator().getJdbcCoordinator().getLogicalConnection().getResourceRegistry().hasRegisteredResources());
  session.getTransaction().commit();
  assertTrue(((SessionImplementor)session).isClosed());
  assertTrue(((SessionImplementor)secondSession).isClosed());
}
