{
  Session session=sessionFactory().openSession();
  session.setJdbcBatchSize(3);
  session.beginTransaction();
  try {
    addEvents(session);
  }
  finally {
    connectionProvider.clear();
    session.getTransaction().commit();
    session.close();
  }
  JdbcStatisticsConnectionProvider.PreparedStatementStatistics statementStatistics=connectionProvider.getPreparedStatementStatistics().get("insert into Event (name, id) values (?, ?)");
  assertEquals(5,statementStatistics.getAddBatchCount());
  assertEquals(2,statementStatistics.getExecuteBatchCount());
  session=sessionFactory().openSession();
  session.setJdbcBatchSize(null);
  session.beginTransaction();
  try {
    addEvents(session);
  }
  finally {
    connectionProvider.clear();
    session.getTransaction().commit();
    session.close();
  }
  statementStatistics=connectionProvider.getPreparedStatementStatistics().get("insert into Event (name, id) values (?, ?)");
  assertEquals(5,statementStatistics.getAddBatchCount());
  assertEquals(3,statementStatistics.getExecuteBatchCount());
}
