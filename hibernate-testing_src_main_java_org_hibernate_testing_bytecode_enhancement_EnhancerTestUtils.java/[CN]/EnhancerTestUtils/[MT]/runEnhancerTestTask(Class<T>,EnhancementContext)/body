{
  EnhancerTestTask taskObject=null;
  ClassLoader defaultCL=Thread.currentThread().getContextClassLoader();
  try {
    ClassLoader cl=EnhancerTestUtils.getEnhancerClassLoader(context,task.getPackage().getName());
    EnhancerTestUtils.setupClassLoader(cl,task);
    EnhancerTestUtils.setupClassLoader(cl,task.newInstance().getAnnotatedClasses());
    Thread.currentThread().setContextClassLoader(cl);
    taskObject=cl.loadClass(task.getName()).asSubclass(EnhancerTestTask.class).newInstance();
    taskObject.prepare();
    taskObject.execute();
  }
 catch (  Exception e) {
    throw new HibernateException("could not execute task",e);
  }
 finally {
    try {
      if (taskObject != null) {
        taskObject.complete();
      }
    }
 catch (    Throwable ignore) {
    }
    Thread.currentThread().setContextClassLoader(defaultCL);
  }
}
