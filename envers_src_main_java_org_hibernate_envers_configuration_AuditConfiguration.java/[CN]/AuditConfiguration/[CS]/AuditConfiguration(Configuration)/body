{
  Properties properties=cfg.getProperties();
  ReflectionManager reflectionManager=cfg.getReflectionManager();
  RevisionInfoConfiguration revInfoCfg=new RevisionInfoConfiguration();
  RevisionInfoConfigurationResult revInfoCfgResult=revInfoCfg.configure(cfg,reflectionManager);
  auditEntCfg=new AuditEntitiesConfiguration(properties,revInfoCfgResult.getRevisionInfoEntityName());
  globalCfg=new GlobalConfiguration(properties);
  auditProcessManager=new AuditProcessManager(revInfoCfgResult.getRevisionInfoGenerator());
  try {
    Class auditStrategyClass=Thread.currentThread().getContextClassLoader().loadClass(auditEntCfg.getAuditStrategyName());
    auditStrategy=(AuditStrategy)auditStrategyClass.newInstance();
  }
 catch (  Exception e) {
    throw new MappingException(String.format("Unable to create AuditStrategy[%s] instance.",auditEntCfg.getAuditStrategyName()));
  }
  revisionInfoQueryCreator=revInfoCfgResult.getRevisionInfoQueryCreator();
  revisionInfoNumberReader=revInfoCfgResult.getRevisionInfoNumberReader();
  entCfg=new EntitiesConfigurator().configure(cfg,reflectionManager,globalCfg,auditEntCfg,auditStrategy,revInfoCfgResult.getRevisionInfoXmlMapping(),revInfoCfgResult.getRevisionInfoRelationMapping());
}
