{
  assertEmptyCaches();
  assertTrue(remoteListener.isEmpty());
  assertTrue(localListener.isEmpty());
  log.debug("Create node 0");
  IdContainer ids=createCustomer(localFactory);
  assertTrue(remoteListener.isEmpty());
  assertTrue(localListener.isEmpty());
  sleep(SLEEP_TIME);
  log.debug("Find node 0");
  getCustomer(ids.customerId,localFactory);
  sleep(SLEEP_TIME);
  log.debug("Find(2) node 0");
  localListener.clear();
  getCustomer(ids.customerId,localFactory);
  log.debug("Check cache 0");
  assertLoadedFromCache(localListener,ids.customerId,ids.contactIds);
  log.debug("Find node 1");
  getCustomer(ids.customerId,remoteFactory);
  log.debug("Find(2) node 1");
  remoteListener.clear();
  getCustomer(ids.customerId,remoteFactory);
  log.debug("Check cache 1");
  assertLoadedFromCache(remoteListener,ids.customerId,ids.contactIds);
  remoteListener.clear();
  ids=modifyCustomer(ids.customerId,remoteFactory);
  sleep(250);
  assertLoadedFromCache(remoteListener,ids.customerId,ids.contactIds);
  assertEquals(0,localCollectionCache.size());
  if (localCustomerCache.getCacheConfiguration().clustering().cacheMode().isInvalidation()) {
    assertEquals(0,localCustomerCache.size());
  }
 else {
    assertEquals(1,localCustomerCache.size());
  }
}
