{
  try {
    TestingJtaPlatformImpl.INSTANCE.getTransactionManager().begin();
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to being JTA transaction prior to starting test",e);
  }
  final Transaction jtaTransaction;
  try {
    jtaTransaction=TestingJtaPlatformImpl.INSTANCE.getTransactionManager().getTransaction();
  }
 catch (  SystemException e) {
    throw new RuntimeException("Unable to access JTA Transaction prior to starting test",e);
  }
  try {
    final StandardServiceRegistry registry=buildJtaStandardServiceRegistry();
    final SchemaManagementTool smt=registry.getService(SchemaManagementTool.class);
    final SchemaDropper schemaDropper=smt.getSchemaDropper(Collections.emptyMap());
    final SchemaCreator schemaCreator=smt.getSchemaCreator(Collections.emptyMap());
    final Metadata mappings=buildMappings(registry);
    try {
      schemaDropper.doDrop(mappings,ExecutionOptionsTestImpl.INSTANCE,SourceDescriptorImpl.INSTANCE,TargetDescriptorImpl.INSTANCE);
      schemaCreator.doCreation(mappings,ExecutionOptionsTestImpl.INSTANCE,SourceDescriptorImpl.INSTANCE,TargetDescriptorImpl.INSTANCE);
    }
  finally {
      try {
        schemaDropper.doDrop(mappings,ExecutionOptionsTestImpl.INSTANCE,SourceDescriptorImpl.INSTANCE,TargetDescriptorImpl.INSTANCE);
      }
 catch (      Exception ignore) {
      }
    }
  }
  finally {
    try {
      jtaTransaction.commit();
    }
 catch (    Exception e) {
    }
  }
}
