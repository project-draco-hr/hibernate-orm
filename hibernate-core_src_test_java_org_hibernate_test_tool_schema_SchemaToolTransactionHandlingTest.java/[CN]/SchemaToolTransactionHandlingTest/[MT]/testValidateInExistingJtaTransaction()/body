{
  try {
    TestingJtaPlatformImpl.INSTANCE.getTransactionManager().begin();
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to being JTA transaction prior to starting test",e);
  }
  final Transaction jtaTransaction;
  try {
    jtaTransaction=TestingJtaPlatformImpl.INSTANCE.getTransactionManager().getTransaction();
  }
 catch (  SystemException e) {
    throw new RuntimeException("Unable to access JTA Transaction prior to starting test",e);
  }
  try {
    final StandardServiceRegistry registry=buildJtaStandardServiceRegistry();
    final SchemaManagementTool smt=registry.getService(SchemaManagementTool.class);
    final Metadata mappings=buildMappings(registry);
    try {
      smt.getSchemaCreator(Collections.emptyMap()).doCreation(mappings,ExecutionOptionsTestImpl.INSTANCE,SourceDescriptorImpl.INSTANCE,TargetDescriptorImpl.INSTANCE);
    }
 catch (    Exception e) {
      throw new RuntimeException("Unable to create schema to validation tests",e);
    }
    try {
      smt.getSchemaValidator(Collections.emptyMap()).doValidation(mappings,ExecutionOptionsTestImpl.INSTANCE);
    }
  finally {
      try {
        smt.getSchemaDropper(Collections.emptyMap()).doDrop(mappings,ExecutionOptionsTestImpl.INSTANCE,SourceDescriptorImpl.INSTANCE,TargetDescriptorImpl.INSTANCE);
      }
 catch (      Exception ignore) {
      }
    }
  }
  finally {
    try {
      jtaTransaction.commit();
    }
 catch (    Exception e) {
    }
  }
}
