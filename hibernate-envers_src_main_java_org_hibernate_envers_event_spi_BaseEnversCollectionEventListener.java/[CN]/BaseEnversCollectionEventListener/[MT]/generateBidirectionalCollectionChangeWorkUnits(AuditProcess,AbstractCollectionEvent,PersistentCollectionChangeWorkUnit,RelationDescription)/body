{
  if (!getAuditConfiguration().getGlobalCfg().isGenerateRevisionsForCollections()) {
    return;
  }
  if (rd != null && rd.isBidirectional()) {
    final String relatedEntityName=rd.getToEntityName();
    final IdMapper relatedIdMapper=getAuditConfiguration().getEntCfg().get(relatedEntityName).getIdMapper();
    final Set<String> toPropertyNames=getAuditConfiguration().getEntCfg().getToPropertyNames(event.getAffectedOwnerEntityName(),rd.getFromPropertyName(),relatedEntityName);
    final String toPropertyName=toPropertyNames.iterator().next();
    for (    PersistentCollectionChangeData changeData : workUnit.getCollectionChanges()) {
      final Object relatedObj=changeData.getChangedElement();
      final Serializable relatedId=(Serializable)relatedIdMapper.mapToIdFromEntity(relatedObj);
      auditProcess.addWorkUnit(new CollectionChangeWorkUnit(event.getSession(),event.getSession().bestGuessEntityName(relatedObj),toPropertyName,getAuditConfiguration(),relatedId,relatedObj));
    }
  }
}
