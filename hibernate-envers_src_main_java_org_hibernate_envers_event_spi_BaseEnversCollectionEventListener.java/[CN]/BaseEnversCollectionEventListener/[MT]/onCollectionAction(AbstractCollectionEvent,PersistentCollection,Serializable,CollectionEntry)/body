{
  if (shouldGenerateRevision(event)) {
    checkIfTransactionInProgress(event.getSession());
    final AuditProcess auditProcess=getEnversService().getAuditProcessManager().get(event.getSession());
    final String entityName=event.getAffectedOwnerEntityName();
    final String ownerEntityName=((AbstractCollectionPersister)collectionEntry.getLoadedPersister()).getOwnerEntityName();
    final String referencingPropertyName=collectionEntry.getRole().substring(ownerEntityName.length() + 1);
    final RelationDescription rd=searchForRelationDescription(entityName,referencingPropertyName);
    if (rd != null && rd.getMappedByPropertyName() != null) {
      generateFakeBidirecationalRelationWorkUnits(auditProcess,newColl,oldColl,entityName,referencingPropertyName,event,rd);
    }
 else {
      final PersistentCollectionChangeWorkUnit workUnit=new PersistentCollectionChangeWorkUnit(event.getSession(),entityName,getEnversService(),newColl,collectionEntry,oldColl,event.getAffectedOwnerIdOrNull(),referencingPropertyName);
      auditProcess.addWorkUnit(workUnit);
      if (workUnit.containsWork()) {
        auditProcess.addWorkUnit(new CollectionChangeWorkUnit(event.getSession(),event.getAffectedOwnerEntityName(),referencingPropertyName,getEnversService(),event.getAffectedOwnerIdOrNull(),event.getAffectedOwnerOrNull()));
        generateBidirectionalCollectionChangeWorkUnits(auditProcess,event,workUnit,rd);
      }
    }
  }
}
