{
  MetadataContext context=new MetadataContext(sessionFactory);
  while (persistentClasses.hasNext()) {
    locateOrBuildEntityType(persistentClasses.next(),context);
  }
  context.wrapUp();
  return new MetamodelImpl(context.getEntityTypeMap(),context.getEmbeddableTypeMap());
}
