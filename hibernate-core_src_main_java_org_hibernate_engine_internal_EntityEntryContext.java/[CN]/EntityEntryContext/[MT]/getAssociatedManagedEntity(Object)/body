{
  if (ManagedEntity.class.isInstance(entity)) {
    final ManagedEntity managedEntity=(ManagedEntity)entity;
    if (managedEntity.$$_hibernate_getEntityEntry() == null) {
      return null;
    }
    final AbstractEntityEntry entityEntry=(AbstractEntityEntry)managedEntity.$$_hibernate_getEntityEntry();
    if (entityEntry.getPersister().isMutable()) {
      return entityEntry.getPersistenceContext() == persistenceContext ? managedEntity : null;
    }
 else {
      return immutableManagedEntityXref != null ? immutableManagedEntityXref.get(managedEntity) : null;
    }
  }
 else {
    return nonEnhancedEntityXref != null ? nonEnhancedEntityXref.get(entity) : null;
  }
}
