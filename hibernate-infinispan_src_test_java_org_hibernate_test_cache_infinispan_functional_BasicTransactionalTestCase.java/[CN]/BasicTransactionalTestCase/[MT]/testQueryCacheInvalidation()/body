{
  Session s=null;
  Transaction t=null;
  Item i=null;
  beginTx();
  try {
    s=openSession();
    t=s.beginTransaction();
    i=new Item();
    i.setName("widget");
    i.setDescription("A really top-quality, full-featured widget.");
    s.persist(i);
    t.commit();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
  SecondLevelCacheStatistics slcs=s.getSessionFactory().getStatistics().getSecondLevelCacheStatistics(Item.class.getName());
  assertEquals(slcs.getPutCount(),1);
  assertEquals(slcs.getElementCountInMemory(),1);
  assertEquals(slcs.getEntries().size(),1);
  beginTx();
  try {
    s=openSession();
    t=s.beginTransaction();
    i=(Item)s.get(Item.class,i.getId());
    assertEquals(slcs.getHitCount(),1);
    assertEquals(slcs.getMissCount(),0);
    i.setDescription("A bog standard item");
    t.commit();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
  assertEquals(slcs.getPutCount(),2);
  CacheEntry entry=(CacheEntry)slcs.getEntries().get(i.getId());
  Serializable[] ser=entry.getDisassembledState();
  assertTrue(ser[0].equals("widget"));
  assertTrue(ser[1].equals("A bog standard item"));
  beginTx();
  try {
    s=openSession();
    t=s.beginTransaction();
    s.delete(i);
    t.commit();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
}
