{
  Session s;
  Item item=new Item("chris","Chris's Item");
  beginTx();
  try {
    s=openSession();
    s.getTransaction().begin();
    s.persist(item);
    s.getTransaction().commit();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
  Thread.sleep(100);
  beginTx();
  try {
    s=openSession();
    s.createQuery("from Item").setCacheable(true).list();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
  beginTx();
  try {
    s=openSession();
    Statistics stats=s.getSessionFactory().getStatistics();
    s.createQuery("from Item").setCacheable(true).list();
    assertEquals(1,stats.getQueryCacheHitCount());
    s.createQuery("delete from Item").executeUpdate();
    s.close();
  }
 catch (  Exception e) {
    setRollbackOnlyTx(e);
  }
 finally {
    commitOrRollbackTx();
  }
}
