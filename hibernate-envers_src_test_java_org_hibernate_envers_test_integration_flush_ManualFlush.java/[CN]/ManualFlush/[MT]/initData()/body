{
  EntityManager em=getEntityManager();
  em.getTransaction().begin();
  StrTestEntity fe=new StrTestEntity("x");
  em.persist(fe);
  em.getTransaction().commit();
  em.getTransaction().begin();
  fe=em.find(StrTestEntity.class,fe.getId());
  fe.setStr("y");
  em.getTransaction().commit();
  em.getTransaction().begin();
  fe=em.find(StrTestEntity.class,fe.getId());
  fe.setStr("z");
  em.flush();
  fe=em.find(StrTestEntity.class,fe.getId());
  fe.setStr("z2");
  em.getTransaction().commit();
  id=fe.getId();
}
