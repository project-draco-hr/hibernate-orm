{
  if (initialized) {
    throw new UnsupportedOperationException("EnversService#initialize should be called only once");
  }
  initialized=true;
  this.serviceRegistry=metadata.getMetadataBuildingOptions().getServiceRegistry();
  this.classLoaderService=serviceRegistry.getService(ClassLoaderService.class);
  classLoaderService.withTccl(new ClassLoaderService.Work<Void>(){
    @Override public Void perform(){
      doInitialize(metadata,mappingCollector,serviceRegistry,classLoaderService);
      return null;
    }
  }
);
}
