{
  config=new Configuration();
  if (createSchema()) {
    config.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
    config.setProperty(Environment.USE_NEW_ID_GENERATOR_MAPPINGS,"true");
    config.setProperty("org.hibernate.envers.use_enhanced_revision_entity","true");
  }
  String auditStrategy=getAuditStrategy();
  if (auditStrategy != null && !"".equals(auditStrategy)) {
    config.setProperty("org.hibernate.envers.audit_strategy",auditStrategy);
  }
  this.initMappings();
  serviceRegistry=ServiceRegistryBuilder.buildServiceRegistry(config.getProperties());
  sessionFactory=config.buildSessionFactory(serviceRegistry);
}
