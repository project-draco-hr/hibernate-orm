{
  Session s=openSession();
  s.beginTransaction();
  Bar bar=new Bar();
  s.save(bar);
  bar.setAbstracts(new HashSet());
  bar.getAbstracts().add(bar);
  Bar bar2=new Bar();
  bar.getAbstracts().add(bar2);
  bar.setFoo(bar);
  s.save(bar2);
  s.getTransaction().commit();
  s.close();
  bar.setAbstracts(null);
  s=openSession();
  s.beginTransaction();
  s.load(bar,bar.getKey());
  assertTrue("collection contains self",bar.getAbstracts().size() == 2 && bar.getAbstracts().contains(bar));
  assertTrue("association to self",bar.getFoo() == bar);
  for (  Object o : bar.getAbstracts()) {
    s.delete(o);
  }
  s.getTransaction().commit();
  s.close();
}
