{
  Configuration cacheConfig=cache.getConfiguration();
  TransactionManager cacheTm=cacheConfig.getRuntimeConfig().getTransactionManager();
  if (!safeEquals(tm,cacheTm)) {
    if (cache.getCacheStatus() != CacheStatus.INSTANTIATED) {
      if (!allowNull && cacheTm == null) {
        throw new CacheException("JBoss Cache is already started with no transaction manager configured");
      }
 else {
        log.debug("JBoss Cache is already started with a transaction manager (" + cacheTm + ") that is not equal to our own ("+ tm+ ")");
      }
    }
 else {
      cacheConfig.getRuntimeConfig().setTransactionManager(tm);
      if (tm == null) {
        cacheConfig.setTransactionManagerLookupClass(null);
      }
    }
  }
}
