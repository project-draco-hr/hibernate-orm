{
  Container cOrig=createContainer();
  Set expectedInitializedObjects=new HashSet(Arrays.asList(new Object[]{cOrig,cOrig.getNoProxyInfo(),cOrig.getProxyInfo(),cOrig.getNonLazyInfo(),cOrig.getNoProxyOwner(),cOrig.getProxyOwner(),cOrig.getNonLazyOwner(),cOrig.getLazyDataPoints().iterator().next(),cOrig.getNonLazyJoinDataPoints().iterator().next(),cOrig.getNonLazySelectDataPoints().iterator().next()}));
  Set expectedReadOnlyObjects=new HashSet();
  DataPoint lazyDataPointOrig=(DataPoint)cOrig.getLazyDataPoints().iterator().next();
  Session s=openSession();
  assertFalse(s.isDefaultReadOnly());
  s.setCacheMode(CacheMode.IGNORE);
  Transaction t=s.beginTransaction();
  s.save(cOrig);
  checkContainer(cOrig,expectedInitializedObjects,expectedReadOnlyObjects,s);
  s.setDefaultReadOnly(true);
  assertTrue(s.isDefaultReadOnly());
  checkContainer(cOrig,expectedInitializedObjects,expectedReadOnlyObjects,s);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  s.setDefaultReadOnly(true);
  Container c=(Container)s.get(Container.class,cOrig.getId());
  assertNotSame(cOrig,c);
  expectedInitializedObjects=new HashSet(Arrays.asList(new Object[]{c,c.getNonLazyInfo(),c.getNoProxyOwner(),c.getProxyOwner(),c.getNonLazyOwner(),c.getNonLazyJoinDataPoints().iterator().next(),c.getNonLazySelectDataPoints().iterator().next()}));
  expectedReadOnlyObjects=new HashSet(Arrays.asList(new Object[]{c,c.getNoProxyInfo(),c.getProxyInfo(),c.getNonLazyInfo(),c.getNoProxyOwner(),c.getProxyOwner(),c.getNonLazyOwner(),c.getNonLazyJoinDataPoints().iterator().next(),c.getNonLazySelectDataPoints().iterator().next()}));
  checkContainer(c,expectedInitializedObjects,expectedReadOnlyObjects,s);
  s.setDefaultReadOnly(false);
  checkContainer(c,expectedInitializedObjects,expectedReadOnlyObjects,s);
  assertFalse(Hibernate.isInitialized(c.getNoProxyInfo()));
  Hibernate.initialize(c.getNoProxyInfo());
  expectedInitializedObjects.add(c.getNoProxyInfo());
  checkContainer(c,expectedInitializedObjects,expectedReadOnlyObjects,s);
  assertFalse(Hibernate.isInitialized(c.getProxyInfo()));
  Hibernate.initialize(c.getProxyInfo());
  expectedInitializedObjects.add(c.getProxyInfo());
  checkContainer(c,expectedInitializedObjects,expectedReadOnlyObjects,s);
  s.setDefaultReadOnly(true);
  DataPoint lazyDataPoint=(DataPoint)s.load(DataPoint.class,lazyDataPointOrig.getId());
  s.setDefaultReadOnly(false);
  assertFalse(Hibernate.isInitialized(c.getLazyDataPoints()));
  Hibernate.initialize(c.getLazyDataPoints());
  assertSame(lazyDataPoint,c.getLazyDataPoints().iterator().next());
  expectedInitializedObjects.add(c.getLazyDataPoints().iterator().next());
  expectedReadOnlyObjects.add(lazyDataPoint);
  checkContainer(c,expectedInitializedObjects,expectedReadOnlyObjects,s);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  s.createQuery("delete from DataPoint").executeUpdate();
  s.createQuery("delete from Container").executeUpdate();
  s.createQuery("delete from Info").executeUpdate();
  s.createQuery("delete from Owner").executeUpdate();
  t.commit();
  s.close();
}
