{
  final Object scanner=properties.getProperty(AvailableSettings.SCANNER);
  if (scanner != null) {
    Class<?> scannerClass;
    if (scanner instanceof String) {
      try {
        scannerClass=ReflectHelper.classForName((String)scanner,this.getClass());
      }
 catch (      ClassNotFoundException e) {
        throw new PersistenceException("Cannot find scanner class. " + AvailableSettings.SCANNER + "="+ scanner,e);
      }
    }
 else     if (scanner instanceof Class) {
      scannerClass=(Class<? extends Scanner>)scanner;
    }
 else     if (scanner instanceof Scanner) {
      return (Scanner)scanner;
    }
 else {
      throw new PersistenceException("Scanner class configuration error: unknown type on the property. " + AvailableSettings.SCANNER);
    }
    try {
      return (Scanner)scannerClass.newInstance();
    }
 catch (    InstantiationException e) {
      throw new PersistenceException("Unable to load Scanner class: " + scannerClass,e);
    }
catch (    IllegalAccessException e) {
      throw new PersistenceException("Unable to load Scanner class: " + scannerClass,e);
    }
  }
 else {
    return new NativeScanner();
  }
}
