{
  boolean detectClasses=false;
  boolean detectHbm=false;
  String detectSetting=overridenProperties != null ? (String)overridenProperties.get(HibernatePersistence.AUTODETECTION) : null;
  detectSetting=detectSetting == null ? properties.getProperty(HibernatePersistence.AUTODETECTION) : detectSetting;
  if (detectSetting == null && excludeIfNotOverriden) {
    context.detectClasses(false).detectHbmFiles(false);
    return;
  }
  if (detectSetting == null) {
    detectSetting="class,hbm";
  }
  StringTokenizer st=new StringTokenizer(detectSetting,", ",false);
  while (st.hasMoreElements()) {
    String element=(String)st.nextElement();
    if ("class".equalsIgnoreCase(element))     detectClasses=true;
    if ("hbm".equalsIgnoreCase(element))     detectHbm=true;
  }
  log.debug("Detect class: {}; detect hbm: {}",detectClasses,detectHbm);
  context.detectClasses(detectClasses).detectHbmFiles(detectHbm);
}
