{
  try {
    Session s=openSession();
    s.beginTransaction();
    Parent p=new Parent("parent");
    Child c=new Child("child");
    c.setParent(p);
    s.save(c);
    try {
      s.getTransaction().commit();
      fail("expecting TransientObjectException on flush");
    }
 catch (    TransactionException te) {
      assertTrue(te.getCause() instanceof TransientObjectException);
      log.trace("handled expected exception",te);
      s.getTransaction().rollback();
    }
 finally {
      s.close();
    }
  }
  finally {
    cleanupData();
  }
}
