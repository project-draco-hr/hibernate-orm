{
  final EntityMode em=persister.getOwnerEntityPersister().getEntityMetamodel().getEntityMode();
  final CollectionKey collectionKey=new CollectionKey(persister,key,em);
  if (LOG.isTraceEnabled()) {
    LOG.tracev("Starting attempt to find loading collection [{0}]",MessageHelper.collectionInfoString(persister.getRole(),key));
  }
  final LoadingCollectionEntry loadingCollectionEntry=loadContexts.locateLoadingCollectionEntry(collectionKey);
  if (loadingCollectionEntry == null) {
    PersistentCollection collection=loadContexts.getPersistenceContext().getCollection(collectionKey);
    if (collection != null) {
      if (collection.wasInitialized()) {
        LOG.trace("Collection already initialized; ignoring");
        return null;
      }
      LOG.trace("Collection not yet initialized; initializing");
    }
 else {
      final Object owner=loadContexts.getPersistenceContext().getCollectionOwner(key,persister);
      final boolean newlySavedEntity=owner != null && loadContexts.getPersistenceContext().getEntry(owner).getStatus() != Status.LOADING;
      if (newlySavedEntity) {
        LOG.trace("Owning entity already loaded; ignoring");
        return null;
      }
      LOG.tracev("Instantiating new collection [key={0}, rs={1}]",key,resultSet);
      collection=persister.getCollectionType().instantiate(loadContexts.getPersistenceContext().getSession(),persister,key);
    }
    collection.beforeInitialize(persister,-1);
    collection.beginRead();
    localLoadingCollectionKeys.add(collectionKey);
    loadContexts.registerLoadingCollectionXRef(collectionKey,new LoadingCollectionEntry(resultSet,persister,key,collection));
    return collection;
  }
  if (loadingCollectionEntry.getResultSet() == resultSet) {
    LOG.trace("Found loading collection bound to current result set processing; reading row");
    return loadingCollectionEntry.getCollection();
  }
  LOG.trace("Collection is already being initialized; ignoring row");
  return null;
}
