{
  final ArrayList<URL> classPathUrls=new ArrayList<URL>();
  final SourceSet mainSourceSet=project.getConvention().getPlugin(JavaPluginConvention.class).getSourceSets().findByName(SourceSet.MAIN_SOURCE_SET_NAME);
  for (  File file : mainSourceSet.getRuntimeClasspath()) {
    try {
      classPathUrls.add(file.toURI().toURL());
    }
 catch (    MalformedURLException e) {
      throw new InjectionException("Could not determine artifact URL [" + file.getPath() + "]",e);
    }
  }
  return new URLClassLoader(classPathUrls.toArray(new URL[classPathUrls.size()]),getClass().getClassLoader());
}
