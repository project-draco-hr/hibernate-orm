{
  String queryName=queryElem.attribute("name").getValue();
  if (path != null)   queryName=path + '.' + queryName;
  boolean cacheable="true".equals(queryElem.attributeValue("cacheable"));
  String region=queryElem.attributeValue("cache-region");
  Attribute tAtt=queryElem.attribute("timeout");
  Integer timeout=tAtt == null ? null : new Integer(tAtt.getValue());
  Attribute fsAtt=queryElem.attribute("fetch-size");
  Integer fetchSize=fsAtt == null ? null : new Integer(fsAtt.getValue());
  Attribute roAttr=queryElem.attribute("read-only");
  boolean readOnly=roAttr != null && "true".equals(roAttr.getValue());
  Attribute cacheModeAtt=queryElem.attribute("cache-mode");
  String cacheMode=cacheModeAtt == null ? null : cacheModeAtt.getValue();
  Attribute cmAtt=queryElem.attribute("comment");
  String comment=cmAtt == null ? null : cmAtt.getValue();
  java.util.List<String> synchronizedTables=new ArrayList<String>();
  Iterator tables=queryElem.elementIterator("synchronize");
  while (tables.hasNext()) {
    synchronizedTables.add(((Element)tables.next()).attributeValue("table"));
  }
  boolean callable="true".equals(queryElem.attributeValue("callable"));
  NamedSQLQueryDefinition namedQuery;
  Attribute ref=queryElem.attribute("resultset-ref");
  String resultSetRef=ref == null ? null : ref.getValue();
  if (StringHelper.isNotEmpty(resultSetRef)) {
    namedQuery=new NamedSQLQueryDefinition(queryName,queryElem.getText(),resultSetRef,synchronizedTables,cacheable,region,timeout,fetchSize,HbmBinder.getFlushMode(queryElem.attributeValue("flush-mode")),HbmBinder.getCacheMode(cacheMode),readOnly,comment,HbmBinder.getParameterTypes(queryElem),callable);
  }
 else {
    ResultSetMappingDefinition definition=buildResultSetMappingDefinition(queryElem,path,mappings);
    namedQuery=new NamedSQLQueryDefinition(queryName,queryElem.getText(),definition.getQueryReturns(),synchronizedTables,cacheable,region,timeout,fetchSize,HbmBinder.getFlushMode(queryElem.attributeValue("flush-mode")),HbmBinder.getCacheMode(cacheMode),readOnly,comment,HbmBinder.getParameterTypes(queryElem),callable);
  }
  LOG.debugf("Named SQL query: %s -> %s",namedQuery.getName(),namedQuery.getQueryString());
  mappings.addSQLQuery(queryName,namedQuery);
}
