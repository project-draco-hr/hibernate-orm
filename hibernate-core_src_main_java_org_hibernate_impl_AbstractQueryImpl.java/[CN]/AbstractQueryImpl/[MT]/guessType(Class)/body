{
  String typename=clazz.getName();
  Type type=session.getFactory().getTypeResolver().heuristicType(typename);
  boolean serializable=type != null && type instanceof SerializableType;
  if (type == null || serializable) {
    try {
      session.getFactory().getEntityPersister(clazz.getName());
    }
 catch (    MappingException me) {
      if (serializable) {
        return type;
      }
 else {
        throw new HibernateException("Could not determine a type for class: " + typename);
      }
    }
    return ((Session)session).getTypeHelper().entity(clazz);
  }
 else {
    return type;
  }
}
