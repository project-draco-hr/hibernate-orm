{
  int result;
  int rows;
  do {
    sql=query;
    SQL.debug(query);
    PreparedStatement qps=conn.prepareStatement(query);
    try {
      ResultSet rs=qps.executeQuery();
      if (!rs.next()) {
        String err="could not read a hi value - you need to populate the table: " + tableName;
        log.error(err);
        throw new IdentifierGenerationException(err);
      }
      result=rs.getInt(1);
      rs.close();
    }
 catch (    SQLException sqle) {
      log.error("could not read a hi value",sqle);
      throw sqle;
    }
 finally {
      qps.close();
    }
    sql=update;
    SQL.debug(update);
    PreparedStatement ups=conn.prepareStatement(update);
    try {
      ups.setInt(1,result + 1);
      ups.setInt(2,result);
      rows=ups.executeUpdate();
    }
 catch (    SQLException sqle) {
      log.error("could not update hi value in: " + tableName,sqle);
      throw sqle;
    }
 finally {
      ups.close();
    }
  }
 while (rows == 0);
  return new Integer(result);
}
