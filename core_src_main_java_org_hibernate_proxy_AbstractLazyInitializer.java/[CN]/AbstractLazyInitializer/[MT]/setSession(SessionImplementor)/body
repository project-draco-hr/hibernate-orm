{
  if (s != session) {
    if (s == null) {
      session=null;
      readOnly=false;
    }
 else     if (isConnectedToSession()) {
      throw new HibernateException("illegally attempted to associate a proxy with two open Sessions");
    }
 else {
      session=s;
      readOnly=!session.getFactory().getEntityPersister(entityName).isMutable();
    }
  }
}
