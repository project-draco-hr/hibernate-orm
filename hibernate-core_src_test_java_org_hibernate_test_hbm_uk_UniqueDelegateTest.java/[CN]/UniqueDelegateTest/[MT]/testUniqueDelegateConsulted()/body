{
  final Metadata metadata=new MetadataSources(ssr).addResource("org/hibernate/test/hbm/uk/person_unique.hbm.xml").buildMetadata();
  final JournalingSchemaToolingTarget target=new JournalingSchemaToolingTarget();
  final SchemaCreator schemaCreator=ssr.getService(SchemaManagementTool.class).getSchemaCreator(Collections.emptyMap());
  schemaCreator.doCreation(metadata,false,target);
  assertThat(getAlterTableToAddUniqueKeyCommandCallCount,equalTo(1));
  assertThat(getColumnDefinitionUniquenessFragmentCallCount,equalTo(1));
  assertThat(getTableCreationUniqueConstraintsFragmentCallCount,equalTo(0));
  final SchemaDropper schemaDropper=ssr.getService(SchemaManagementTool.class).getSchemaDropper(Collections.emptyMap());
  schemaDropper.doDrop(metadata,false,target);
  assertThat(getAlterTableToAddUniqueKeyCommandCallCount,equalTo(1));
  assertThat(getColumnDefinitionUniquenessFragmentCallCount,equalTo(1));
  assertThat(getTableCreationUniqueConstraintsFragmentCallCount,equalTo(0));
}
