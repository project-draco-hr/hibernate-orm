{
  String resource=properties.getProperty(Environment.CACHE_PROVIDER_CONFIG);
  if (resource == null) {
    resource=properties.getProperty(CONFIG_RESOURCE);
  }
  if (resource == null) {
    resource=DEFAULT_CONFIG;
  }
  log.debug("Configuring TreeCache from resource [" + resource + "]");
  try {
    cache=new org.jboss.cache.TreeCache();
    PropertyConfigurator config=new PropertyConfigurator();
    config.configure(cache,resource);
    TransactionManagerLookup transactionManagerLookup=TransactionManagerLookupFactory.getTransactionManagerLookup(properties);
    if (transactionManagerLookup != null) {
      cache.setTransactionManagerLookup(new TransactionManagerLookupAdaptor(transactionManagerLookup,properties));
      transactionManager=transactionManagerLookup.getTransactionManager(properties);
    }
    cache.start();
  }
 catch (  Exception e) {
    throw new CacheException(e);
  }
}
