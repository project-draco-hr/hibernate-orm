{
  UnversionedLock lock=new UnversionedLock();
  lock.setName("second");
  EntityManager em=getOrCreateEntityManager();
  em.getTransaction().begin();
  em.persist(lock);
  em.getTransaction().commit();
  em.getTransaction().begin();
  lock=em.getReference(UnversionedLock.class,lock.getId());
  try {
    em.lock(lock,LockModeType.READ);
    fail("expected OptimisticLockException exception");
  }
 catch (  OptimisticLockException expected) {
  }
  em.getTransaction().rollback();
  em.getTransaction().begin();
  lock=em.getReference(UnversionedLock.class,lock.getId());
  em.lock(lock,LockModeType.PESSIMISTIC_READ);
  em.getTransaction().commit();
  em.getTransaction().begin();
  lock=em.getReference(UnversionedLock.class,lock.getId());
  em.remove(lock);
  em.getTransaction().commit();
  em.close();
}
