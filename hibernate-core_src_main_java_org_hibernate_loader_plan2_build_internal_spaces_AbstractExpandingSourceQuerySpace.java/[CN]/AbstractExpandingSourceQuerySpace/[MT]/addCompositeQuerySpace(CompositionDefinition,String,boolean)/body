{
  final boolean required=canJoinsBeRequired() && !compositionDefinition.isNullable();
  final ExpandingCompositeQuerySpace rhs=getExpandingQuerySpaces().makeCompositeQuerySpace(querySpaceUid,new CompositePropertyMapping(compositionDefinition.getType(),getPropertyMapping(),compositionDefinition.getName()),required);
  if (shouldIncludeJoin) {
    final JoinDefinedByMetadata join=JoinHelper.INSTANCE.createCompositeJoin(this,compositionDefinition.getName(),rhs,required,compositionDefinition.getType());
    internalGetJoins().add(join);
  }
  return rhs;
}
