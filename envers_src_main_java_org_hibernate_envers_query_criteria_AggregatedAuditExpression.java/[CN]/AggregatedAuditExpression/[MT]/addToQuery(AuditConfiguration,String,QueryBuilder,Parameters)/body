{
  String propertyName=propertyNameGetter.get(auditCfg);
  CriteriaTools.checkPropertyNotARelation(auditCfg,entityName,propertyName);
  QueryBuilder subQb=qb.newSubQueryBuilder();
  for (  AuditCriterion versionsCriteria : criterions) {
    versionsCriteria.addToQuery(auditCfg,entityName,qb,parameters);
    versionsCriteria.addToQuery(auditCfg,entityName,subQb,subQb.getRootParameters());
  }
switch (mode) {
case MIN:
    subQb.addProjection("min",propertyName,false);
  break;
case MAX:
subQb.addProjection("max",propertyName,false);
}
parameters.addWhere(propertyName,"=",subQb);
}
