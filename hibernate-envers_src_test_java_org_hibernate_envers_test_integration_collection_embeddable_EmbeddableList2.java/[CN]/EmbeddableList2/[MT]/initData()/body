{
  EntityManager em=getEntityManager();
  em.getTransaction().begin();
  EmbeddableListEntity2 ele1=new EmbeddableListEntity2();
  em.persist(entity1);
  em.persist(entity2);
  ele1.getComponentList().add(manyToOneComponent1);
  em.persist(ele1);
  em.getTransaction().commit();
  ele_id1=ele1.getId();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  ele1.getComponentList().clear();
  ele1.getComponentList().add(manyToOneComponent2);
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  ele1.getComponentList().add(manyToOneComponent1);
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  em.persist(entity3);
  ele1.getComponentList().get(ele1.getComponentList().indexOf(manyToOneComponent2)).setEntity(entity3);
  ele1.getComponentList().get(ele1.getComponentList().indexOf(manyToOneComponent2)).setData("dataComponent3");
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  em.persist(entity4);
  entity4Copy=new StrTestNoProxyEntity(entity4.getStr(),entity4.getId());
  ele1.getComponentList().add(manyToOneComponent4);
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  ele1.getComponentList().get(ele1.getComponentList().indexOf(manyToOneComponent4)).getEntity().setStr("sat4");
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  ele1.getComponentList().remove(ele1.getComponentList().indexOf(manyToOneComponent4));
  em.getTransaction().commit();
  em.getTransaction().begin();
  ele1=em.find(EmbeddableListEntity2.class,ele1.getId());
  em.remove(ele1);
  em.getTransaction().commit();
  em.close();
}
