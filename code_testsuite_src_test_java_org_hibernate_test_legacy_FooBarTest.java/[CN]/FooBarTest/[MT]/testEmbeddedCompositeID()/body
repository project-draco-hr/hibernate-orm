{
  Session s=openSession();
  Location l=new Location();
  l.setCountryCode("AU");
  l.setDescription("foo bar");
  l.setLocale(Locale.getDefault());
  l.setStreetName("Brunswick Rd");
  l.setStreetNumber(300);
  l.setCity("Melbourne");
  s.save(l);
  s.flush();
  s.connection().commit();
  s.close();
  s=openSession();
  s.setFlushMode(FlushMode.NEVER);
  l=(Location)s.find("from Location l where l.countryCode = 'AU' and l.description='foo bar'").get(0);
  assertTrue(l.getCountryCode().equals("AU"));
  assertTrue(l.getCity().equals("Melbourne"));
  assertTrue(l.getLocale().equals(Locale.getDefault()));
  assertTrue(s.createCriteria(Location.class).add(Expression.eq("streetNumber",new Integer(300))).list().size() == 1);
  s.connection().commit();
  s.close();
  s=openSession();
  l.setDescription("sick're");
  s.update(l);
  s.flush();
  s.connection().commit();
  s.close();
  s=openSession();
  l=new Location();
  l.setCountryCode("AU");
  l.setDescription("foo bar");
  l.setLocale(Locale.ENGLISH);
  l.setStreetName("Brunswick Rd");
  l.setStreetNumber(300);
  l.setCity("Melbourne");
  assertTrue(l == s.load(Location.class,l));
  assertTrue(l.getLocale().equals(Locale.getDefault()));
  s.delete(l);
  s.flush();
  s.connection().commit();
  s.close();
}
