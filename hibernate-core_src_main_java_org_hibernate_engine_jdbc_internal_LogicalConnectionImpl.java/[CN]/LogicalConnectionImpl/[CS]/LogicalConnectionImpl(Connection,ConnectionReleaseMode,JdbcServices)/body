{
  if (connectionReleaseMode == ConnectionReleaseMode.AFTER_STATEMENT && !jdbcServices.getConnectionProvider().supportsAggressiveRelease()) {
    log.debug("connection provider reports to not support aggressive release; overriding");
    connectionReleaseMode=ConnectionReleaseMode.AFTER_TRANSACTION;
  }
  this.physicalConnection=userSuppliedConnection;
  this.connectionReleaseMode=connectionReleaseMode;
  this.jdbcServices=jdbcServices;
  this.jdbcResourceRegistry=new JdbcResourceRegistryImpl(jdbcServices.getSqlExceptionHelper());
  this.isUserSuppliedConnection=(userSuppliedConnection != null);
}
