{
  if (isClosed) {
    throw new HibernateException("connection has been closed");
  }
  if (isUserSuppliedConnection()) {
    return physicalConnection;
  }
 else {
    if (borrowedConnection == null) {
      borrowedConnection=BorrowedConnectionProxy.generateProxy(this);
    }
    return borrowedConnection;
  }
}
