{
  if (isUserSuppliedConnection) {
    return ConnectionReleaseMode.ON_CLOSE;
  }
 else   if (connectionReleaseMode == ConnectionReleaseMode.AFTER_STATEMENT && !jdbcServices.getConnectionProvider().supportsAggressiveRelease()) {
    LOG.debugf("Connection provider reports to not support aggressive release; overriding");
    return ConnectionReleaseMode.AFTER_TRANSACTION;
  }
 else {
    return connectionReleaseMode;
  }
}
