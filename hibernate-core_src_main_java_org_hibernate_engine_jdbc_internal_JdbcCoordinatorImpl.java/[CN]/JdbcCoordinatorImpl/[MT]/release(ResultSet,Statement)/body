{
  LOG.tracev("Releasing result set [{0}]",resultSet);
  if (statement == null) {
    try {
      statement=resultSet.getStatement();
    }
 catch (    SQLException e) {
      throw exceptionHelper.convert(e,"unable to access statement from resultset");
    }
  }
  if (statement != null) {
    if (LOG.isEnabled(Level.DEBUG) && !xref.containsKey(statement)) {
      LOG.unregisteredStatement();
    }
    final Set<ResultSet> resultSets=xref.get(statement);
    if (resultSets != null) {
      resultSets.remove(resultSet);
      if (resultSets.isEmpty()) {
        xref.remove(statement);
      }
    }
  }
 else {
    final boolean removed=unassociatedResultSets.remove(resultSet);
    if (!removed) {
      LOG.unregisteredResultSetWithoutStatement();
    }
  }
  close(resultSet);
}
