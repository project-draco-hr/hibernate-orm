{
  try {
    Configuration cfg=jbcCache.getConfiguration();
    if (cfg.isUseRegionBasedMarshalling()) {
      org.jboss.cache.Region jbcRegion=jbcCache.getRegion(regionFqn,true);
      ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
      if (classLoader == null) {
        classLoader=getClass().getClassLoader();
      }
      jbcRegion.registerContextClassLoader(classLoader);
      if (!jbcRegion.isActive()) {
        jbcRegion.activate();
      }
    }
    if (CacheHelper.isClusteredReplication(cfg.getCacheMode()) || CacheHelper.isClusteredInvalidation(cfg.getCacheMode())) {
      listener=new RegionRootListener();
      jbcCache.addCacheListener(listener);
    }
    establishRegionRootNode();
  }
 catch (  Exception e) {
    throw new CacheException(e.getMessage(),e);
  }
}
