{
  Exception failure;
  ErrorLogger errorHandler=new ErrorLogger();
  SAXReader saxReader=new SAXReader();
  saxReader.setEntityResolver(entityResolver);
  saxReader.setErrorHandler(errorHandler);
  saxReader.setMergeAdjacentText(true);
  saxReader.setValidation(true);
  Document document=null;
  try {
    setValidationFor(saxReader,"orm_2_1.xsd");
    document=saxReader.read(source);
    if (errorHandler.hasErrors()) {
      throw errorHandler.getErrors().get(0);
    }
    return new XmlDocumentImpl(document,origin.getType(),origin.getName());
  }
 catch (  Exception e) {
    if (LOG.isDebugEnabled()) {
      LOG.debugf("Problem parsing XML using orm 2.1 xsd, trying 2.0 xsd : %s",e.getMessage());
    }
    failure=e;
    errorHandler.reset();
    if (document != null) {
      try {
        setValidationFor(saxReader,"orm_2_0.xsd");
        document=saxReader.read(new StringReader(document.asXML()));
        if (errorHandler.hasErrors()) {
          errorHandler.logErrors();
          throw errorHandler.getErrors().get(0);
        }
        return new XmlDocumentImpl(document,origin.getType(),origin.getName());
      }
 catch (      Exception e2) {
        if (LOG.isDebugEnabled()) {
          LOG.debugf("Problem parsing XML using orm 2.0 xsd, trying 1.0 xsd : %s",e2.getMessage());
        }
        errorHandler.reset();
        if (document != null) {
          try {
            setValidationFor(saxReader,"orm_1_0.xsd");
            document=saxReader.read(new StringReader(document.asXML()));
            if (errorHandler.hasErrors()) {
              errorHandler.logErrors();
              throw errorHandler.getErrors().get(0);
            }
            return new XmlDocumentImpl(document,origin.getType(),origin.getName());
          }
 catch (          Exception e3) {
            if (LOG.isDebugEnabled()) {
              LOG.debugf("Problem parsing XML using orm 1.0 xsd : %s",e3.getMessage());
            }
          }
        }
      }
    }
  }
  throw new InvalidMappingException("Unable to read XML",origin.getType(),origin.getName(),failure);
}
