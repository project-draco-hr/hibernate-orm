{
  Exception failure;
  ErrorLogger errorHandler=new ErrorLogger();
  SAXReader saxReader=new SAXReader();
  saxReader.setEntityResolver(entityResolver);
  saxReader.setErrorHandler(errorHandler);
  saxReader.setMergeAdjacentText(true);
  saxReader.setValidation(true);
  Document document=null;
  try {
    setValidationFor(saxReader,"orm_2_0.xsd");
    document=saxReader.read(source);
    if (errorHandler.hasErrors()) {
      throw errorHandler.getErrors().get(0);
    }
    return new XmlDocumentImpl(document,origin.getType(),origin.getName());
  }
 catch (  Exception orm2Problem) {
    if (LOG.isDebugEnabled()) {
      LOG.debugf("Problem parsing XML using orm 2 xsd : %s",orm2Problem.getMessage());
    }
    failure=orm2Problem;
    errorHandler.reset();
    if (document != null) {
      try {
        setValidationFor(saxReader,"orm_1_0.xsd");
        document=saxReader.read(new StringReader(document.asXML()));
        if (errorHandler.hasErrors()) {
          errorHandler.logErrors();
          throw errorHandler.getErrors().get(0);
        }
        return new XmlDocumentImpl(document,origin.getType(),origin.getName());
      }
 catch (      Exception orm1Problem) {
        if (LOG.isDebugEnabled()) {
          LOG.debugf("Problem parsing XML using orm 1 xsd : %s",orm1Problem.getMessage());
        }
      }
    }
  }
  throw new InvalidMappingException("Unable to read XML",origin.getType(),origin.getName(),failure);
}
