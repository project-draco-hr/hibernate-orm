{
  log.startingDelayedSchemaDrop();
  final ConnectionProvider connectionProvider=serviceRegistry.getService(ConnectionProvider.class);
  if (connectionProvider == null) {
    throw new SchemaManagementException("Could not build JDBC Connection context to drop schema on SessionFactory close");
  }
  final GenerationTargetToDatabase target=new GenerationTargetToDatabase(new JdbcConnectionContextNonSharedImpl(new JdbcConnectionAccessConnectionProviderImpl(connectionProvider),serviceRegistry.getService(JdbcServices.class).getSqlStatementLogger(),true),serviceRegistry.getService(JdbcEnvironment.class).getSqlExceptionHelper());
  target.prepare();
  try {
    for (    String command : commands) {
      try {
        target.accept(command);
      }
 catch (      CommandAcceptanceException e) {
        log.unsuccessfulSchemaManagementCommand(command);
        log.debugf(e,"Error performing delayed DROP command [%s]",command);
      }
    }
  }
  finally {
    target.release();
  }
}
