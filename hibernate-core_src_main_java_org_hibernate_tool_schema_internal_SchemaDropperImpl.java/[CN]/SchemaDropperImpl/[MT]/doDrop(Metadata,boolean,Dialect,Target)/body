{
  final Database database=metadata.getDatabase();
  final JdbcEnvironment jdbcEnvironment=database.getJdbcEnvironment();
  boolean tryToDropCatalogs=false;
  boolean tryToDropSchemas=false;
  if (dropNamespaces) {
    if (dialect.canCreateSchema()) {
      tryToDropSchemas=true;
    }
    if (dialect.canCreateCatalog()) {
      tryToDropCatalogs=true;
    }
  }
  for (  Target target : targets) {
    target.prepare();
  }
  final Set<String> exportIdentifiers=new HashSet<String>(50);
  for (  AuxiliaryDatabaseObject auxiliaryDatabaseObject : database.getAuxiliaryDatabaseObjects()) {
    if (!auxiliaryDatabaseObject.beforeTablesOnCreation()) {
      continue;
    }
    if (!auxiliaryDatabaseObject.appliesToDialect(dialect)) {
      continue;
    }
    applySqlStrings(targets,dialect.getAuxiliaryDatabaseObjectExporter().getSqlDropStrings(auxiliaryDatabaseObject,metadata));
  }
  for (  Namespace namespace : database.getNamespaces()) {
    if (!filter.includeNamespace(namespace)) {
      continue;
    }
    applyConstraintDropping(targets,namespace,metadata);
    for (    Table table : namespace.getTables()) {
      if (!table.isPhysicalTable()) {
        continue;
      }
      if (!filter.includeTable(table)) {
        continue;
      }
      checkExportIdentifier(table,exportIdentifiers);
      applySqlStrings(targets,dialect.getTableExporter().getSqlDropStrings(table,metadata));
    }
    for (    Sequence sequence : namespace.getSequences()) {
      checkExportIdentifier(sequence,exportIdentifiers);
      applySqlStrings(targets,dialect.getSequenceExporter().getSqlDropStrings(sequence,metadata));
    }
  }
  for (  AuxiliaryDatabaseObject auxiliaryDatabaseObject : database.getAuxiliaryDatabaseObjects()) {
    if (auxiliaryDatabaseObject.beforeTablesOnCreation()) {
      continue;
    }
    if (!auxiliaryDatabaseObject.appliesToDialect(dialect)) {
      continue;
    }
    applySqlStrings(targets,auxiliaryDatabaseObject.sqlDropStrings(jdbcEnvironment.getDialect()));
  }
  if (tryToDropCatalogs || tryToDropSchemas) {
    Set<Identifier> exportedCatalogs=new HashSet<Identifier>();
    for (    Namespace namespace : database.getNamespaces()) {
      if (!filter.includeNamespace(namespace)) {
        continue;
      }
      if (tryToDropSchemas && namespace.getPhysicalName().getSchema() != null) {
        applySqlStrings(targets,dialect.getDropSchemaCommand(namespace.getPhysicalName().getSchema().render(dialect)));
      }
      if (tryToDropCatalogs) {
        final Identifier catalogLogicalName=namespace.getName().getCatalog();
        final Identifier catalogPhysicalName=namespace.getPhysicalName().getCatalog();
        if (catalogPhysicalName != null && !exportedCatalogs.contains(catalogLogicalName)) {
          applySqlStrings(targets,dialect.getDropCatalogCommand(catalogPhysicalName.render(dialect)));
          exportedCatalogs.add(catalogLogicalName);
        }
      }
    }
  }
  for (  Target target : targets) {
    target.release();
  }
}
