{
  final EntityQuerySpace rootQuerySpace=Helper.INSTANCE.extractRootQuerySpace(querySpaces,EntityQuerySpace.class);
  final EntityReferenceAliases entityReferenceAliases=aliasResolutionContext.generateEntityReferenceAliases(rootQuerySpace.getUid(),rootQuerySpace.getEntityPersister());
  final String rootTableAlias=entityReferenceAliases.getTableAlias();
  applyTableFragments(select,factory,buildingParameters,rootTableAlias,(OuterJoinLoadable)rootQuerySpace.getEntityPersister());
  applyKeyRestriction(select,entityReferenceAliases.getTableAlias(),keyColumnNamesToUse,buildingParameters.getBatchSize());
  final OuterJoinLoadable rootLoadable=(OuterJoinLoadable)rootQuerySpace.getEntityPersister();
  final Queryable rootQueryable=(Queryable)rootQuerySpace.getEntityPersister();
  select.appendRestrictions(rootQueryable.filterFragment(entityReferenceAliases.getTableAlias(),Collections.emptyMap()));
  select.appendRestrictions(rootLoadable.whereJoinFragment(entityReferenceAliases.getTableAlias(),true,true));
  helper.processQuerySpaceJoins(rootQuerySpace,select);
}
