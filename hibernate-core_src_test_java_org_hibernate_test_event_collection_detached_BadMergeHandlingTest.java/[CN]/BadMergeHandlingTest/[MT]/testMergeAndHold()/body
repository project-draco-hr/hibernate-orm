{
  Session s=openSession();
  s.beginTransaction();
  Character paul=new Character(1,"Paul Atreides");
  s.persist(paul);
  Character paulo=new Character(2,"Paulo Atreides");
  s.persist(paulo);
  Alias alias1=new Alias(1,"Paul Muad'Dib");
  s.persist(alias1);
  Alias alias2=new Alias(2,"Usul");
  s.persist(alias2);
  Alias alias3=new Alias(3,"The Preacher");
  s.persist(alias3);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  alias1.getCharacters().add(paul);
  s.merge(alias1);
  alias2.getCharacters().add(paul);
  s.merge(alias2);
  alias3.getCharacters().add(paul);
  s.merge(alias3);
  s.flush();
  alias1.getCharacters().add(paulo);
  s.merge(alias1);
  alias2.getCharacters().add(paulo);
  s.merge(alias2);
  alias3.getCharacters().add(paulo);
  s.merge(alias3);
  s.flush();
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  List results=s.createQuery("select c from Character c join c.aliases a where a.alias = :aParam").setParameter("aParam","Usul").list();
  assertEquals(2,results.size());
  s.getTransaction().commit();
  s.close();
}
