{
  Session s=openSession();
  s.beginTransaction();
  Customer paul=new Customer(1,"Paul Atreides");
  s.persist(paul);
  Alias alias1=new Alias(1,"Paul Muad'Dib");
  s.persist(alias1);
  Alias alias2=new Alias(2,"Usul");
  s.persist(alias2);
  Alias alias3=new Alias(3,"The Preacher");
  s.persist(alias3);
  CreditCard cc1=new CreditCard(1);
  s.persist(cc1);
  CreditCard cc2=new CreditCard(2);
  s.persist(cc2);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  alias1.customers.add(paul);
  s.merge(alias1);
  alias2.customers.add(paul);
  s.merge(alias2);
  alias3.customers.add(paul);
  s.merge(alias3);
  cc1.customer=paul;
  s.merge(cc1);
  cc2.customer=paul;
  s.merge(cc2);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  List results=s.createQuery("select c from Customer c join c.aliases a where a.alias = :aParam").setParameter("aParam","Usul").list();
  assertEquals(1,results.size());
  s.getTransaction().commit();
  s.close();
}
