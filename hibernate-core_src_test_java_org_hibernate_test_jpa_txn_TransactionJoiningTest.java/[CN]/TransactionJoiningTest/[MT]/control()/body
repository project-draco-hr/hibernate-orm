{
  assertFalse(JtaStatusHelper.isActive(TestingJtaPlatformImpl.INSTANCE.getTransactionManager()));
  TestingJtaPlatformImpl.INSTANCE.getTransactionManager().begin();
  assertTrue(JtaStatusHelper.isActive(TestingJtaPlatformImpl.INSTANCE.getTransactionManager()));
  SessionImplementor session=(SessionImplementor)sessionFactory().openSession();
  TransactionImplementor transaction=(TransactionImplementor)((Session)session).getTransaction();
  assertTrue(session.getTransactionCoordinator().isSynchronizationRegistered());
  assertTrue(transaction.isParticipating());
  ((Session)session).close();
  TestingJtaPlatformImpl.INSTANCE.getTransactionManager().commit();
}
