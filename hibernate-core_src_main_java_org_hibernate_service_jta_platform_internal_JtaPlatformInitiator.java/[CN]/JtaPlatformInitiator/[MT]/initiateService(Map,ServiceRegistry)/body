{
  final Object platform=getConfiguredPlatform(configVales,registry);
  if (platform == null) {
    return new NoJtaPlatform();
  }
  if (JtaPlatform.class.isInstance(platform)) {
    return (JtaPlatform)platform;
  }
  final String platformImplName=platform.toString();
  ClassLoaderService classLoaderService=registry.getService(ClassLoaderService.class);
  try {
    return (JtaPlatform)classLoaderService.classForName(platformImplName).newInstance();
  }
 catch (  Exception e) {
    throw new HibernateException("Unable to create specified JtaPlatform class [" + platformImplName + "]",e);
  }
}
