{
  EntityManager em=getEntityManager();
  SimplePerson person=new SimplePerson();
  person.setName("Person 1");
  person.setTestCode(new TestCode(84));
  person.setGenericCode(new Code(42,"TestCodeart"));
  EntityTransaction tx=em.getTransaction();
  tx.begin();
  em.persist(person);
  tx.commit();
  em.close();
  em=getEntityManager();
  SimplePerson personLoaded=em.find(SimplePerson.class,person.getId());
  AuditReader reader=AuditReaderFactory.get(em);
  List<Number> revs=reader.getRevisions(SimplePerson.class,person.getId());
  Assert.assertEquals(1,revs.size());
  SimplePerson personRev1=reader.find(SimplePerson.class,person.getId(),revs.get(0));
  Assert.assertEquals(personLoaded.getName(),personRev1.getName());
  Assert.assertEquals(personLoaded.getGenericCode(),personRev1.getGenericCode());
  Assert.assertEquals(personLoaded.getTestCode(),personRev1.getTestCode());
}
