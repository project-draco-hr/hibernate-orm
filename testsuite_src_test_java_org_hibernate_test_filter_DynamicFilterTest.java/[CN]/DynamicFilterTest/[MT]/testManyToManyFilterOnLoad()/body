{
  TestData testData=new TestData();
  testData.prepare();
  Session session=openSession();
  session.enableFilter("effectiveDate").setParameter("asOfDate",new Date());
  Product prod=(Product)session.get(Product.class,testData.prod1Id);
  long initLoadCount=getSessions().getStatistics().getCollectionLoadCount();
  long initFetchCount=getSessions().getStatistics().getCollectionFetchCount();
  int size=prod.getCategories().size();
  assertEquals("Incorrect filtered collection count",1,size);
  long currLoadCount=getSessions().getStatistics().getCollectionLoadCount();
  long currFetchCount=getSessions().getStatistics().getCollectionFetchCount();
  assertTrue("load with join fetch of many-to-many did not trigger join fetch",(initLoadCount == currLoadCount) && (initFetchCount == currFetchCount));
  long initEntityLoadCount=getSessions().getStatistics().getEntityLoadCount();
  Iterator itr=prod.getCategories().iterator();
  while (itr.hasNext()) {
    Category cat=(Category)itr.next();
    System.out.println(" ===> " + cat.getName());
  }
  long currEntityLoadCount=getSessions().getStatistics().getEntityLoadCount();
  assertTrue("load with join fetch of many-to-many did not trigger *complete* join fetch",(initEntityLoadCount == currEntityLoadCount));
  session.close();
  testData.release();
}
