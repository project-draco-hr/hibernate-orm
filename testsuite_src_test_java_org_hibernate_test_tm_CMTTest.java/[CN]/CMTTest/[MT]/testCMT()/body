{
  getSessions().getStatistics().clear();
  DummyTransactionManager.INSTANCE.begin();
  Session s=openSession();
  DummyTransactionManager.INSTANCE.getTransaction().commit();
  assertFalse(s.isOpen());
  assertEquals(getSessions().getStatistics().getFlushCount(),0);
  DummyTransactionManager.INSTANCE.begin();
  s=openSession();
  DummyTransactionManager.INSTANCE.getTransaction().rollback();
  assertFalse(s.isOpen());
  DummyTransactionManager.INSTANCE.begin();
  s=openSession();
  Map item=new HashMap();
  item.put("name","The Item");
  item.put("description","The only item we have");
  s.persist("Item",item);
  DummyTransactionManager.INSTANCE.getTransaction().commit();
  assertFalse(s.isOpen());
  DummyTransactionManager.INSTANCE.begin();
  s=openSession();
  item=(Map)s.createQuery("from Item").uniqueResult();
  assertNotNull(item);
  s.delete(item);
  DummyTransactionManager.INSTANCE.getTransaction().commit();
  assertFalse(s.isOpen());
  assertEquals(getSessions().getStatistics().getTransactionCount(),4);
  assertEquals(getSessions().getStatistics().getSuccessfulTransactionCount(),3);
  assertEquals(getSessions().getStatistics().getEntityDeleteCount(),1);
  assertEquals(getSessions().getStatistics().getEntityInsertCount(),1);
  assertEquals(getSessions().getStatistics().getSessionOpenCount(),4);
  assertEquals(getSessions().getStatistics().getSessionCloseCount(),4);
  assertEquals(getSessions().getStatistics().getQueryExecutionCount(),1);
  assertEquals(getSessions().getStatistics().getFlushCount(),2);
  DummyTransactionManager.INSTANCE.begin();
  s=openSession();
  s.createQuery("delete from Item").executeUpdate();
  DummyTransactionManager.INSTANCE.commit();
}
