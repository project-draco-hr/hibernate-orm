{
  String name=cfg.getHibernateConfiguration().getProperty(HibernatePersistence.CONFIGURATION_JNDI_NAME);
  if (name == null) {
    log.debug("No JNDI name configured for binding Ejb3Configuration");
  }
 else {
    log.info("Ejb3Configuration name: {}",name);
    try {
      Context ctx=org.hibernate.util.NamingHelper.getInitialContext(cfg.getProperties());
      org.hibernate.util.NamingHelper.bind(ctx,name,cfg);
      log.info("Bound Ejb3Configuration to JNDI name: {}",name);
      ((EventContext)ctx).addNamingListener(name,EventContext.OBJECT_SCOPE,LISTENER);
    }
 catch (    InvalidNameException ine) {
      log.error("Invalid JNDI name: " + name,ine);
    }
catch (    NamingException ne) {
      log.warn("Could not bind Ejb3Configuration to JNDI",ne);
    }
catch (    ClassCastException cce) {
      log.warn("InitialContext did not implement EventContext");
    }
  }
}
