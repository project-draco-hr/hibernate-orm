{
  ServiceRegistry reg=new StandardServiceRegistryBuilder(new BootstrapServiceRegistryImpl()).build();
  SessionFactory sf=new Configuration().addAnnotatedClass(Investor.class).setProperty("hibernate.hbm2ddl.auto","create-drop").buildSessionFactory(reg);
  try {
    Session sess=sf.openSession();
    Investor myInv=getInvestor();
    myInv.setId(1L);
    sess.save(myInv);
    sess.flush();
    sess.clear();
    Investor inv=(Investor)sess.get(Investor.class,1L);
    assertEquals(new BigDecimal("100"),inv.getInvestments().get(0).getAmount().getAmount());
    sess.close();
  }
  finally {
    sf.close();
    StandardServiceRegistryBuilder.destroy(reg);
  }
}
