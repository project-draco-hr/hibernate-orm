{
  if (getDialect() instanceof HSQLDialect)   return;
  Session s=getSessions().openSession();
  I i=new I();
  i.setName("i");
  i.setType('a');
  J j=new J();
  j.setName("j");
  j.setType('x');
  j.setAmount(1.0f);
  Serializable iid=s.save(i);
  Serializable jid=s.save(j);
  s.flush();
  s.connection().commit();
  s.close();
  getSessions().evict(I.class);
  s=getSessions().openSession();
  j=(J)s.get(I.class,jid);
  i=(I)s.get(I.class,iid);
  assertTrue(i.getClass() == I.class);
  j.setAmount(0.5f);
  s.lock(i,LockMode.UPGRADE);
  s.flush();
  s.connection().commit();
  s.close();
  s=getSessions().openSession();
  j=(J)s.get(I.class,jid,LockMode.UPGRADE);
  i=(I)s.get(I.class,iid,LockMode.UPGRADE);
  s.flush();
  s.connection().commit();
  s.close();
  s=getSessions().openSession();
  assertTrue(s.createQuery("from I").list().size() == 2);
  assertTrue(s.createQuery("from J").list().size() == 1);
  assertTrue(s.createQuery("from I i where i.class = 0").list().size() == 1);
  assertTrue(s.createQuery("from I i where i.class = 1").list().size() == 1);
  s.connection().commit();
  s.close();
  s=getSessions().openSession();
  j=(J)s.get(J.class,jid);
  i=(I)s.get(I.class,iid);
  s.delete(j);
  s.delete(i);
  s.flush();
  s.connection().commit();
  s.close();
}
