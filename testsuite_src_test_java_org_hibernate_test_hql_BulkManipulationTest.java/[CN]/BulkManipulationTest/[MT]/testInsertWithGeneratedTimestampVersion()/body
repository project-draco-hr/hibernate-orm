{
  if (!supportsBulkInsertIdGeneration(TimestampVersioned.class)) {
    reportSkip("bulk id generation not supported","test bulk inserts with generated id and generated timestamp");
    return;
  }
  if (!getDialect().supportsParametersInInsertSelect()) {
    reportSkip("dialect does not support parameter in INSERT ... SELECT","test bulk inserts with generated id and generated timestamp");
    return;
  }
  Session s=openSession();
  Transaction t=s.beginTransaction();
  TimestampVersioned entity=new TimestampVersioned("int-vers");
  s.save(entity);
  s.createQuery("select id, name, version from TimestampVersioned").list();
  t.commit();
  s.close();
  Long initialId=entity.getId();
  s=openSession();
  t=s.beginTransaction();
  int count=s.createQuery("insert into TimestampVersioned ( name ) select name from TimestampVersioned").executeUpdate();
  t.commit();
  s.close();
  assertEquals("unexpected insertion count",1,count);
  s=openSession();
  t=s.beginTransaction();
  TimestampVersioned created=(TimestampVersioned)s.createQuery("from TimestampVersioned where id <> :initialId").setLong("initialId",initialId.longValue()).uniqueResult();
  t.commit();
  s.close();
  assertNotNull(created.getVersion());
  s=openSession();
  t=s.beginTransaction();
  s.createQuery("delete TimestampVersioned").executeUpdate();
  t.commit();
  s.close();
}
