{
  final StringBuilder buffer=new StringBuilder().append("{call ").append(procedureName).append("(");
  String sep="";
  for (  StoredProcedureParameterImplementor parameter : registeredParameters) {
    for (int i=0; i < parameter.getSqlTypes().length; i++) {
      buffer.append(sep).append("?");
      sep=",";
    }
  }
  buffer.append(")}");
  try {
    final CallableStatement statement=session().getTransactionCoordinator().getJdbcCoordinator().getLogicalConnection().getShareableConnectionProxy().prepareCall(buffer.toString());
    int i=1;
    for (    StoredProcedureParameterImplementor parameter : registeredParameters) {
      if (parameter == null) {
        throw new QueryException("Registered stored procedure parameters had gaps");
      }
      parameter.prepare(statement,i);
      i+=parameter.getSqlTypes().length;
    }
    return new StoredProcedureOutputsImpl(this,statement);
  }
 catch (  SQLException e) {
    throw session().getFactory().getSQLExceptionHelper().convert(e,"Error preparing CallableStatement",getProcedureName());
  }
}
