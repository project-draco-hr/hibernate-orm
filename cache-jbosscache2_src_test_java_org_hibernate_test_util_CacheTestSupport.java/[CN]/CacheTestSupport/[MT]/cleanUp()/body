{
  for (Iterator it=factories.iterator(); it.hasNext(); ) {
    try {
      ((RegionFactory)it.next()).stop();
    }
 catch (    Exception e) {
      storeException(e);
    }
 finally {
      it.remove();
    }
  }
  factories.clear();
  for (Iterator it=caches.iterator(); it.hasNext(); ) {
    try {
      Cache cache=(Cache)it.next();
      cache.stop();
      cache.destroy();
    }
 catch (    Exception e) {
      storeException(e);
    }
 finally {
      it.remove();
    }
    avoidConcurrentFlush();
  }
  caches.clear();
}
