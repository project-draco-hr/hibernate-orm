{
  AbstractMultiTenantConnectionProvider multiTenantConnectionProvider=buildMultiTenantConnectionProvider();
  Configuration cfg=buildConfiguration();
  serviceRegistry=(ServiceRegistryImplementor)new ServiceRegistryBuilder().applySettings(cfg.getProperties()).addService(MultiTenantConnectionProvider.class,multiTenantConnectionProvider).buildServiceRegistry();
  sessionFactory=(SessionFactoryImplementor)cfg.buildSessionFactory(serviceRegistry);
}
