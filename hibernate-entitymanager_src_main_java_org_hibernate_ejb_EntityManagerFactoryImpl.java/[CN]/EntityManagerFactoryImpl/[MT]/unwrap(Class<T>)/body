{
  if (SessionFactory.class.isAssignableFrom(cls)) {
    return (T)sessionFactory;
  }
  if (SessionFactoryImplementor.class.isAssignableFrom(cls)) {
    return (T)sessionFactory;
  }
  if (EntityManager.class.isAssignableFrom(cls)) {
    return (T)this;
  }
  throw new PersistenceException("Hibernate cannot unwrap EntityManagerFactory as " + cls.getName());
}
