{
  super(entityMetamodel,mappedEntity);
  this.mappedClass=mappedEntity.getMappedClass();
  this.proxyInterface=mappedEntity.getProxyInterface();
  this.lifecycleImplementor=Lifecycle.class.isAssignableFrom(mappedClass);
  this.isBytecodeEnhanced=entityMetamodel.getBytecodeEnhancementMetadata().isEnhancedForLazyLoading();
  Iterator iter=mappedEntity.getPropertyClosureIterator();
  Set<String> tmpLazyPropertyNames=new HashSet<String>();
  while (iter.hasNext()) {
    Property property=(Property)iter.next();
    if (property.isLazy()) {
      tmpLazyPropertyNames.add(property.getName());
    }
  }
  lazyPropertyNames=tmpLazyPropertyNames.isEmpty() ? null : Collections.unmodifiableSet(tmpLazyPropertyNames);
  String[] getterNames=new String[propertySpan];
  String[] setterNames=new String[propertySpan];
  Class[] propTypes=new Class[propertySpan];
  for (int i=0; i < propertySpan; i++) {
    getterNames[i]=getters[i].getMethodName();
    setterNames[i]=setters[i].getMethodName();
    propTypes[i]=getters[i].getReturnType();
  }
  if (hasCustomAccessors || !Environment.useReflectionOptimizer()) {
    optimizer=null;
  }
 else {
    optimizer=Environment.getBytecodeProvider().getReflectionOptimizer(mappedClass,getterNames,setterNames,propTypes);
  }
}
