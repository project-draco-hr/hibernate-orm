{
  Object currentRevisionData=getCurrentRevisionData(session,true);
  AuditWorkUnit vwu;
  while ((vwu=undoQueue.poll()) != null) {
    vwu.undo(session);
    revisionInfoGenerator.removeEntityFromRevision(vwu.getEntityName(),currentRevisionData);
  }
  while ((vwu=workUnits.poll()) != null) {
    vwu.perform(session,revisionData);
    revisionInfoGenerator.addEntityToRevision(vwu.getEntityName(),currentRevisionData);
  }
}
