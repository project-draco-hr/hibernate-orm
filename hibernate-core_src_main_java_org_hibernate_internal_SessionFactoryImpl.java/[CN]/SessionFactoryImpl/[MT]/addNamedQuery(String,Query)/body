{
  validateNotClosed();
  try {
    final StoredProcedureQueryImpl unwrapped=query.unwrap(StoredProcedureQueryImpl.class);
    if (unwrapped != null) {
      addNamedStoredProcedureQuery(name,unwrapped);
      return;
    }
  }
 catch (  PersistenceException ignore) {
  }
  try {
    org.hibernate.query.Query hibernateQuery=query.unwrap(org.hibernate.query.Query.class);
    if (hibernateQuery != null) {
      if (org.hibernate.query.NativeQuery.class.isInstance(hibernateQuery)) {
        getNamedQueryRepository().registerNamedSQLQueryDefinition(name,extractSqlQueryDefinition((org.hibernate.query.NativeQuery)hibernateQuery,name));
      }
 else {
        getNamedQueryRepository().registerNamedQueryDefinition(name,extractHqlQueryDefinition(hibernateQuery,name));
      }
      return;
    }
  }
 catch (  PersistenceException ignore) {
  }
  throw new PersistenceException(String.format("Unsure how to how to properly unwrap given Query [%s] as basis for named query",query));
}
