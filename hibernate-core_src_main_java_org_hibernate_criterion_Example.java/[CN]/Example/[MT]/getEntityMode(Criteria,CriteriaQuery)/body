{
  EntityPersister meta=criteriaQuery.getFactory().getEntityPersister(criteriaQuery.getEntityName(criteria));
  EntityMode result=meta.getEntityMode();
  if (!meta.getEntityMetamodel().getTuplizer().isInstance(entity)) {
    throw new ClassCastException(entity.getClass().getName());
  }
  return result;
}
