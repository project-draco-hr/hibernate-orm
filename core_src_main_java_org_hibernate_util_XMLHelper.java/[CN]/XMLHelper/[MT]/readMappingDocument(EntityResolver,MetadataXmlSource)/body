{
  Exception failure;
  ErrorLogger2 errorHandler=new ErrorLogger2();
  SAXReader saxReader=new SAXReader();
  saxReader.setEntityResolver(entityResolver);
  saxReader.setErrorHandler(errorHandler);
  saxReader.setMergeAdjacentText(true);
  saxReader.setValidation(true);
  Document document=null;
  try {
    setValidationFor(saxReader,"orm_2_0.xsd");
    document=saxReader.read(source.getInputSource());
    if (errorHandler.error != null) {
      throw errorHandler.error;
    }
    return buildMetadataXml(document,source.getOrigin().getType(),source.getOrigin().getName());
  }
 catch (  Exception orm2Problem) {
    log.debug("Problem parsing XML using orm 2 xsd : {}",orm2Problem.getMessage());
    failure=orm2Problem;
    errorHandler.error=null;
    if (document != null) {
      try {
        setValidationFor(saxReader,"orm_1_0.xsd");
        document=saxReader.read(new StringReader(document.asXML()));
        if (errorHandler.error != null) {
          throw errorHandler.error;
        }
        return buildMetadataXml(document,source.getOrigin().getType(),source.getOrigin().getName());
      }
 catch (      Exception orm1Problem) {
        log.debug("Problem parsing XML using orm 1 xsd : {}",orm1Problem.getMessage());
        errorHandler.error=null;
      }
    }
  }
  throw new InvalidMappingException("Unable to read XML",source.getOrigin().getType(),source.getOrigin().getName(),failure);
}
