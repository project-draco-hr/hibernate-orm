{
  if (getSessions() != null)   getSessions().close();
  try {
    setCfg(new AnnotationConfiguration());
    configure(cfg);
    if (recreateSchema()) {
      cfg.setProperty(Environment.HBM2DDL_AUTO,"create-drop");
    }
    for (int i=0; i < packages.length; i++) {
      getCfg().addPackage(packages[i]);
    }
    for (int i=0; i < classes.length; i++) {
      getCfg().addAnnotatedClass(classes[i]);
    }
    for (int i=0; i < xmlFiles.length; i++) {
      InputStream is=Thread.currentThread().getContextClassLoader().getResourceAsStream(xmlFiles[i]);
      getCfg().addInputStream(is);
    }
    setDialect(Dialect.getDialect());
    setSessions(getCfg().buildSessionFactory());
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
