{
  Configuration cfg=new Configuration().setProperty(AvailableSettings.SESSION_FACTORY_NAME,NAME).setProperty(AvailableSettings.SESSION_FACTORY_NAME_IS_JNDI,"false");
  SessionFactory factory=cfg.buildSessionFactory();
  Reference reference=factory.getReference();
  StringRefAddr refAddr=(StringRefAddr)reference.get("uuid");
  String uuid=(String)refAddr.getContent();
  SessionFactoryRegistry.INSTANCE.removeSessionFactory(uuid,NAME,false,null);
  SessionFactoryRegistry.INSTANCE.addSessionFactory("some-other-uuid",NAME,false,factory,null);
  SessionFactory factory2=(SessionFactory)SerializationHelper.clone(factory);
  assertSame(factory,factory2);
  SessionFactoryRegistry.INSTANCE.removeSessionFactory("some-other-uuid",NAME,false,null);
  factory.close();
  assertFalse(SessionFactoryRegistry.INSTANCE.hasRegistrations());
}
