{
  try {
    rollbackOnly=false;
    if (tx != null && tx.getStatus() == TransactionStatus.ACTIVE) {
      throw new IllegalStateException("Transaction already active");
    }
    tx=getSession().beginTransaction();
  }
 catch (  HibernateException he) {
    entityManager.throwPersistenceException(he);
  }
}
