{
  if (getEntityMetamodel().getInstrumentationMetadata().isInstrumented()) {
    FieldInterceptor interceptor=getEntityMetamodel().getInstrumentationMetadata().extractInterceptor(entity);
    if (interceptor != null) {
      interceptor.setSession(session);
    }
 else {
      FieldInterceptor fieldInterceptor=getEntityMetamodel().getInstrumentationMetadata().injectInterceptor(entity,getEntityName(),null,session);
      fieldInterceptor.dirty();
    }
  }
  if (entity instanceof PersistentAttributeInterceptable) {
    PersistentAttributeInterceptor interceptor=((PersistentAttributeInterceptable)entity).$$_hibernate_getInterceptor();
    if (interceptor != null && interceptor instanceof LazyAttributeLoader) {
      ((LazyAttributeLoader)interceptor).setSession(session);
    }
  }
  handleNaturalIdReattachment(entity,session);
}
