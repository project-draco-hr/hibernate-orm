{
  Session session=openSession();
  session.beginTransaction();
  Person person=new Person();
  person.id=1;
  person.name="Joe Blow";
  session.save(person);
  Customer customer=new Customer();
  customer.id=1L;
  Investment investment1=new Investment();
  investment1.description="stock";
  investment1.date=new Date();
  investment1.monetaryAmount=new MonetaryAmount();
  investment1.monetaryAmount.currency=MonetaryAmount.CurrencyCode.USD;
  investment1.monetaryAmount.amount=BigDecimal.valueOf(1234,2);
  investment1.performedBy=person;
  Investment investment2=new Investment();
  investment2.description="bond";
  investment2.date=new Date();
  investment2.monetaryAmount=new MonetaryAmount();
  investment2.monetaryAmount.currency=MonetaryAmount.CurrencyCode.EUR;
  investment2.monetaryAmount.amount=BigDecimal.valueOf(98176,1);
  customer.investments.add(investment1);
  customer.investments.add(investment2);
  session.save(customer);
  session.getTransaction().commit();
  session.close();
  List results=getResults(sessionFactory().getEntityPersister(Customer.class.getName()));
  assertEquals(2,results.size());
  assertSame(results.get(0),results.get(1));
  Object result=results.get(0);
  assertNotNull(result);
  Customer customerWork=ExtraAssertions.assertTyping(Customer.class,result);
  session=openSession();
  session.beginTransaction();
  session.delete(customerWork.investments.get(0).performedBy);
  session.delete(customerWork);
  session.getTransaction().commit();
  session.close();
}
