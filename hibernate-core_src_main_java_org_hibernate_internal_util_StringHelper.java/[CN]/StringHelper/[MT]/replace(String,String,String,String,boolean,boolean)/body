{
  final boolean actuallyReplace=!wholeWords || afterPlaceholder.length() == 0 || !Character.isJavaIdentifierPart(afterPlaceholder.charAt(0));
  boolean encloseInParens=actuallyReplace && encloseInParensIfNecessary && !(getLastNonWhitespaceCharacter(beforePlaceholder) == '(')&& !(getLastNonWhitespaceCharacter(beforePlaceholder) == ',' && getFirstNonWhitespaceCharacter(afterPlaceholder) == ')');
  StringBuilder buf=new StringBuilder(beforePlaceholder);
  if (encloseInParens) {
    buf.append('(');
  }
  buf.append(actuallyReplace ? replacement : placeholder);
  if (encloseInParens) {
    buf.append(')');
  }
  buf.append(replace(afterPlaceholder,placeholder,replacement,wholeWords,encloseInParensIfNecessary));
  return buf.toString();
}
