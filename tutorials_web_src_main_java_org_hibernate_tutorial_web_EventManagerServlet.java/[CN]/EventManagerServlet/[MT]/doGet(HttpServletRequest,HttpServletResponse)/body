{
  SimpleDateFormat dateFormatter=new SimpleDateFormat("dd.MM.yyyy");
  try {
    HibernateUtil.getSessionFactory().getCurrentSession().beginTransaction();
    PrintWriter out=response.getWriter();
    out.println("<html><head><title>Event Manager</title></head><body>");
    if ("store".equals(request.getParameter("action"))) {
      String eventTitle=request.getParameter("eventTitle");
      String eventDate=request.getParameter("eventDate");
      if ("".equals(eventTitle) || "".equals(eventDate)) {
        out.println("<b><i>Please enter event title and date.</i></b>");
      }
 else {
        createAndStoreEvent(eventTitle,dateFormatter.parse(eventDate));
        out.println("<b><i>Added event.</i></b>");
      }
    }
    printEventForm(out);
    listEvents(out,dateFormatter);
    out.println("</body></html>");
    out.flush();
    out.close();
    HibernateUtil.getSessionFactory().getCurrentSession().getTransaction().commit();
  }
 catch (  Exception ex) {
    HibernateUtil.getSessionFactory().getCurrentSession().getTransaction().rollback();
    throw new ServletException(ex);
  }
}
