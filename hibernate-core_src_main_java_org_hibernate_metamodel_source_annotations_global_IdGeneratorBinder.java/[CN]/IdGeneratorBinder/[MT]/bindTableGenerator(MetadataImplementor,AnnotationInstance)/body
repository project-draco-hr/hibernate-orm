{
  String name=JandexHelper.getValue(generator,"name",String.class);
  Map<String,String> parameterMap=new HashMap<String,String>();
  addStringParameter(generator,"catalog",parameterMap,PersistentIdentifierGenerator.CATALOG);
  addStringParameter(generator,"schema",parameterMap,PersistentIdentifierGenerator.SCHEMA);
  boolean useNewIdentifierGenerators=metadata.getOptions().useNewIdentifierGenerators();
  String strategy=EnumConversionHelper.generationTypeToGeneratorStrategyName(GenerationType.TABLE,useNewIdentifierGenerators);
  if (useNewIdentifierGenerators) {
    parameterMap.put(TableGenerator.CONFIG_PREFER_SEGMENT_PER_ENTITY,"true");
    addStringParameter(generator,"table",parameterMap,TableGenerator.TABLE_PARAM);
    addStringParameter(generator,"pkColumnName",parameterMap,TableGenerator.SEGMENT_COLUMN_PARAM);
    addStringParameter(generator,"pkColumnValue",parameterMap,TableGenerator.SEGMENT_VALUE_PARAM);
    addStringParameter(generator,"valueColumnName",parameterMap,TableGenerator.VALUE_COLUMN_PARAM);
    parameterMap.put(TableGenerator.INCREMENT_PARAM,String.valueOf(JandexHelper.getValue(generator,"allocationSize",String.class)));
    parameterMap.put(TableGenerator.INITIAL_PARAM,String.valueOf(JandexHelper.getValue(generator,"initialValue",String.class) + 1));
  }
 else {
    addStringParameter(generator,"table",parameterMap,MultipleHiLoPerTableGenerator.ID_TABLE);
    addStringParameter(generator,"pkColumnName",parameterMap,MultipleHiLoPerTableGenerator.PK_COLUMN_NAME);
    addStringParameter(generator,"pkColumnValue",parameterMap,MultipleHiLoPerTableGenerator.PK_VALUE_NAME);
    addStringParameter(generator,"valueColumnName",parameterMap,MultipleHiLoPerTableGenerator.VALUE_COLUMN_NAME);
    parameterMap.put(TableHiLoGenerator.MAX_LO,String.valueOf(JandexHelper.getValue(generator,"allocationSize",Integer.class) - 1));
  }
  if (JandexHelper.getValue(generator,"uniqueConstraints",AnnotationInstance[].class).length > 0) {
    LOG.ignoringTableGeneratorConstraints(name);
  }
  metadata.addIdGenerator(new IdGenerator(name,strategy,parameterMap));
  LOG.tracef("Add table generator with name: %s",name);
}
