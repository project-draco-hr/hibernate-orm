{
  EntityManager em=getOrCreateEntityManager();
  em.getTransaction().begin();
  QueryImpl query=em.createNativeQuery("select * from lockable l").unwrap(QueryImpl.class);
  org.hibernate.internal.SQLQueryImpl hibernateQuery=(org.hibernate.internal.SQLQueryImpl)query.getHibernateQuery();
  try {
    query.setLockMode(LockModeType.READ);
    fail("Should have failed");
  }
 catch (  IllegalStateException expected) {
  }
  query.setHint(QueryHints.HINT_NATIVE_LOCKMODE,LockModeType.READ);
  assertEquals(LockMode.OPTIMISTIC,hibernateQuery.getLockOptions().getLockMode());
  assertNull(hibernateQuery.getLockOptions().getAliasSpecificLockMode("l"));
  assertEquals(LockMode.OPTIMISTIC,hibernateQuery.getLockOptions().getEffectiveLockMode("l"));
  query.setHint(AvailableSettings.ALIAS_SPECIFIC_LOCK_MODE + ".l",LockModeType.PESSIMISTIC_WRITE);
  assertEquals(LockMode.OPTIMISTIC,hibernateQuery.getLockOptions().getLockMode());
  assertEquals(LockMode.PESSIMISTIC_WRITE,hibernateQuery.getLockOptions().getAliasSpecificLockMode("l"));
  assertEquals(LockMode.PESSIMISTIC_WRITE,hibernateQuery.getLockOptions().getEffectiveLockMode("l"));
  em.getTransaction().commit();
  em.close();
}
