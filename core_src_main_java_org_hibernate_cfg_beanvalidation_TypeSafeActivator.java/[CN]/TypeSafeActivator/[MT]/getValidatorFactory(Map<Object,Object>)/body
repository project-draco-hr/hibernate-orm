{
  ValidatorFactory factory=null;
  if (properties != null) {
    Object unsafeProperty=properties.get(FACTORY_PROPERTY);
    if (unsafeProperty != null) {
      try {
        factory=ValidatorFactory.class.cast(unsafeProperty);
      }
 catch (      ClassCastException e) {
        throw new HibernateException("Property " + FACTORY_PROPERTY + " should contain an object of type "+ ValidatorFactory.class.getName());
      }
    }
  }
  if (factory == null) {
    try {
      factory=Validation.buildDefaultValidatorFactory();
    }
 catch (    Exception e) {
      throw new HibernateException("Unable to build the default ValidatorFactory",e);
    }
  }
  return factory;
}
