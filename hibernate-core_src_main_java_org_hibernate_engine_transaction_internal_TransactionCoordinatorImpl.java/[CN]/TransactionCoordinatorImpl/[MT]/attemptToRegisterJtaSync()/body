{
  if (synchronizationRegistered) {
    return;
  }
  if (currentHibernateTransaction.isInitiator()) {
    return;
  }
  if (!transactionContext.shouldAutoJoinTransaction()) {
    if (currentHibernateTransaction.getJoinStatus() != JoinStatus.MARKED_FOR_JOINED) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Skipping JTA sync registration due to auto join checking");
      }
      return;
    }
  }
  JtaPlatform jtaPlatform=getTransactionEnvironment().getJtaPlatform();
  if (jtaPlatform == null) {
    return;
  }
  if (!jtaPlatform.canRegisterSynchronization()) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("registered JTA platform says we cannot currently resister synchronization; skipping");
    }
    return;
  }
  if (!transactionFactory().isJoinableJtaTransaction(this,currentHibernateTransaction)) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("TransactionFactory reported no JTA transaction to join; skipping Synchronization registration");
    }
    return;
  }
  jtaPlatform.registerSynchronization(new RegisteredSynchronization(getSynchronizationCallbackCoordinator()));
  synchronizationRegistered=true;
  if (LOG.isDebugEnabled()) {
    LOG.debug("successfully registered Synchronization");
  }
}
