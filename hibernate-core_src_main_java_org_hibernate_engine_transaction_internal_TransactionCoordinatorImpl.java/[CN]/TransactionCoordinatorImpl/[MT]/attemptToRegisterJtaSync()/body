{
  if (synchronizationRegistered) {
    return;
  }
  if (currentHibernateTransaction.isInitiator()) {
    return;
  }
  if (currentHibernateTransaction.getJoinStatus() != JoinStatus.JOINED) {
    if (!transactionContext.shouldAutoJoinTransaction()) {
      if (currentHibernateTransaction.getJoinStatus() != JoinStatus.MARKED_FOR_JOINED) {
        LOG.debug("Skipping JTA sync registration due to auto join checking");
        return;
      }
    }
  }
  JtaPlatform jtaPlatform=getTransactionEnvironment().getJtaPlatform();
  if (jtaPlatform == null) {
    return;
  }
  if (!jtaPlatform.canRegisterSynchronization()) {
    LOG.trace("registered JTA platform says we cannot currently resister synchronization; skipping");
    return;
  }
  if (!transactionFactory().isJoinableJtaTransaction(this,currentHibernateTransaction)) {
    LOG.trace("TransactionFactory reported no JTA transaction to join; skipping Synchronization registration");
    return;
  }
  jtaPlatform.registerSynchronization(new RegisteredSynchronization(getSynchronizationCallbackCoordinator()));
  synchronizationRegistered=true;
  LOG.debug("successfully registered Synchronization");
}
