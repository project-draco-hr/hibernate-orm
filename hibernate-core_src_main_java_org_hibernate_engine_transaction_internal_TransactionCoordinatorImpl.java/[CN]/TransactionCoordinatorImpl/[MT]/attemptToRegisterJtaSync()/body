{
  if (synchronizationRegistered) {
    return;
  }
  final JtaPlatform jtaPlatform=getTransactionEnvironment().getJtaPlatform();
  if (jtaPlatform == null) {
    return;
  }
  if (currentHibernateTransaction.isInitiator()) {
    return;
  }
  final JoinStatus joinStatus=currentHibernateTransaction.getJoinStatus();
  if (joinStatus != JoinStatus.JOINED) {
    if (!transactionContext.shouldAutoJoinTransaction()) {
      if (joinStatus != JoinStatus.MARKED_FOR_JOINED) {
        if (isDebugging) {
          LOG.debug("Skipping JTA sync registration due to auto join checking");
        }
        return;
      }
    }
  }
  if (!jtaPlatform.canRegisterSynchronization()) {
    if (isTracing) {
      LOG.trace("registered JTA platform says we cannot currently register synchronization; skipping");
    }
    return;
  }
  if (!transactionFactory().isJoinableJtaTransaction(this,currentHibernateTransaction)) {
    if (isTracing) {
      LOG.trace("TransactionFactory reported no JTA transaction to join; skipping Synchronization registration");
    }
    return;
  }
  jtaPlatform.registerSynchronization(new RegisteredSynchronization(getSynchronizationCallbackCoordinator()));
  getSynchronizationCallbackCoordinator().synchronizationRegistered();
  synchronizationRegistered=true;
  if (isDebugging) {
    LOG.debug("successfully registered Synchronization");
  }
}
