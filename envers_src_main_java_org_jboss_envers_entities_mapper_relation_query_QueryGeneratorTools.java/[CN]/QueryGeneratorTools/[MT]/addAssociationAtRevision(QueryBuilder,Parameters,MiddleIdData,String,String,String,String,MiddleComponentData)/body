{
  QueryBuilder maxEeRevQb=qb.newSubQueryBuilder(versionsMiddleEntityName,"ee2");
  maxEeRevQb.addProjection("max",revisionPropertyPath,false);
  Parameters maxEeRevQbParameters=maxEeRevQb.getRootParameters();
  maxEeRevQbParameters.addWhereWithNamedParam(revisionPropertyPath,"<=","revision");
  String ee2OriginalIdPropertyPath="ee2." + originalIdPropertyName;
  referencingIdData.getPrefixedMapper().addIdsEqualToQuery(maxEeRevQbParameters,eeOriginalIdPropertyPath,ee2OriginalIdPropertyPath);
  for (  MiddleComponentData componentData : componentDatas) {
    componentData.getComponentMapper().addMiddleEqualToQuery(maxEeRevQbParameters,eeOriginalIdPropertyPath,ee2OriginalIdPropertyPath);
  }
  rootParameters.addWhere(revisionPropertyPath,"=",maxEeRevQb);
}
