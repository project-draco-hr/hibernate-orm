{
  final EventSource session=event.getSession();
  final SessionFactoryImplementor factory=session.getFactory();
  final EntityPersister subclassPersister;
  if (LOG.isTraceEnabled()) {
    LOG.tracef("Converting second-level cache entry [%s] into entity : %s",entry,MessageHelper.infoString(persister,entityId,factory));
  }
  final Object entity;
  subclassPersister=factory.getEntityPersister(entry.getSubclass());
  final Object optionalObject=event.getInstanceToLoad();
  entity=optionalObject == null ? session.instantiate(subclassPersister,entityId) : optionalObject;
  TwoPhaseLoad.addUninitializedCachedEntity(entityKey,entity,subclassPersister,LockMode.NONE,entry.getVersion(),session);
  final PersistenceContext persistenceContext=session.getPersistenceContext();
  final Object[] values;
  final Object version;
  final boolean isReadOnly;
  final Type[] types=subclassPersister.getPropertyTypes();
  values=((StandardCacheEntryImpl)entry).assemble(entity,entityId,subclassPersister,session.getInterceptor(),session);
  if (((StandardCacheEntryImpl)entry).isDeepCopyNeeded()) {
    TypeHelper.deepCopy(values,types,subclassPersister.getPropertyUpdateability(),values,session);
  }
  version=Versioning.getVersion(values,subclassPersister);
  LOG.tracef("Cached Version : %s",version);
  final Object proxy=persistenceContext.getProxy(entityKey);
  if (proxy != null) {
    isReadOnly=((HibernateProxy)proxy).getHibernateLazyInitializer().isReadOnly();
  }
 else {
    isReadOnly=session.isDefaultReadOnly();
  }
  persistenceContext.addEntry(entity,(isReadOnly ? Status.READ_ONLY : Status.MANAGED),values,null,entityId,version,LockMode.NONE,true,subclassPersister,false);
  subclassPersister.afterInitialize(entity,session);
  persistenceContext.initializeNonLazyCollections();
  PostLoadEvent postLoadEvent=event.getPostLoadEvent().setEntity(entity).setId(entityId).setPersister(persister);
  for (  PostLoadEventListener listener : postLoadEventListeners(session)) {
    listener.onPostLoad(postLoadEvent);
  }
  return entity;
}
