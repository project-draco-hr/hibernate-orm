{
  if (currentElements.size() == 0)   return oldElements;
  if (oldElements.size() == 0)   return oldElements;
  Type idType=session.getFactory().getEntityPersister(entityName).getIdentifierType();
  Collection res=new ArrayList();
  java.util.Set currentIds=new HashSet();
  java.util.Set currentSaving=new IdentitySet();
  for (Iterator it=currentElements.iterator(); it.hasNext(); ) {
    Object current=it.next();
    if (current != null && ForeignKeys.isNotTransient(entityName,current,null,session)) {
      EntityEntry ee=session.getPersistenceContext().getEntry(current);
      if (ee != null && ee.getStatus() == Status.SAVING) {
        currentSaving.add(current);
      }
 else {
        Serializable currentId=ForeignKeys.getEntityIdentifierIfNotUnsaved(entityName,current,session);
        currentIds.add(new TypedValue(idType,currentId,session.getEntityMode()));
      }
    }
  }
  for (Iterator it=oldElements.iterator(); it.hasNext(); ) {
    Object old=it.next();
    if (!currentSaving.contains(old)) {
      Serializable oldId=ForeignKeys.getEntityIdentifierIfNotUnsaved(entityName,old,session);
      if (!currentIds.contains(new TypedValue(idType,oldId,session.getEntityMode()))) {
        res.add(old);
      }
    }
  }
  return res;
}
