{
  Type type=value.getType();
  if (type instanceof ManyToOneType) {
    String prefixRelated=prefix + "_";
    String referencedEntityName=getReferencedEntityName(value);
    IdMappingData referencedIdMapping=mainGenerator.getReferencedIdMappingData(referencingEntityName,referencedEntityName,propertyAuditingData,true);
    if (xmlMapping != null) {
      addRelatedToXmlMapping(xmlMapping,prefixRelated,joinColumns != null && joinColumns.length > 0 ? MetadataTools.getColumnNameIterator(joinColumns) : MetadataTools.getColumnNameIterator(value.getColumnIterator()),referencedIdMapping);
    }
    MiddleIdData referencedIdData=createMiddleIdData(referencedIdMapping,prefixRelated,referencedEntityName);
    queryGeneratorBuilder.addRelation(referencedIdData);
    return new MiddleComponentData(new MiddleRelatedComponentMapper(referencedIdData),queryGeneratorBuilder.getCurrentIndex());
  }
 else {
    boolean mapped=mainGenerator.getBasicMetadataGenerator().addBasic(xmlMapping,new PropertyAuditingData(prefix,"field",ModificationStore.FULL,RelationTargetAuditMode.AUDITED,null,null),value,null,true,true);
    if (mapped) {
      return new MiddleComponentData(new MiddleSimpleComponentMapper(mainGenerator.getVerEntCfg(),prefix),0);
    }
 else {
      mainGenerator.throwUnsupportedTypeException(type,referencingEntityName,propertyName);
      throw new AssertionError();
    }
  }
}
