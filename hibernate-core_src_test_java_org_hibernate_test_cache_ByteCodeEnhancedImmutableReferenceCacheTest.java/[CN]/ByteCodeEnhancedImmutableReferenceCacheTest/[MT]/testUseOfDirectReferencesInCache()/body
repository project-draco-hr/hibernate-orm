{
  EntityPersister persister=(EntityPersister)sessionFactory().getClassMetadata(MyEnhancedReferenceData.class);
  assertFalse(persister.isMutable());
  assertTrue(persister.buildCacheEntry(null,null,null,null).isReferenceEntry());
  assertFalse(persister.hasProxy());
  final MyEnhancedReferenceData myReferenceData=new MyEnhancedReferenceData(1,"first item","abc");
  Session s=openSession();
  s.beginTransaction();
  s.save(myReferenceData);
  s.getTransaction().commit();
  s.close();
  assertNotNull(myReferenceData.$$_hibernate_getEntityEntry());
  s=openSession();
  s.beginTransaction();
  MyEnhancedReferenceData loaded=(MyEnhancedReferenceData)s.load(MyEnhancedReferenceData.class,1);
  s.getTransaction().commit();
  s.close();
  assertTrue("The two instances were different references",myReferenceData == loaded);
  s=openSession();
  s.beginTransaction();
  MyEnhancedReferenceData queried=(MyEnhancedReferenceData)s.createQuery("from MyEnhancedReferenceData").setCacheable(true).list().get(0);
  s.getTransaction().commit();
  s.close();
  assertTrue("The two instances were different references",myReferenceData == queried);
  s=openSession();
  s.beginTransaction();
  s.delete(myReferenceData);
  s.getTransaction().commit();
  s.close();
}
