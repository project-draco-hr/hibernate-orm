{
  Element acct=DocumentFactory.getInstance().createElement("account");
  acct.addAttribute("id","abc123");
  acct.addElement("balance").setText("123.45");
  Element cust=acct.addElement("customer");
  cust.addAttribute("id","xyz123");
  Element foo1=cust.addElement("stuff").addElement("foo");
  foo1.setText("foo");
  foo1.addAttribute("bar","x");
  Element foo2=cust.element("stuff").addElement("foo");
  foo2.setText("bar");
  foo2.addAttribute("bar","y");
  cust.addElement("amount").setText("45");
  cust.setText("An example customer");
  Element name=cust.addElement("name");
  name.addElement("first").setText("Gavin");
  name.addElement("last").setText("King");
  print(acct);
  Element loc=DocumentFactory.getInstance().createElement("location");
  loc.addElement("address").setText("Karbarook Avenue");
  Session s=openSession();
  Transaction t=s.beginTransaction();
  s.persist("Location",loc);
  cust.addElement("location").addAttribute("id",loc.attributeValue("id"));
  s.persist("Account",acct);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  cust=(Element)s.get("Customer","xyz123");
  print(cust);
  assertEquals("Incorrect stuff-map size",2,cust.element("stuff").elements("foo").size());
  Element stuffElement=(Element)cust.element("stuff").elements("foo").get(0);
  assertNotNull("No map-key value present",stuffElement.attribute("bar"));
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  s.delete("Account",acct);
  s.delete("Location",loc);
  t.commit();
  s.close();
}
