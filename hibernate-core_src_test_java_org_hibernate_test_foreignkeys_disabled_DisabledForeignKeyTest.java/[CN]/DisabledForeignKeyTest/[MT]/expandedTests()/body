{
  StandardServiceRegistryBuilder registryBuilder=new StandardServiceRegistryBuilder();
  StandardServiceRegistry standardRegistry=registryBuilder.build();
  try {
    final MetadataSources sources=new MetadataSources(standardRegistry);
    sources.addAnnotatedClass(ManyToManyOwner.class);
    sources.addAnnotatedClass(ManyToManyTarget.class);
    final MetadataImplementor metadata=(MetadataImplementor)sources.buildMetadata();
    metadata.validate();
    new SchemaExport().execute(EnumSet.of(TargetType.DATABASE),SchemaExport.Action.BOTH,metadata);
    try {
      new SchemaUpdate().execute(EnumSet.of(TargetType.DATABASE),metadata);
    }
  finally {
      new SchemaExport().execute(EnumSet.of(TargetType.DATABASE),SchemaExport.Action.DROP,metadata);
    }
  }
  finally {
    StandardServiceRegistryBuilder.destroy(standardRegistry);
  }
}
