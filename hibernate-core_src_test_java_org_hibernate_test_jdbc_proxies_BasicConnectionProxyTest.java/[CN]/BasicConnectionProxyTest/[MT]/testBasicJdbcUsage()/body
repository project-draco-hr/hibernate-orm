{
  LogicalConnectionImpl logicalConnection=new LogicalConnectionImpl(null,ConnectionReleaseMode.AFTER_TRANSACTION,services,new JdbcConnectionAccessImpl(services.getConnectionProvider()));
  Connection proxiedConnection=ProxyBuilder.buildConnection(logicalConnection);
  try {
    Statement statement=proxiedConnection.createStatement();
    statement.execute("drop table SANDBOX_JDBC_TST if exists");
    statement.execute("create table SANDBOX_JDBC_TST ( ID integer, NAME varchar(100) )");
    assertTrue(logicalConnection.getResourceRegistry().hasRegisteredResources());
    assertTrue(logicalConnection.isPhysicallyConnected());
    statement.close();
    assertFalse(logicalConnection.getResourceRegistry().hasRegisteredResources());
    assertTrue(logicalConnection.isPhysicallyConnected());
    PreparedStatement ps=proxiedConnection.prepareStatement("insert into SANDBOX_JDBC_TST( ID, NAME ) values ( ?, ? )");
    ps.setLong(1,1);
    ps.setString(2,"name");
    ps.execute();
    ps=proxiedConnection.prepareStatement("select * from SANDBOX_JDBC_TST");
    ps.executeQuery();
    assertTrue(logicalConnection.getResourceRegistry().hasRegisteredResources());
  }
 catch (  SQLException e) {
    fail("incorrect exception type : sqlexception");
  }
 finally {
    logicalConnection.close();
  }
  assertFalse(logicalConnection.getResourceRegistry().hasRegisteredResources());
}
