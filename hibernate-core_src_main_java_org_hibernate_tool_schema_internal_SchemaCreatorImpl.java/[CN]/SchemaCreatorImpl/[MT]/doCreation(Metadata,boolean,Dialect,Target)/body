{
  boolean tryToCreateCatalogs=false;
  boolean tryToCreateSchemas=false;
  if (createNamespaces) {
    if (dialect.canCreateSchema()) {
      tryToCreateSchemas=true;
    }
    if (dialect.canCreateCatalog()) {
      tryToCreateCatalogs=true;
    }
  }
  final Database database=metadata.getDatabase();
  final JdbcEnvironment jdbcEnvironment=database.getJdbcEnvironment();
  for (  Target target : targets) {
    target.prepare();
  }
  final Set<String> exportIdentifiers=new HashSet<String>(50);
  if (tryToCreateCatalogs || tryToCreateSchemas) {
    Set<Identifier> exportedCatalogs=new HashSet<Identifier>();
    for (    Namespace namespace : database.getNamespaces()) {
      if (!filter.includeNamespace(namespace)) {
        continue;
      }
      if (tryToCreateCatalogs) {
        final Identifier catalogLogicalName=namespace.getName().getCatalog();
        final Identifier catalogPhysicalName=namespace.getPhysicalName().getCatalog();
        if (catalogPhysicalName != null && !exportedCatalogs.contains(catalogLogicalName)) {
          applySqlStrings(targets,dialect.getCreateCatalogCommand(catalogPhysicalName.render(dialect)));
          exportedCatalogs.add(catalogLogicalName);
        }
      }
      if (tryToCreateSchemas && namespace.getPhysicalName().getSchema() != null) {
        applySqlStrings(targets,dialect.getCreateSchemaCommand(namespace.getPhysicalName().getSchema().render(dialect)));
      }
    }
  }
  for (  AuxiliaryDatabaseObject auxiliaryDatabaseObject : database.getAuxiliaryDatabaseObjects()) {
    if (!auxiliaryDatabaseObject.beforeTablesOnCreation()) {
      continue;
    }
    if (auxiliaryDatabaseObject.appliesToDialect(dialect)) {
      checkExportIdentifier(auxiliaryDatabaseObject,exportIdentifiers);
      applySqlStrings(targets,dialect.getAuxiliaryDatabaseObjectExporter().getSqlCreateStrings(auxiliaryDatabaseObject,metadata));
    }
  }
  for (  Namespace namespace : database.getNamespaces()) {
    if (!filter.includeNamespace(namespace)) {
      continue;
    }
    for (    Sequence sequence : namespace.getSequences()) {
      if (!filter.includeSequence(sequence)) {
        continue;
      }
      checkExportIdentifier(sequence,exportIdentifiers);
      applySqlStrings(targets,dialect.getCreateSequenceStrings(jdbcEnvironment.getQualifiedObjectNameFormatter().format(sequence.getName(),dialect),sequence.getInitialValue(),sequence.getIncrementSize()));
    }
    for (    Table table : namespace.getTables()) {
      if (!table.isPhysicalTable()) {
        continue;
      }
      if (!filter.includeTable(table)) {
        continue;
      }
      checkExportIdentifier(table,exportIdentifiers);
      applySqlStrings(targets,dialect.getTableExporter().getSqlCreateStrings(table,metadata));
    }
    for (    Table table : namespace.getTables()) {
      final Iterator indexItr=table.getIndexIterator();
      while (indexItr.hasNext()) {
        final Index index=(Index)indexItr.next();
        checkExportIdentifier(index,exportIdentifiers);
        applySqlStrings(targets,dialect.getIndexExporter().getSqlCreateStrings(index,metadata));
      }
      final Iterator ukItr=table.getUniqueKeyIterator();
      while (ukItr.hasNext()) {
        final UniqueKey uniqueKey=(UniqueKey)ukItr.next();
        checkExportIdentifier(uniqueKey,exportIdentifiers);
        applySqlStrings(targets,dialect.getUniqueKeyExporter().getSqlCreateStrings(uniqueKey,metadata));
      }
    }
  }
  for (  Namespace namespace : database.getNamespaces()) {
    for (    Table table : namespace.getTables()) {
      final Iterator fkItr=table.getForeignKeyIterator();
      while (fkItr.hasNext()) {
        final ForeignKey foreignKey=(ForeignKey)fkItr.next();
        applySqlStrings(targets,dialect.getForeignKeyExporter().getSqlCreateStrings(foreignKey,metadata));
      }
    }
  }
  for (  AuxiliaryDatabaseObject auxiliaryDatabaseObject : database.getAuxiliaryDatabaseObjects()) {
    if (auxiliaryDatabaseObject.appliesToDialect(dialect) && !auxiliaryDatabaseObject.beforeTablesOnCreation()) {
      checkExportIdentifier(auxiliaryDatabaseObject,exportIdentifiers);
      applySqlStrings(targets,dialect.getAuxiliaryDatabaseObjectExporter().getSqlCreateStrings(auxiliaryDatabaseObject,metadata));
    }
  }
  for (  InitCommand initCommand : database.getInitCommands()) {
    applySqlStrings(targets,initCommand.getInitCommands());
  }
  for (  Target target : targets) {
    target.release();
  }
}
