{
  final QueryableCollection queryableCollection=(QueryableCollection)fetch.getCollectionPersister();
  final Joinable joinableCollection=(Joinable)fetch.getCollectionPersister();
  if (fetch.getCollectionPersister().isManyToMany()) {
    final String ownerTableAlias=resolveLhsTableAlias(fetchOwner,fetch,aliasResolutionContext);
    final String collectionTableAlias=aliasResolutionContext.resolveAliases(fetch).getCollectionTableAlias();
    final String elementTableAlias=aliasResolutionContext.resolveAliases(fetch).getElementTableAlias();
{
      final String filterFragment=((Joinable)fetch.getCollectionPersister()).filterFragment(collectionTableAlias,buildingParameters.getQueryInfluencers().getEnabledFilters());
      joinFragment.addJoin(joinableCollection.getTableName(),collectionTableAlias,StringHelper.qualify(ownerTableAlias,extractJoinable(fetchOwner).getKeyColumnNames()),queryableCollection.getKeyColumnNames(),fetch.isNullable() ? JoinType.LEFT_OUTER_JOIN : JoinType.INNER_JOIN,filterFragment);
      joinFragment.addJoins(joinableCollection.fromJoinFragment(collectionTableAlias,false,true),joinableCollection.whereJoinFragment(collectionTableAlias,false,true));
      selectStatementBuilder.appendSelectClauseFragment(joinableCollection.selectFragment((Joinable)queryableCollection.getElementPersister(),ownerTableAlias,collectionTableAlias,aliasResolutionContext.resolveAliases(fetch).getEntityElementColumnAliases().getSuffix(),aliasResolutionContext.resolveAliases(fetch).getCollectionColumnAliases().getSuffix(),true));
    }
{
      final String additionalJoinConditions=resolveAdditionalJoinCondition(factory,elementTableAlias,fetchOwner,fetch,buildingParameters.getQueryInfluencers(),aliasResolutionContext);
      final String manyToManyFilter=fetch.getCollectionPersister().getManyToManyFilterFragment(collectionTableAlias,buildingParameters.getQueryInfluencers().getEnabledFilters());
      final String condition;
      if ("".equals(manyToManyFilter)) {
        condition=additionalJoinConditions;
      }
 else       if ("".equals(additionalJoinConditions)) {
        condition=manyToManyFilter;
      }
 else {
        condition=additionalJoinConditions + " and " + manyToManyFilter;
      }
      final OuterJoinLoadable elementPersister=(OuterJoinLoadable)queryableCollection.getElementPersister();
      addJoins(joinFragment,elementPersister,JoinType.LEFT_OUTER_JOIN,elementTableAlias,elementPersister.getIdentifierColumnNames(),StringHelper.qualify(collectionTableAlias,queryableCollection.getElementColumnNames()),condition);
      final CollectionReferenceAliases aliases=aliasResolutionContext.resolveAliases(fetch);
      selectStatementBuilder.appendSelectClauseFragment(elementPersister.selectFragment(aliases.getElementTableAlias(),aliases.getEntityElementColumnAliases().getSuffix()));
    }
    final String manyToManyOrdering=queryableCollection.getManyToManyOrderByString(collectionTableAlias);
    if (StringHelper.isNotEmpty(manyToManyOrdering)) {
      selectStatementBuilder.appendOrderByFragment(manyToManyOrdering);
    }
    final String ordering=queryableCollection.getSQLOrderByString(collectionTableAlias);
    if (StringHelper.isNotEmpty(ordering)) {
      selectStatementBuilder.appendOrderByFragment(ordering);
    }
  }
 else {
    final String rhsTableAlias=aliasResolutionContext.resolveAliases(fetch).getElementTableAlias();
    final String[] rhsColumnNames=JoinHelper.getRHSColumnNames(fetch.getFetchedType(),factory);
    final String lhsTableAlias=resolveLhsTableAlias(fetchOwner,fetch,aliasResolutionContext);
    final String[] aliasedLhsColumnNames=fetch.toSqlSelectFragments(lhsTableAlias);
    final String on=resolveAdditionalJoinCondition(factory,rhsTableAlias,fetchOwner,fetch,buildingParameters.getQueryInfluencers(),aliasResolutionContext);
    addJoins(joinFragment,joinableCollection,fetch.isNullable() ? JoinType.LEFT_OUTER_JOIN : JoinType.INNER_JOIN,rhsTableAlias,rhsColumnNames,aliasedLhsColumnNames,on);
    selectStatementBuilder.appendSelectClauseFragment(queryableCollection.selectFragment(rhsTableAlias,aliasResolutionContext.resolveAliases(fetch).getCollectionColumnAliases().getSuffix()));
    if (fetch.getCollectionPersister().isOneToMany()) {
      final CollectionReferenceAliases aliases=aliasResolutionContext.resolveAliases(fetch);
      final OuterJoinLoadable elementPersister=(OuterJoinLoadable)queryableCollection.getElementPersister();
      selectStatementBuilder.appendSelectClauseFragment(elementPersister.selectFragment(aliases.getElementTableAlias(),aliases.getEntityElementColumnAliases().getSuffix()));
    }
    final String ordering=queryableCollection.getSQLOrderByString(rhsTableAlias);
    if (StringHelper.isNotEmpty(ordering)) {
      selectStatementBuilder.appendOrderByFragment(ordering);
    }
  }
}
