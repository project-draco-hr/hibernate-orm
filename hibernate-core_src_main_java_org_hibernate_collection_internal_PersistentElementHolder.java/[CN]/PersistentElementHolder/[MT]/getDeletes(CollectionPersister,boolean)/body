{
  final Type elementType=persister.getElementType();
  final ArrayList snapshot=(ArrayList)getSnapshot();
  final List elements=element.elements(persister.getElementNodeName());
  final ArrayList result=new ArrayList();
  for (int i=0; i < snapshot.size(); i++) {
    final Object old=snapshot.get(i);
    if (i >= elements.size()) {
      result.add(old);
    }
 else {
      final Element elem=(Element)elements.get(i);
      final Object object=elementType.fromXMLNode(elem,persister.getFactory());
      if (elementType.isDirty(old,object,getSession())) {
        result.add(old);
      }
    }
  }
  return result.iterator();
}
