{
  if (value == null) {
    return "null";
  }
  EntityPersister persister=factory.getEntityPersister(associatedEntityName);
  StringBuilder result=new StringBuilder().append(associatedEntityName);
  if (persister.hasIdentifierProperty()) {
    final EntityMode entityMode=persister.getEntityMode();
    final Serializable id;
    if (entityMode == null) {
      if (isEmbeddedInXML) {
        throw new ClassCastException(value.getClass().getName());
      }
      id=(Serializable)value;
    }
 else     if (value instanceof HibernateProxy) {
      HibernateProxy proxy=(HibernateProxy)value;
      id=proxy.getHibernateLazyInitializer().getIdentifier();
    }
 else {
      id=persister.getIdentifier(value);
    }
    result.append('#').append(persister.getIdentifierType().toLoggableString(id,factory));
  }
  return result.toString();
}
