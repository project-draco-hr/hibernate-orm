{
  EntityPersister persister=factory.getEntityPersister(associatedEntityName);
  if (!persister.canExtractIdOutOfEntity()) {
    return super.getHashCode(x,entityMode);
  }
  final Serializable id;
  if (x instanceof HibernateProxy) {
    id=((HibernateProxy)x).getHibernateLazyInitializer().getIdentifier();
  }
 else {
    final Class mappedClass=persister.getMappedClass(entityMode);
    if (mappedClass.isAssignableFrom(x.getClass())) {
      id=persister.getIdentifier(x,entityMode);
    }
 else {
      id=(Serializable)x;
    }
  }
  return persister.getIdentifierType().getHashCode(id,entityMode,factory);
}
