{
  final BootstrapServiceRegistryBuilder bsrBuilder=new BootstrapServiceRegistryBuilder();
  bsrBuilder.with(new JpaIntegrator());
  final IntegratorProvider integratorProvider=(IntegratorProvider)integrationSettings.get(INTEGRATOR_PROVIDER);
  if (integratorProvider != null) {
    for (    Integrator integrator : integratorProvider.getIntegrators()) {
      bsrBuilder.with(integrator);
    }
  }
  final StrategyRegistrationProviderList strategyRegistrationProviderList=(StrategyRegistrationProviderList)integrationSettings.get(STRATEGY_REGISTRATION_PROVIDERS);
  if (strategyRegistrationProviderList != null) {
    for (    StrategyRegistrationProvider strategyRegistrationProvider : strategyRegistrationProviderList.getStrategyRegistrationProviders()) {
      bsrBuilder.withStrategySelectors(strategyRegistrationProvider);
    }
  }
  if (persistenceUnit.getClassLoader() != null) {
    bsrBuilder.with(persistenceUnit.getClassLoader());
  }
  if (providedClassLoader != null) {
    bsrBuilder.with(providedClassLoader);
  }
  final ClassLoader appClassLoader=(ClassLoader)integrationSettings.get(org.hibernate.cfg.AvailableSettings.APP_CLASSLOADER);
  if (appClassLoader != null) {
    LOG.debugf("Found use of deprecated `%s` setting; use `%s` instead.",org.hibernate.cfg.AvailableSettings.APP_CLASSLOADER,org.hibernate.cfg.AvailableSettings.CLASSLOADERS);
  }
  final Object classLoadersSetting=integrationSettings.get(org.hibernate.cfg.AvailableSettings.CLASSLOADERS);
  if (classLoadersSetting != null) {
    if (java.util.Collection.class.isInstance(classLoadersSetting)) {
      for (      ClassLoader classLoader : (java.util.Collection<ClassLoader>)classLoadersSetting) {
        bsrBuilder.with(classLoader);
      }
    }
 else     if (classLoadersSetting.getClass().isArray()) {
      for (      ClassLoader classLoader : (ClassLoader[])classLoadersSetting) {
        bsrBuilder.with(classLoader);
      }
    }
 else     if (ClassLoader.class.isInstance(classLoadersSetting)) {
      bsrBuilder.with((ClassLoader)classLoadersSetting);
    }
  }
  return bsrBuilder.build();
}
