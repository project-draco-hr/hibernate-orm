{
  CacheManager localManager=ClusterAwareRegionFactory.getCacheManager(DualNodeTestCase.LOCAL);
  Cache localReplicatedCache=localManager.getCache("replicated-entity");
  CacheManager remoteManager=ClusterAwareRegionFactory.getCacheManager(DualNodeTestCase.REMOTE);
  Cache remoteReplicatedCache=remoteManager.getCache("replicated-entity");
  ClassLoader cl=Thread.currentThread().getContextClassLoader();
  Thread.currentThread().setContextClassLoader(cl.getParent());
  log.info("TCCL is " + cl.getParent());
  Account acct=new Account();
  acct.setAccountHolder(new AccountHolder());
  try {
    localReplicatedCache.put("isolated1",acct);
    remoteReplicatedCache.get("isolated1");
    fail("Should not have succeeded in putting acct -- classloader not isolated");
  }
 catch (  Exception e) {
    if (e.getCause() instanceof ClassNotFoundException) {
      log.info("Caught exception as desired",e);
    }
 else {
      throw new IllegalStateException("Unexpected exception",e);
    }
  }
  Thread.currentThread().setContextClassLoader(cl);
  log.info("TCCL is " + cl);
  localReplicatedCache.put("isolated2",acct);
  assertEquals(acct.getClass().getName(),remoteReplicatedCache.get("isolated2").getClass().getName());
}
