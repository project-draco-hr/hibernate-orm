{
  EntityPersister meta=criteriaQuery.getFactory().getEntityPersister(criteriaQuery.getEntityName(criteria));
  String[] propertyNames=meta.getPropertyNames();
  Type[] propertyTypes=meta.getPropertyTypes();
  Object[] values=meta.getPropertyValues(entity,getEntityMode(criteria,criteriaQuery));
  List list=new ArrayList();
  for (int i=0; i < propertyNames.length; i++) {
    Object value=values[i];
    Type type=propertyTypes[i];
    String name=propertyNames[i];
    boolean isPropertyIncluded=i != meta.getVersionProperty() && isPropertyIncluded(value,name,type);
    if (isPropertyIncluded) {
      if (propertyTypes[i].isComponentType()) {
        addComponentTypedValues(name,value,(AbstractComponentType)type,list,criteria,criteriaQuery);
      }
 else {
        addPropertyTypedValue(value,type,list);
      }
    }
  }
  return (TypedValue[])list.toArray(TYPED_VALUES);
}
