{
  if (!begun) {
    throw new TransactionException("Transaction not successfully started");
  }
  log.debug("commit");
  boolean flush=!transactionContext.isFlushModeNever() && !transactionContext.isFlushBeforeCompletionEnabled();
  if (flush) {
    transactionContext.managedFlush();
  }
  begun=false;
}
