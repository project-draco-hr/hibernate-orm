{
  Item item1=new Item();
  item1.setName("item1");
  Category category1=new Category();
  category1.setName("category1");
  item1.setCategory(category1);
  Hoarder hoarder=new Hoarder();
  hoarder.setName("joe");
  Session s=openSession();
  Transaction tx=session.beginTransaction();
  s.persist(item1);
  s.persist(hoarder);
  tx.commit();
  s.close();
  s=openSession();
  Item item1_1=(Item)s.get(Item.class,item1.getId());
  s.close();
  assertFalse(item1 == item1_1);
  assertTrue(item1.equals(item1_1));
  s=openSession();
  Item item1_2=(Item)s.get(Item.class,item1.getId());
  s.close();
  assertFalse(item1 == item1_2);
  assertTrue(item1.equals(item1_2));
  item1_1.setName("item1_1");
  item1_2.setName("item1_2");
  item1.getCategory().setExampleItem(item1_2);
  hoarder.getItems().add(item1);
  hoarder.setFavoriteItem(item1_1);
  hoarder.getFavoriteItem().getCategory();
  s=openSession();
  tx=s.beginTransaction();
  hoarder=(Hoarder)s.merge(hoarder);
  assertEquals(1,hoarder.getItems().size());
  assertSame(hoarder.getFavoriteItem(),hoarder.getItems().iterator().next());
  assertSame(hoarder.getFavoriteItem(),hoarder.getFavoriteItem().getCategory().getExampleItem());
  assertEquals(item1.getId(),hoarder.getFavoriteItem().getId());
  assertEquals(item1.getCategory(),hoarder.getFavoriteItem().getCategory());
  assertEquals(item1.getName(),hoarder.getFavoriteItem().getName());
  tx.commit();
  s.close();
  s=openSession();
  tx=s.beginTransaction();
  hoarder=(Hoarder)s.merge(hoarder);
  assertEquals(1,hoarder.getItems().size());
  assertSame(hoarder.getFavoriteItem(),hoarder.getItems().iterator().next());
  assertSame(hoarder.getFavoriteItem(),hoarder.getFavoriteItem().getCategory().getExampleItem());
  assertEquals(item1.getId(),hoarder.getFavoriteItem().getId());
  assertEquals(item1.getCategory(),hoarder.getFavoriteItem().getCategory());
  tx.commit();
  s.close();
  cleanup();
}
