{
  checkEntityManagerFactory();
  checkOpen();
  if (discardOnClose || !isTransactionInProgress()) {
    if (session != null) {
      session.close();
    }
  }
  open=false;
}
