{
  checkInitialized();
  if (queryableCollection == null) {
    return (PropertyMapping)persister;
  }
  if (queryableCollection.isManyToMany() && queryableCollection.hasIndex() && SPECIAL_MANY2MANY_TREATMENT_FUNCTION_NAMES.contains(propertyName)) {
    return new SpecialManyToManyCollectionPropertyMapping();
  }
  if (CollectionProperties.isCollectionProperty(propertyName)) {
    if (collectionPropertyMapping == null) {
      if (persister != null) {
        try {
          if (persister.getPropertyType(propertyName) != null) {
            return (PropertyMapping)persister;
          }
        }
 catch (        QueryException ignore) {
        }
      }
      collectionPropertyMapping=new CollectionPropertyMapping(queryableCollection);
    }
    return collectionPropertyMapping;
  }
  if (queryableCollection.getElementType().isAnyType()) {
    return queryableCollection;
  }
  if (queryableCollection.getElementType().isComponentType()) {
    if (propertyName.equals(EntityPersister.ENTITY_ID)) {
      return (PropertyMapping)queryableCollection.getOwnerEntityPersister();
    }
  }
  return queryableCollection;
}
