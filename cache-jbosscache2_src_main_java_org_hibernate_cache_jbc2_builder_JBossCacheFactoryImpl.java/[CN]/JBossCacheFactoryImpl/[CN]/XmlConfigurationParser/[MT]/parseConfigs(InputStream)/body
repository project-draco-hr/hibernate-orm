{
  Element root=XmlHelper.getDocumentRoot(stream);
  NodeList list=root.getElementsByTagName(CONFIG_ROOT);
  if (list == null || list.getLength() == 0)   throw new ConfigurationException("Can't find " + CONFIG_ROOT + " tag");
  Map result=new HashMap();
  for (int i=0; i < list.getLength(); i++) {
    org.w3c.dom.Node node=list.item(i);
    if (node.getNodeType() != org.w3c.dom.Node.ELEMENT_NODE) {
      continue;
    }
    Element element=(Element)node;
    String name=element.getAttribute(CONFIG_NAME);
    if (name == null || name.trim().length() == 0)     throw new ConfigurationException("Element " + element + " has no name attribute");
    result.put(name.trim(),element);
  }
  return result;
}
