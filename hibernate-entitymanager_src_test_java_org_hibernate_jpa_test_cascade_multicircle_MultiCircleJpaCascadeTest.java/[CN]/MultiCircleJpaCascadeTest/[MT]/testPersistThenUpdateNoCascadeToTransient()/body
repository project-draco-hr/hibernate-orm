{
  skipCleanup=true;
  c.getBCollection().clear();
  c.getDCollection().clear();
  EntityManager em=getOrCreateEntityManager();
  em.getTransaction().begin();
  em.persist(c);
  c.getBCollection().add(b);
  c.getDCollection().add(d);
  try {
    em.getTransaction().commit();
    fail("should have thrown IllegalStateException");
  }
 catch (  RollbackException ex) {
    assertTrue(ex.getCause() instanceof IllegalStateException);
    IllegalStateException ise=(IllegalStateException)ex.getCause();
    assertTrue(ise.getCause() instanceof TransactionException);
    Throwable cause=ise.getCause().getCause();
    assertTrue(cause instanceof TransientPropertyValueException);
    TransientPropertyValueException tpve=(TransientPropertyValueException)cause;
    assertEquals(E.class.getName(),tpve.getTransientEntityName());
    assertEquals(D.class.getName(),tpve.getPropertyOwnerEntityName());
    assertEquals("e",tpve.getPropertyName());
  }
  em.close();
}
