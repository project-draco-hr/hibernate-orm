{
  Configuration cfg=new Configuration();
  cfg.addAnnotatedClass(Card.class);
  cfg.addAnnotatedClass(CardField.class);
  cfg.addAnnotatedClass(Key.class);
  cfg.addAnnotatedClass(PrimaryKey.class);
  SessionFactoryImplementor sf=(SessionFactoryImplementor)cfg.buildSessionFactory();
  final OuterJoinLoadable cardPersister=(OuterJoinLoadable)sf.getClassMetadata(Card.class);
  doCompare(sf,cardPersister);
  final LoadPlan cardLoadPlan=LoadPlanStructureAssertionHelper.INSTANCE.buildLoadPlan(sf,cardPersister);
  assertEquals(LoadPlan.Disposition.ENTITY_LOADER,cardLoadPlan.getDisposition());
  assertEquals(1,cardLoadPlan.getReturns().size());
  final EntityReturn cardReturn=assertTyping(EntityReturn.class,cardLoadPlan.getReturns().get(0));
  assertEquals(0,cardReturn.getIdentifierDescription().getFetches().length);
  assertEquals(1,cardReturn.getFetches().length);
  final CollectionFetch fieldsFetch=assertTyping(CollectionFetch.class,cardReturn.getFetches()[0]);
  assertNotNull(fieldsFetch.getElementGraph());
  final EntityElementGraph fieldsElementElementGraph=assertTyping(EntityElementGraph.class,fieldsFetch.getElementGraph());
  assertEquals(0,fieldsElementElementGraph.getFetches().length);
  assertEquals(1,fieldsElementElementGraph.getIdentifierDescription().getFetches().length);
  final CompositeFetch fieldsElementCompositeIdFetch=assertTyping(CompositeFetch.class,fieldsElementElementGraph.getIdentifierDescription().getFetches()[0]);
  assertEquals(2,fieldsElementCompositeIdFetch.getFetches().length);
  BidirectionalEntityFetch circularCardFetch=assertTyping(BidirectionalEntityFetch.class,fieldsElementCompositeIdFetch.getFetches()[0]);
  assertSame(circularCardFetch.getTargetEntityReference(),cardReturn);
  EntityFetch keyFetch=assertTyping(EntityFetch.class,fieldsElementCompositeIdFetch.getFetches()[1]);
  assertEquals(Key.class.getName(),keyFetch.getEntityPersister().getEntityName());
  final EntityLoadQueryDetails queryDetails=Helper.INSTANCE.buildLoadQueryDetails(cardLoadPlan,sf);
  final ResultSetProcessorImpl resultSetProcessor=assertTyping(ResultSetProcessorImpl.class,queryDetails.getResultSetProcessor());
  final EntityLoadQueryDetails.EntityLoaderRowReader rowReader=assertTyping(EntityLoadQueryDetails.EntityLoaderRowReader.class,resultSetProcessor.getRowReader());
}
