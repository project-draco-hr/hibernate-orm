{
  int startOfSelect=sql.toLowerCase().indexOf("select");
  StringBuffer pagingSelect=new StringBuffer(sql.length() + 100).append(sql.substring(0,startOfSelect)).append("select * from ( select ").append(getRowNumber(sql));
  if (hasDistinct(sql)) {
    pagingSelect.append(" row_.* from ( ").append(sql.substring(startOfSelect)).append(" ) as row_");
  }
 else {
    pagingSelect.append(sql.substring(startOfSelect + 6));
  }
  pagingSelect.append(" ) as temp_ where rownumber_ ");
  if (hasOffset) {
    pagingSelect.append("between ?+1 and ?");
  }
 else {
    pagingSelect.append("<= ?");
  }
  return pagingSelect.toString();
}
