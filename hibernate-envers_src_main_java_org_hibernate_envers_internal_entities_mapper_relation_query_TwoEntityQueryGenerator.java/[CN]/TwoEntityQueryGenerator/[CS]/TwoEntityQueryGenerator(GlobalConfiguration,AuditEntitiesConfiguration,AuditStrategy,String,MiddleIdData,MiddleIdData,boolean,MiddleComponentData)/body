{
  super(verEntCfg,referencingIdData,revisionTypeInId);
  String revisionPropertyPath=verEntCfg.getRevisionNumberPath();
  String originalIdPropertyName=verEntCfg.getOriginalIdPropName();
  String eeOriginalIdPropertyPath=MIDDLE_ENTITY_ALIAS + "." + originalIdPropertyName;
  QueryBuilder qb=new QueryBuilder(versionsMiddleEntityName,MIDDLE_ENTITY_ALIAS);
  qb.addFrom(referencedIdData.getAuditEntityName(),REFERENCED_ENTITY_ALIAS);
  qb.addProjection("new list",MIDDLE_ENTITY_ALIAS + ", " + REFERENCED_ENTITY_ALIAS,false,false);
  Parameters rootParameters=qb.getRootParameters();
  referencedIdData.getPrefixedMapper().addIdsEqualToQuery(rootParameters,eeOriginalIdPropertyPath,referencedIdData.getOriginalMapper(),REFERENCED_ENTITY_ALIAS + "." + originalIdPropertyName);
  referencingIdData.getPrefixedMapper().addNamedIdEqualsToQuery(rootParameters,originalIdPropertyName,true);
  auditStrategy.addEntityAtRevisionRestriction(globalCfg,qb,REFERENCED_ENTITY_ALIAS + "." + revisionPropertyPath,REFERENCED_ENTITY_ALIAS + "." + verEntCfg.getRevisionEndFieldName(),false,referencedIdData,revisionPropertyPath,originalIdPropertyName,REFERENCED_ENTITY_ALIAS,REFERENCED_ENTITY_ALIAS_DEF_AUD_STR);
  auditStrategy.addAssociationAtRevisionRestriction(qb,revisionPropertyPath,verEntCfg.getRevisionEndFieldName(),true,referencingIdData,versionsMiddleEntityName,eeOriginalIdPropertyPath,revisionPropertyPath,originalIdPropertyName,MIDDLE_ENTITY_ALIAS,componentDatas);
  String revisionTypePropName=getRevisionTypePath();
  rootParameters.addWhereWithNamedParam(revisionTypePropName,"!=",DEL_REVISION_TYPE_PARAMETER);
  rootParameters.addWhereWithNamedParam(REFERENCED_ENTITY_ALIAS + "." + revisionTypePropName,false,"!=",DEL_REVISION_TYPE_PARAMETER);
  StringBuilder sb=new StringBuilder();
  qb.build(sb,Collections.<String,Object>emptyMap());
  queryString=sb.toString();
}
