{
  Transaction tx=null;
  try {
    if (transactionManager != null) {
      tx=transactionManager.getTransaction();
    }
  }
 catch (  SystemException se) {
    throw new CacheException("Could not obtain transaction",se);
  }
  return tx == null ? Thread.currentThread() : tx;
}
