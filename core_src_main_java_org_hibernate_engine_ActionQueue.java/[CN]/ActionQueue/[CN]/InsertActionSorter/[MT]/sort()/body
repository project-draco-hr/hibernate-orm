{
  for (  EntityInsertAction action : (List<EntityInsertAction>)insertions) {
    String entityName=action.getEntityName();
    Object currentEntity=action.getInstance();
    Integer batchNumber;
    if (latestBatches.containsKey(entityName)) {
      batchNumber=findBatchNumber(action,entityName);
    }
 else {
      batchNumber=Integer.valueOf(actionBatches.size());
      latestBatches.put(entityName,batchNumber);
    }
    entityBatchNumber.put(currentEntity,batchNumber);
    addToBatch(batchNumber,action);
  }
  insertions.clear();
  for (int i=0; i < actionBatches.size(); i++) {
    List batch=(List)actionBatches.get(new Integer(i));
    for (    Object aBatch : batch) {
      EntityInsertAction action=(EntityInsertAction)aBatch;
      insertions.add(action);
    }
  }
}
