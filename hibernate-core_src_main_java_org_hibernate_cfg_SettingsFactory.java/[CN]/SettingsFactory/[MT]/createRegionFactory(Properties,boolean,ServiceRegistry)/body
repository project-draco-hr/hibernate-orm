{
  String regionFactoryClassName=RegionFactoryInitiator.mapLegacyNames(ConfigurationHelper.getString(AvailableSettings.CACHE_REGION_FACTORY,properties,null));
  if (regionFactoryClassName == null || !cachingEnabled) {
    regionFactoryClassName=DEF_CACHE_REG_FACTORY;
  }
  LOG.debugf("Cache region factory : %s",regionFactoryClassName);
  try {
    try {
      return (RegionFactory)serviceRegistry.getService(ClassLoaderService.class).classForName(regionFactoryClassName).getConstructor(Properties.class).newInstance(properties);
    }
 catch (    NoSuchMethodException e) {
      LOG.debugf("%s did not provide constructor accepting java.util.Properties; attempting no-arg constructor.",regionFactoryClassName);
      return (RegionFactory)serviceRegistry.getService(ClassLoaderService.class).classForName(regionFactoryClassName).newInstance();
    }
  }
 catch (  Exception e) {
    throw new HibernateException("could not instantiate RegionFactory [" + regionFactoryClassName + "]",e);
  }
}
