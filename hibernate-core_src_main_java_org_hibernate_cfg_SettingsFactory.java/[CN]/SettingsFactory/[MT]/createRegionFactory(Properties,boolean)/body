{
  String regionFactoryClassName=ConfigurationHelper.getString(Environment.CACHE_REGION_FACTORY,properties,null);
  if (regionFactoryClassName == null && cachingEnabled) {
    String providerClassName=ConfigurationHelper.getString(Environment.CACHE_PROVIDER,properties,null);
    if (providerClassName != null) {
      regionFactoryClassName=RegionFactoryCacheProviderBridge.class.getName();
    }
  }
  if (regionFactoryClassName == null) {
    regionFactoryClassName=DEF_CACHE_REG_FACTORY;
  }
  LOG.debugf("Cache region factory : %s",regionFactoryClassName);
  try {
    try {
      return (RegionFactory)ReflectHelper.classForName(regionFactoryClassName).getConstructor(Properties.class).newInstance(properties);
    }
 catch (    NoSuchMethodException e) {
      LOG.debugf("%s did not provide constructor accepting java.util.Properties; attempting no-arg constructor.",regionFactoryClassName);
      return (RegionFactory)ReflectHelper.classForName(regionFactoryClassName).newInstance();
    }
  }
 catch (  Exception e) {
    throw new HibernateException("could not instantiate RegionFactory [" + regionFactoryClassName + "]",e);
  }
}
