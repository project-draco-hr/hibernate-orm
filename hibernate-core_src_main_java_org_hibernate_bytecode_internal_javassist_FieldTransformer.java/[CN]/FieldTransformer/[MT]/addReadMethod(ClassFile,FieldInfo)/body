{
  final ConstPool constPool=classfile.getConstPool();
  final int thisClassInfo=constPool.getThisClassInfo();
  final String readMethodDescriptor="()" + finfo.getDescriptor();
  final MethodInfo readMethodInfo=new MethodInfo(constPool,EACH_READ_METHOD_PREFIX + finfo.getName(),readMethodDescriptor);
  final Bytecode code=new Bytecode(constPool,5,3);
  code.addAload(0);
  code.addOpcode(Opcode.GETFIELD);
  final int baseFieldIndex=constPool.addFieldrefInfo(thisClassInfo,finfo.getName(),finfo.getDescriptor());
  code.addIndex(baseFieldIndex);
  code.addAload(0);
  final int enabledClassIndex=constPool.addClassInfo(FIELD_HANDLED_TYPE_NAME);
  code.addInvokeinterface(enabledClassIndex,GETFIELDHANDLER_METHOD_NAME,GETFIELDHANDLER_METHOD_DESCRIPTOR,1);
  code.addOpcode(Opcode.IFNONNULL);
  code.addIndex(4);
  addTypeDependDataReturn(code,finfo.getDescriptor());
  addTypeDependDataStore(code,finfo.getDescriptor(),1);
  code.addAload(0);
  code.addInvokeinterface(enabledClassIndex,GETFIELDHANDLER_METHOD_NAME,GETFIELDHANDLER_METHOD_DESCRIPTOR,1);
  code.addAload(0);
  code.addLdc(finfo.getName());
  addTypeDependDataLoad(code,finfo.getDescriptor(),1);
  addInvokeFieldHandlerMethod(classfile,code,finfo.getDescriptor(),true);
  addTypeDependDataReturn(code,finfo.getDescriptor());
  readMethodInfo.setCodeAttribute(code.toCodeAttribute());
  readMethodInfo.setAccessFlags(AccessFlag.PUBLIC);
  final CodeAttribute codeAttribute=readMethodInfo.getCodeAttribute();
  if (codeAttribute != null) {
    final StackMapTable smt=MapMaker.make(classPool,readMethodInfo);
    codeAttribute.setAttribute(smt);
  }
  classfile.addMethod(readMethodInfo);
}
