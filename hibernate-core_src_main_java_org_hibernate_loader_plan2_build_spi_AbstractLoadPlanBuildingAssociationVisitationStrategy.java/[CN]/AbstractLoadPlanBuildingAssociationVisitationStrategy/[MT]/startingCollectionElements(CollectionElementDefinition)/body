{
  final Type elementType=elementDefinition.getType();
  if (elementType.isAnyType()) {
    return;
  }
  log.tracef("%s Starting collection element graph : %s",StringHelper.repeat(">>",fetchSourceStack.size()),elementDefinition.getCollectionDefinition().getCollectionPersister().getRole());
  final CollectionReference collectionReference=collectionReferenceStack.peekFirst();
  final CollectionFetchableElement elementGraph=collectionReference.getElementGraph();
  if (elementType.isAssociationType() || elementType.isComponentType()) {
    if (elementGraph == null) {
      throw new IllegalStateException("CollectionReference did not return an expected element graph : " + elementDefinition.getCollectionDefinition().getCollectionPersister().getRole());
    }
    pushToStack((ExpandingFetchSource)elementGraph);
  }
 else {
    if (elementGraph != null) {
      throw new IllegalStateException("CollectionReference returned an unexpected element graph : " + elementDefinition.getCollectionDefinition().getCollectionPersister().getRole());
    }
  }
}
