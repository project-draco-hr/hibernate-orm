{
  Session s=openSession();
  Transaction tx=s.beginTransaction();
  Team t=new Team();
  Player p=new Player();
  p.setName("me");
  t.getPlayers().add(p);
  p.setTeam(t);
  try {
    s.persist(p);
    s.persist(t);
    tx.commit();
    s.close();
    s=openSession();
    tx=s.beginTransaction();
    Team t2=(Team)s.load(Team.class,new Long(1));
    Set<Player> players=t2.getPlayers();
    Iterator<Player> iterator=players.iterator();
    assertEquals("me",iterator.next().getName());
    tx.commit();
  }
 catch (  Exception e) {
    e.printStackTrace();
    if (tx != null)     tx.rollback();
  }
 finally {
    s.close();
  }
}
