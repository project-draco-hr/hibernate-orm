{
  Session session=openSession();
  Transaction t=session.beginTransaction();
  Course courseA=new Course();
  courseA.setCourseCode("HIB-A");
  courseA.setDescription("Hibernate Training A");
  session.persist(courseA);
  Course courseB=new Course();
  courseB.setCourseCode("HIB-B");
  courseB.setDescription("Hibernate Training B");
  session.persist(courseB);
  Student gavin=new Student();
  gavin.setName("Gavin King");
  gavin.setStudentNumber(232);
  gavin.setPreferredCourse(courseA);
  session.persist(gavin);
  Student leonardo=new Student();
  leonardo.setName("Leonardo Quijano");
  leonardo.setStudentNumber(233);
  leonardo.setPreferredCourse(courseB);
  session.persist(leonardo);
  Student johnDoe=new Student();
  johnDoe.setName("John Doe");
  johnDoe.setStudentNumber(235);
  johnDoe.setPreferredCourse(null);
  session.persist(johnDoe);
  List result=session.createCriteria(Student.class).setProjection(Property.forName("preferredCourse.courseCode")).createCriteria("preferredCourse",Criteria.LEFT_JOIN).addOrder(Order.asc("courseCode")).list();
  assertEquals(3,result.size());
  if (result.get(0) == null) {
    assertEquals("HIB-A",result.get(1));
    assertEquals("HIB-B",result.get(2));
  }
 else {
    assertNull(result.get(2));
    assertEquals("HIB-A",result.get(0));
    assertEquals("HIB-B",result.get(1));
  }
  result=session.createCriteria(Student.class).setFetchMode("preferredCourse",FetchMode.JOIN).createCriteria("preferredCourse",Criteria.LEFT_JOIN).addOrder(Order.asc("courseCode")).list();
  assertEquals(3,result.size());
  assertNotNull(result.get(0));
  assertNotNull(result.get(1));
  assertNotNull(result.get(2));
  result=session.createCriteria(Student.class).setFetchMode("preferredCourse",FetchMode.JOIN).createAlias("preferredCourse","pc",Criteria.LEFT_JOIN).addOrder(Order.asc("pc.courseCode")).list();
  assertEquals(3,result.size());
  assertNotNull(result.get(0));
  assertNotNull(result.get(1));
  assertNotNull(result.get(2));
  session.delete(gavin);
  session.delete(leonardo);
  session.delete(johnDoe);
  session.delete(courseA);
  session.delete(courseB);
  t.commit();
  session.close();
}
