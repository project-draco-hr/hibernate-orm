{
  EntityManager em=getEntityManager();
  em.getTransaction().begin();
  Person lukasz=new Person("Lukasz");
  Person kinga=new Person("Kinga");
  Address warsaw=new Address("Warsaw");
  warsaw.getTenants().add(lukasz);
  warsaw.setLandlord(lukasz);
  warsaw.getTenants().add(kinga);
  lukasz.getAddresses().add(warsaw);
  lukasz.getOwnedAddresses().add(warsaw);
  kinga.getAddresses().add(warsaw);
  em.persist(lukasz);
  em.persist(kinga);
  em.persist(warsaw);
  em.getTransaction().commit();
  lukaszId=lukasz.getId();
  kingaId=kinga.getId();
  warsawId=warsaw.getId();
  em.getTransaction().begin();
  kinga=em.find(Person.class,kinga.getId());
  Address cracow=new Address("Cracow");
  kinga.getAddresses().add(cracow);
  cracow.getTenants().add(kinga);
  cracow.setLandlord(kinga);
  em.persist(cracow);
  em.getTransaction().commit();
  cracowId=cracow.getId();
  em.getTransaction().begin();
  cracow=em.find(Address.class,cracow.getId());
  cracow.setCity("Krakow");
  em.merge(cracow);
  em.getTransaction().commit();
  em.getTransaction().begin();
  lukasz=em.find(Person.class,lukasz.getId());
  lukasz.setName("Lucas");
  em.merge(lukasz);
  em.getTransaction().commit();
  em.getTransaction().begin();
  warsaw=em.find(Address.class,warsaw.getId());
  lukasz=em.find(Person.class,lukasz.getId());
  kinga=em.find(Person.class,kinga.getId());
  warsaw.setLandlord(kinga);
  kinga.getOwnedAddresses().add(warsaw);
  lukasz.getOwnedAddresses().remove(warsaw);
  em.merge(warsaw);
  em.merge(lukasz);
  em.merge(kinga);
  em.getTransaction().commit();
}
