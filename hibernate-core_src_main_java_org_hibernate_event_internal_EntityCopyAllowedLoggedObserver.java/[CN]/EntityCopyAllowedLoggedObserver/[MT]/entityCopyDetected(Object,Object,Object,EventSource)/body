{
  final String entityName=session.getEntityName(managedEntity);
  LOG.trace(String.format("More than one representation of the same persistent entity being merged for: %s",MessageHelper.infoString(entityName,session.getIdentifier(managedEntity))));
  Set<Object> detachedEntitiesForManaged=null;
  if (managedToMergeEntitiesXref == null) {
    managedToMergeEntitiesXref=new IdentityHashMap<Object,Set<Object>>();
  }
 else {
    detachedEntitiesForManaged=managedToMergeEntitiesXref.get(managedEntity);
  }
  if (detachedEntitiesForManaged == null) {
    detachedEntitiesForManaged=new IdentitySet();
    managedToMergeEntitiesXref.put(managedEntity,detachedEntitiesForManaged);
  }
  if (detachedEntitiesForManaged.add(mergeEntity1)) {
    incrementEntityNameCount(entityName);
  }
  if (detachedEntitiesForManaged.add(mergeEntity2)) {
    incrementEntityNameCount(entityName);
  }
}
