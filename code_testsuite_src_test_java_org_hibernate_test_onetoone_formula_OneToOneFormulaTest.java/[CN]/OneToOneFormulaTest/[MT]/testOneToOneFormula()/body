{
  Person p=new Person();
  p.setName("Gavin King");
  Address a=new Address();
  a.setPerson(p);
  a.setType("HOME");
  a.setZip("3181");
  a.setState("VIC");
  a.setStreet("Karbarook Ave");
  p.setAddress(a);
  Session s=openSession();
  Transaction t=s.beginTransaction();
  s.persist(p);
  t.commit();
  s.close();
  s=openSession();
  t=s.beginTransaction();
  p=(Person)s.createQuery("from Person").uniqueResult();
  assertNotNull(p.getAddress());
  assertTrue(Hibernate.isInitialized(p.getAddress()));
  assertNull(p.getMailingAddress());
  s.clear();
  p=(Person)s.createQuery("from Person p left join fetch p.mailingAddress left join fetch p.address").uniqueResult();
  assertNotNull(p.getAddress());
  assertTrue(Hibernate.isInitialized(p.getAddress()));
  assertNull(p.getMailingAddress());
  s.clear();
  p=(Person)s.createQuery("from Person p left join fetch p.address").uniqueResult();
  assertNotNull(p.getAddress());
  assertTrue(Hibernate.isInitialized(p.getAddress()));
  assertNull(p.getMailingAddress());
  s.clear();
  p=(Person)s.createCriteria(Person.class).createCriteria("address").add(Property.forName("zip").eq("3181")).uniqueResult();
  assertNotNull(p);
  s.clear();
  p=(Person)s.createCriteria(Person.class).setFetchMode("address",FetchMode.JOIN).uniqueResult();
  assertNotNull(p.getAddress());
  assertTrue(Hibernate.isInitialized(p.getAddress()));
  assertNull(p.getMailingAddress());
  s.clear();
  p=(Person)s.createCriteria(Person.class).setFetchMode("mailingAddress",FetchMode.JOIN).uniqueResult();
  assertNotNull(p.getAddress());
  assertTrue(Hibernate.isInitialized(p.getAddress()));
  assertNull(p.getMailingAddress());
  s.delete(p);
  t.commit();
  s.close();
}
