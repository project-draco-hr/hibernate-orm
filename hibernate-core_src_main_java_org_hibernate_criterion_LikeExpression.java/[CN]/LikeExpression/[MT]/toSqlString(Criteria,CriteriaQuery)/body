{
  Dialect dialect=criteriaQuery.getFactory().getDialect();
  String[] columns=criteriaQuery.findColumns(propertyName,criteria);
  if (columns.length != 1) {
    throw new HibernateException("Like may only be used with single-column properties");
  }
  String escape=escapeChar == null ? "" : " escape \'" + escapeChar + "\'";
  String column=columns[0];
  if (ignoreCase) {
    if (dialect.supportsCaseInsensitiveLike()) {
      return column + " " + dialect.getCaseInsensitiveLike()+ " ?"+ escape;
    }
 else {
      return dialect.getLowercaseFunction() + '(' + column+ ')'+ " like ?"+ escape;
    }
  }
 else {
    return column + " like ?" + escape;
  }
}
