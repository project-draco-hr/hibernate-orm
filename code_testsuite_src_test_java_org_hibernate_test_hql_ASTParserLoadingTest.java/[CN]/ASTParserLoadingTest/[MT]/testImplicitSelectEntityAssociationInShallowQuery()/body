{
  Session s=openSession();
  s.beginTransaction();
  SimpleEntityWithAssociation owner=new SimpleEntityWithAssociation("owner");
  SimpleAssociatedEntity e1=new SimpleAssociatedEntity("thing one",owner);
  SimpleAssociatedEntity e2=new SimpleAssociatedEntity("thing two");
  s.save(e1);
  s.save(e2);
  s.save(owner);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  int count=determineCount(s.createQuery("select e.id, e.owner from SimpleAssociatedEntity e").list().iterator());
  assertEquals(1,count);
  count=determineCount(s.createQuery("select e.id, e.owner from SimpleAssociatedEntity e").iterate());
  assertEquals(1,count);
  s.getTransaction().commit();
  s.close();
  s=openSession();
  s.beginTransaction();
  s.delete(e1);
  s.delete(e2);
  s.delete(owner);
  s.getTransaction().commit();
  s.close();
}
