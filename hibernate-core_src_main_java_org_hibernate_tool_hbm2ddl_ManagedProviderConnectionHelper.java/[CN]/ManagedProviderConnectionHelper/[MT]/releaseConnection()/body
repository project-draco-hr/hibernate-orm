{
  if (connection != null) {
    try {
      new SqlExceptionHelper().logAndClearWarnings(connection);
    }
  finally {
      try {
        serviceRegistry.getService(ConnectionProvider.class).closeConnection(connection);
      }
  finally {
        connection=null;
      }
    }
  }
}
